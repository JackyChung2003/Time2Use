import{r as t,j as e,a as Hn}from"./react-Ck4LUVBC.js";import{c as Xn}from"./react-dom-Ds7J2zyt.js";import{a as Jn}from"./@supabase-C8qbL7oB.js";import{u as ue,N as ze,L as vt,a as mt,b as Je,c as Ee,R as kt,d as le,B as Kn}from"./react-router-CmTt_N5p.js";import{F as jn,a as Zn,b as es,c as ts,d as Xe,L as ns,e as un,f as ss,g as rs,h as is,i as as,j as Nt,k as os,l as cs,m as yt,n as ls,o as ds,p as us,q as ps,r as hs,s as pn,t as hn,u as ms}from"./react-icons-Bl_C-ANZ.js";import{C as gs,r as xs}from"./chart.js-DakM32vP.js";import{P as fs,D as ys}from"./react-chartjs-2-DH6gonSp.js";import{c as js}from"./chroma-js-CHvE9HB5.js";import{u as vs}from"./react-swipeable-b48i3Z8I.js";import{R as bs}from"./react-qr-scanner-CU9m1EQb.js";import{C as mn,S as gn,a as _s,B as Ns,s as tt}from"./antd-U0j6Nxa_.js";import{C as ws}from"./react-calendar-W9cldb3z.js";import"./react-circular-progressbar-I4zpmBkv.js";import{f as wt}from"./date-fns-BzRktsyD.js";import{u as vn,C as bn,a as _n,b as Nn,D as wn,c as Cn,S as Sn,v as kn,P as In,d as qn}from"./@dnd-kit-CHYCLw1J.js";import{R as Cs,B as Ss,C as ks,X as Is,Y as qs,T as Es,L as Ds,a as Ct}from"./recharts-DtJZEfu_.js";import{G as Rs}from"./@google-DlT_pbP0.js";import{P as Qe}from"./prop-types-dJBV6XVk.js";import{M as Fs}from"./react-markdown-ar1XVGxK.js";import{r as Us}from"./remark-gfm-DLhb750Z.js";import"./scheduler-CzFDRTuY.js";import"./cookie-DmSiaxFR.js";import"./@kurkle-D8fDXNIl.js";import"./@babel-DIaYKQuy.js";import"./rc-util-C0LYQZ5Y.js";import"./@ant-design-BoVh1Ei5.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./classnames-BbTGAWaK.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-resize-observer-B5ylZEVs.js";import"./rc-motion-Bd24aP47.js";import"./@rc-component-CVxamMQx.js";import"./rc-overflow-BSq4Z-la.js";import"./rc-menu-BQjE8mM8.js";import"./rc-tabs-CuPPRWYr.js";import"./rc-dropdown-IXIa4uQI.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-pagination-DA7o6uqa.js";import"./rc-picker-BQZzfikC.js";import"./rc-notification-DUN2pqW5.js";import"./clsx-B-dksMZM.js";import"./get-user-locale-lWunktTW.js";import"./mem-KQhVxfhT.js";import"./mimic-fn-Bbosp5ci.js";import"./map-age-cleaner-C3PVzE_8.js";import"./p-defer-O4M1dHHK.js";import"./@wojtekmaj-B-N8U4WN.js";import"./lodash-C_ySalkc.js";import"./tiny-invariant-BaFNuDhB.js";import"./d3-shape-DjFPhhqo.js";import"./d3-path-CimkQT29.js";import"./react-smooth-ChVggkmc.js";import"./fast-equals-BIyco3rD.js";import"./victory-vendor-6_AdwBXU.js";import"./d3-scale-BYIooUZQ.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-g_qRI3rN.js";import"./d3-time-format-BKO53YJi.js";import"./d3-time-QpEiTrED.js";import"./d3-interpolate-CvRPKVI0.js";import"./d3-color-9lF95FHy.js";import"./d3-format-CzD4bSOQ.js";import"./recharts-scale-DiOBu8nk.js";import"./decimal.js-light-B5-9uEc-.js";import"./eventemitter3-BASizIQN.js";import"./devlop-Cl3hj7Sz.js";import"./unified-B3-WZmv5.js";import"./bail-FqpXQuLt.js";import"./extend-D-HxdXw2.js";import"./is-plain-obj-C1gvLhAf.js";import"./trough-B_b8ryxu.js";import"./vfile-tbz-BywF.js";import"./vfile-message-Bq256rVA.js";import"./unist-util-stringify-position-Ch_qCilz.js";import"./remark-parse-DgYEElgb.js";import"./mdast-util-from-markdown-DpWY7VUy.js";import"./micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./micromark-util-decode-string-strjl-tx.js";import"./decode-named-character-reference-C3-224fz.js";import"./micromark-util-normalize-identifier-C9ANKk3v.js";import"./micromark-C8Bjfqlk.js";import"./micromark-util-combine-extensions-Bka6Sc1c.js";import"./micromark-util-chunked-DrRIdSP-.js";import"./micromark-factory-space-Bzki161k.js";import"./micromark-util-character-Cn8n62xE.js";import"./micromark-core-commonmark-C7p00laY.js";import"./micromark-util-classify-character-72LGz2mN.js";import"./micromark-util-resolve-all-PQCKh0dx.js";import"./micromark-util-subtokenize-Bdv1B1ce.js";import"./micromark-factory-destination-Dhx6mInV.js";import"./micromark-factory-label-Dm2aTycn.js";import"./micromark-factory-title-B-Q3zsGF.js";import"./micromark-factory-whitespace-DxqLJ6OX.js";import"./micromark-util-html-tag-name-DbKNfynz.js";import"./mdast-util-to-string-C_aolqmU.js";import"./remark-rehype-KNc3mpf6.js";import"./mdast-util-to-hast-DWFPJkWc.js";import"./@ungap-DDJC10qW.js";import"./micromark-util-sanitize-uri-B1mpwOqX.js";import"./unist-util-position-60F3QETU.js";import"./trim-lines-D8znQY54.js";import"./unist-util-visit-BEqpjG-T.js";import"./unist-util-visit-parents-BzuIhZFT.js";import"./unist-util-is-D9KQvrmg.js";import"./hast-util-to-jsx-runtime-CvOdCtDh.js";import"./comma-separated-tokens-xMQ5YY98.js";import"./property-information-C2mYTYrW.js";import"./space-separated-tokens-DD3iYX1K.js";import"./style-to-object-CxR04hMs.js";import"./inline-style-parser-D--Rb2MU.js";import"./hast-util-whitespace-D4Wp6AEg.js";import"./estree-util-is-identifier-name-BgBfM8ME.js";import"./html-url-attributes-D46m5wfe.js";import"./micromark-extension-gfm-BIHL-pSr.js";import"./micromark-extension-gfm-autolink-literal-DLPcB62U.js";import"./micromark-extension-gfm-footnote-27R2ued3.js";import"./micromark-extension-gfm-strikethrough-DRvqaQ9w.js";import"./micromark-extension-gfm-table-DL38QGqH.js";import"./micromark-extension-gfm-task-list-item-CQ-9H0He.js";import"./mdast-util-gfm-fPPWwbPu.js";import"./mdast-util-gfm-autolink-literal-BmijSaoZ.js";import"./ccount-c2V3InAJ.js";import"./mdast-util-find-and-replace-Cmrefh_I.js";import"./mdast-util-gfm-footnote-DDcgsGKB.js";import"./mdast-util-gfm-strikethrough-Cj9qKt6Q.js";import"./mdast-util-gfm-table-Crh2rA4F.js";import"./markdown-table-DvhhVmnL.js";import"./mdast-util-to-markdown-BKij1Gf0.js";import"./longest-streak-CtXnX3Xp.js";import"./mdast-util-phrasing-C4Vf_nAi.js";import"./mdast-util-gfm-task-list-item-wdBSVf5s.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const y of c.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&a(y)}).observe(document,{childList:!0,subtree:!0});function i(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(r){if(r.ep)return;r.ep=!0;const c=i(r);fetch(r.href,c)}})();const Ps="https://wryzdgcrrejrwfqsdaog.supabase.co",Ts="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndyeXpkZ2NycmVqcndmcXNkYW9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM3NjgzMDQsImV4cCI6MjA0OTM0NDMwNH0.p0dezgq_lSZ_NZhSqwMNyGf919X9vMtoHkGNgqTGDrw",d=Jn(Ps,Ts,{auth:{persistSession:!0,autoRefreshToken:!0}}),En=t.createContext(),As=({children:n})=>{const[s,i]=t.useState(localStorage.getItem("userRole"));t.useEffect(()=>{const{data:{subscription:r}}=d.auth.onAuthStateChange((c,y)=>{console.log("Auth event:",c),c==="SIGNED_OUT"&&(localStorage.removeItem("userRole"),i(null))});return()=>{r.unsubscribe()}},[]);const a=r=>{r?localStorage.setItem("userRole",r):localStorage.removeItem("userRole"),i(r)};return e.jsx(En.Provider,{value:{userRole:s,updateUserRole:a},children:n})},It=()=>t.useContext(En),Ls=()=>{const n=ue(),{updateUserRole:s}=It(),[i,a]=t.useState(""),[r,c]=t.useState(""),[y,l]=t.useState(!1),h=async p=>{p.preventDefault(),l(!0);try{const{data:g,error:o}=await d.auth.signInWithPassword({email:i,password:r});if(o)throw o.status===400?alert("Incorrect email or password. Please try again."):o.status===404?alert("No user found with this email. Please create an account."):alert(`Login failed: ${o.message}`),o;alert("Login successful!");const{data:b,error:x}=await d.from("user_roles").select("role_id").eq("user_id",g.user.id).single();if(x)throw console.error("Error fetching user_role:",x),x;const{data:L,error:k}=await d.from("roles").select("role_name").eq("id",b.role_id).single();if(k)throw console.error("Error fetching role_name:",k),k;const R=L.role_name.trim().toLowerCase();if(sessionStorage.setItem("showNotification","true"),s(R),R==="client"){const{data:m,error:_}=await d.from("profile").select("username").eq("user",g.user.id).single();if(_)throw console.error("Error fetching profile data:",_),_;m!=null&&m.username?n("/dashboard"):n("/profile")}else if(R==="admin")n("/admin/dashboard");else throw new Error(`Unknown role: ${R}`)}catch(g){console.error("Error:",g.message)}finally{l(!1)}};return e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"floating-shape shape-1"}),e.jsx("div",{className:"floating-shape shape-2"}),e.jsx("div",{className:"floating-shape shape-3"}),e.jsx("div",{className:"floating-shape shape-4"}),e.jsx("h1",{className:"header",children:"Login"}),e.jsxs("form",{onSubmit:h,children:[e.jsx("input",{type:"email",placeholder:"Email",value:i,onChange:p=>a(p.target.value),required:!0}),e.jsx("input",{type:"password",placeholder:"Password",value:r,onChange:p=>c(p.target.value),required:!0}),e.jsx("p",{className:"forgot-password-link",children:e.jsx("button",{type:"button",className:"forgot-password-button",onClick:()=>n("/forgetpassword"),children:"Forgot Password?"})}),e.jsx("button",{type:"submit",className:"login-button",disabled:y,children:y?"Logging in...":"Login"})]}),e.jsxs("p",{className:"footer",children:["Don't have an account?"," ",e.jsx("button",{className:"signup-link",onClick:()=>n("/signup"),children:"Sign Up"})]})]})},Ms=()=>{const n=ue(),[s,i]=t.useState(""),[a,r]=t.useState(!1),[c,y]=t.useState(""),l=async h=>{h.preventDefault(),r(!0);try{const{error:p}=await d.auth.api.resetPasswordForEmail(s);if(p)throw alert(`Error: ${p.message}`),p;y("Password reset email sent! Please check your inbox.")}catch(p){console.error("Error:",p.message)}finally{r(!1)}};return e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"header",children:"Forgot Password"}),e.jsxs("form",{onSubmit:l,children:[e.jsx("input",{type:"email",placeholder:"Enter your email",value:s,onChange:h=>i(h.target.value),required:!0}),e.jsx("button",{type:"submit",className:"forgot-password-button",disabled:a,children:a?"Sending email...":"Send Reset Link"})]}),c&&e.jsx("p",{className:"message",children:c}),e.jsxs("p",{className:"footer",children:["Remember your password?"," ",e.jsx("button",{className:"signup-link",onClick:()=>n("/login"),children:"Login"})]})]})},$s=()=>{const[n,s]=t.useState(""),[i,a]=t.useState(""),[r,c]=t.useState(!1),y=ue(),l=async h=>{var p,g;h.preventDefault(),c(!0);try{const{data:o,error:b}=await d.auth.signUp({email:n,password:i,options:{data:{role:"client"}}});if(b)throw console.error("Signup error details:",{message:b.message,status:b==null?void 0:b.status,details:b==null?void 0:b.details}),b;o!=null&&o.user&&console.log("Signup successful:",{userId:o.user.id,email:o.user.email,metadata:o.user.user_metadata}),alert("Account created! Please verify your email."),y("/login")}catch(o){console.error("Full error object:",o);let b="Signup failed: ";o.message?b+=o.message:o.msg?b+=o.msg:o.error_description?b+=o.error_description:b+="Unknown error occurred",(p=o.message)!=null&&p.includes("duplicate")?b="This email is already registered. Please try logging in instead.":(g=o.message)!=null&&g.includes("password")&&(b="Password must be at least 6 characters long."),alert(b)}finally{c(!1)}};return e.jsxs("div",{className:"signup-container",children:[e.jsx("div",{className:"floating-shape shape-1"}),e.jsx("div",{className:"floating-shape shape-2"}),e.jsx("div",{className:"floating-shape shape-3"}),e.jsx("div",{className:"floating-shape shape-4"}),e.jsx("h1",{className:"signup-header",children:"Sign Up"}),e.jsxs("form",{onSubmit:l,children:[e.jsx("input",{type:"email",placeholder:"Email",value:n,onChange:h=>s(h.target.value),required:!0}),e.jsx("input",{type:"password",placeholder:"Password",value:i,onChange:h=>a(h.target.value),required:!0}),e.jsx("button",{type:"submit",className:"signup-button",disabled:r,children:r?"Signing Up...":"Sign Up"})]}),e.jsxs("p",{children:["Already have an account?"," ",e.jsx("button",{className:"login-link",onClick:()=>y("/login"),children:"Log in here"})]})]})},Ue=()=>e.jsx("div",{className:"loader-container",children:e.jsxs("div",{className:"loader",children:[e.jsx("span",{className:"hour"}),e.jsx("span",{className:"min"}),e.jsx("span",{className:"circle"})]})}),ht=({children:n})=>{const[s,i]=t.useState(null);return t.useEffect(()=>{(async()=>{const{data:r,error:c}=await d.auth.getSession();c||!r.session?i(!1):i(!0)})()},[]),s===null?e.jsx(Ue,{}):s?n:e.jsx(ze,{to:"/login"})},Qs="/Time2Use/assets/Time2Use-logo-CrJGXTXK.png",St=[{title:"Dashboard",link:"/dashboard",icon:e.jsx(jn,{})},{title:"Inventory",link:"/inventory",icon:e.jsx(Zn,{})},{title:"Scan QR",link:"/scan",icon:e.jsx(es,{})},{title:"Recipe",link:"/recipes",icon:e.jsx(ts,{})},{title:"Profile",link:"/profile",icon:e.jsx(Xe,{})}],Os=()=>e.jsxs("nav",{children:[e.jsxs(vt,{to:"/",className:"link",children:[e.jsx("img",{src:Qs,alt:"Time2Use Logo",className:"logo-icon"}),"Time2Use"]}),e.jsx("div",{className:"menu-items",children:St.map((n,s)=>e.jsx(mt,{className:({isActive:i})=>i?"link active":"link",to:n.link,children:n.title},s))}),e.jsx("div",{className:"login-button-mobile-hidden",children:e.jsx("div",{className:"icons",children:e.jsx("a",{href:"https://github.com/JackyChung2003/CAT304-G30",target:"_blank",rel:"noreferrer",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"github-icon icon-tabler icon-tabler-brand-github",width:"30",height:"30",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"#000",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"})]})})})})]}),Bs=()=>{const n=Je();return e.jsx("div",{className:"bottom-nav-container",children:e.jsxs("div",{className:"bottom-nav-wrapper",children:[St.slice(0,3).map((s,i)=>e.jsx(vt,{to:s.link,className:`bottom-nav-links ${n.pathname===s.link?"active":""}`,children:e.jsx("div",{className:"nav-item",children:e.jsx("span",{className:"nav-icon",children:s.icon})})},i)),e.jsx("div",{className:"scan-icon-container",children:e.jsx("div",{className:"scan-icon-wrapper",children:e.jsx(vt,{to:"/scan",className:"scan-icon-link",children:e.jsx(ns,{className:"scan-icon"})})})}),St.slice(3,5).map((s,i)=>e.jsx(vt,{to:s.link,className:`bottom-nav-links ${n.pathname===s.link?"active":""}`,children:e.jsx("div",{className:"nav-item",children:e.jsx("span",{className:"nav-icon",children:s.icon})})},i+3))]})})},xn=({title:n,messages:s,type:i,onClose:a})=>e.jsx("div",{className:`notification-popup ${i}`,children:e.jsxs("div",{className:"notification-content",children:[e.jsx("button",{className:"close-button",onClick:a,children:"✕"}),e.jsx("h3",{children:n}),e.jsx("div",{className:"notification-list",children:s.length===0?e.jsx("p",{children:"No items."}):s.map((r,c)=>e.jsx("p",{children:r},c))})]})}),Gs=()=>{const[n,s]=t.useState([]),[i,a]=t.useState([]),[r,c]=t.useState(!1),[y,l]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const{data:{user:o},error:b}=await d.auth.getUser();if(b||!o){console.error("Error fetching user or user is not logged in:",b==null?void 0:b.message);return}const{data:x,error:L}=await d.from("profile").select("notification_day").eq("user",o.id).single();if(L||!x){console.error("Error fetching profile data:",L==null?void 0:L.message);return}const k=x.notification_day;if(!k){console.error("No notification day configured for this user.");return}const{data:R,error:m}=await d.from("inventory").select("days_left, ingredients(name)").eq("user_id",o.id).lte("days_left",k).eq("condition_id",1);if(m){console.error("Error fetching inventory items:",m.message);return}const _=[],N=[];R==null||R.forEach(w=>{var C,G;w.days_left<0?N.push(`Oops! Your ${(C=w.ingredients)==null?void 0:C.name} has expired.`):_.push(`Get Cooking! Your ${(G=w.ingredients)==null?void 0:G.name} is expiring soon.`)}),_.length>0&&(s(_),c(!0)),N.length>0&&(a(N),l(!0))}catch(o){console.error("Error fetching notification data:",o.message)}})()},[]);const h=()=>c(!1),p=()=>l(!1);return e.jsxs(e.Fragment,{children:[r&&e.jsx(xn,{title:"Soon to Expire",messages:n,type:"soon-expire",onClose:h}),y&&e.jsx(xn,{title:"Expired Items",messages:i,type:"expired",onClose:p})]})};gs.register(...xs);const zs=()=>{const[n,s]=t.useState(null),[i,a]=t.useState(""),[r,c]=t.useState([]),[y,l]=t.useState([]),[h,p]=t.useState([]),[g,o]=t.useState({}),[b,x]=t.useState(!0),[L,k]=t.useState(!1),R=ue();if(t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]),t.useEffect(()=>{sessionStorage.getItem("showNotification")&&(k(!0),sessionStorage.removeItem("showNotification"))},[]),t.useEffect(()=>{(async()=>{var v;const{data:G,error:u}=await d.auth.getSession();u?(console.error("Error fetching user session:",u.message),R("/login")):s(((v=G==null?void 0:G.session)==null?void 0:v.user)||null)})()},[R]),t.useEffect(()=>{n&&(async()=>{if(!n)return;const{data:G,error:u}=await d.from("profile").select("username").eq("user",n.id).single();u?console.error("Error fetching username:",u.message):a((G==null?void 0:G.username)||"User")})()},[n]),t.useEffect(()=>{n&&(async()=>{if(n){x(!0);try{const{data:G,error:u}=await d.from("inventory").select("ingredient_id, ingredients(name, ingredients_category(category_name))").eq("user_id",n.id).eq("condition_id",1);if(u)console.error("Error fetching inventory:",u.message);else{const ee=G.reduce((F,T)=>{var U,X;const $=((X=(U=T.ingredients)==null?void 0:U.ingredients_category)==null?void 0:X.category_name)||"Unknown";return F[$]=(F[$]||0)+1,F},{});c(Object.entries(ee).map(([F,T])=>({category_name:F,total:T})))}const{data:v,error:D}=await d.from("inventory").select("ingredients(nutritional_info)").eq("user_id",n.id).eq("condition_id",1);if(D)console.error("Error fetching nutritional info:",D.message);else{const ee=v.reduce((F,T)=>{var $,U,X;try{const q=typeof(($=T.ingredients)==null?void 0:$.nutritional_info)=="string"?JSON.parse(T.ingredients.nutritional_info):(U=T.ingredients)==null?void 0:U.nutritional_info;if(q&&typeof q=="object")for(const[Y,P]of Object.entries(q)){const I=parseFloat(P);isNaN(I)||(F[Y]=(F[Y]||0)+I)}}catch(q){console.error("Error parsing nutritional_info:",(X=T.ingredients)==null?void 0:X.nutritional_info,q.message)}return F},{});o(ee)}const{data:j,error:S}=await d.from("inventory").select("days_left, ingredients(name)").eq("user_id",n==null?void 0:n.id).eq("condition_id",1).gt("days_left",0).lte("days_left",5);if(S)throw S;l(j.sort((ee,F)=>F.days_left-ee.days_left));const{data:M,error:Q}=await d.from("inventory").select("days_left, ingredients(name)").eq("user_id",n==null?void 0:n.id).eq("condition_id",1).lte("days_left",0);if(Q)throw Q;p(M.sort((ee,F)=>ee.days_left-F.days_left))}catch(G){console.error("Error fetching data:",G.message)}finally{x(!1)}}})()},[n]),b)return e.jsx(Ue,{});const m=C=>js.scale("Set3").mode("lab").colors(C),_=m(r.length),N=m(Object.keys(g).length);if(b)return e.jsx("div",{children:"Loading..."});const w=r.length===0&&y.length===0&&h.length===0;return e.jsxs("div",{children:[L&&e.jsx(Gs,{}),e.jsxs("div",{className:"dashboard-container",children:[e.jsx("div",{className:"dashboard-header",children:i&&e.jsxs("h1",{children:["Welcome, ",i,"!"]})}),w?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"To get started, scan a receipt to load your inventory and explore insights about your kitchen."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-card",children:[e.jsx("h2",{children:"Total Ingredients in Your Inventory"}),e.jsx(fs,{data:{labels:r.map(C=>C.category_name),datasets:[{data:r.map(C=>C.total),backgroundColor:_}]}})]}),e.jsxs("div",{className:"chart-card",children:[e.jsx("h2",{className:"chart-title",children:"Nutritional Overview"}),e.jsx(ys,{data:{labels:Object.keys(g),datasets:[{label:"Nutritional Values",data:Object.values(g),backgroundColor:N}]},options:{plugins:{title:{display:!1}}}})]})]}),e.jsxs("div",{className:"table-container",children:[e.jsxs("div",{className:"table-card",children:[e.jsx("h2",{children:"Expiring Ingredients"}),e.jsxs("table",{className:"expiring-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingredient"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"2",children:"No ingredients are expiring soon"})}):y.map((C,G)=>e.jsxs("tr",{children:[e.jsx("td",{children:C.ingredients.name}),e.jsx("td",{children:`${Math.abs(C.days_left)} days left`})]},G))})]})]}),e.jsxs("div",{className:"table-card",children:[e.jsx("h2",{children:"Expired Ingredients"}),e.jsxs("table",{className:"expiring-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingredient"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"2",children:"No ingredients are expired"})}):h.map((C,G)=>e.jsxs("tr",{children:[e.jsx("td",{children:C.ingredients.name}),e.jsx("td",{children:`Expired ${Math.abs(C.days_left)} days ago`})]},G))})]})]})]})]})]})]})},Vs=async n=>{var s,i,a,r,c,y,l,h,p,g,o,b;try{const{data:x,error:L}=await d.from("inventory").select(`
        id:ingredient_id,
        daysLeft:days_left,
        quantity,
        
        freshness_status_id,
        created_at,
        condition_id,
        expiry_date_id,
        expiry_date:expiry_date (date),
        ingredients (
          name,
          icon_path,
          nutritional_info,
          storage_tips,
          pred_shelf_life,
          quantity_unitInv_id,
          ingredients_category (
            category_tag
          ),
          unitInv:unitInv (unitInv_tag)
        ),
        freshness_status (
          status_color
        ),
        condition:condition (condition)
      `).eq("user_id",n);if(L)throw L;console.log("Fetched raw data from Supabase:",x);const k="https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/",R=[];for(const m of x){const _=(i=(s=m.ingredients)==null?void 0:s.ingredients_category)==null?void 0:i.category_tag,N=((a=m.freshness_status)==null?void 0:a.status_color)||"green",w=(r=m.ingredients)!=null&&r.icon_path?`${k}${m.ingredients.icon_path}`:"";let C=m.daysLeft;if(m.daysLeft===null&&((c=m.ingredients)!=null&&c.pred_shelf_life)&&(C=Ws(m.ingredients.pred_shelf_life)),C!==null&&m.daysLeft===null)try{console.log(`Item ID: ${m.id}, Original Days Left: ${m.daysLeft}, Calculated Days Left: ${C}`);const{error:G}=await d.from("inventory").update({days_left:C}).eq("ingredient_id",m.id).eq("user_id",n);G?console.error(`Error updating item with id ${m.id}:`,G):console.log(`Successfully updated item with id ${m.id}`)}catch(G){console.error(`Exception while updating item with id ${m.id}:`,G)}R.push({id:m.id,name:((y=m.ingredients)==null?void 0:y.name)||"Unknown",daysLeft:C,imageUrl:w,category:_,pred_shelf_life:((l=m.ingredients)==null?void 0:l.pred_shelf_life)||"No prediction available",quantity:m.quantity,quantity_unit:(p=(h=m.ingredients)==null?void 0:h.unitInv)==null?void 0:p.unitInv_tag,statusColor:N,nutritionalInfo:((g=m.ingredients)==null?void 0:g.nutritional_info)||"No information available",storageTips:((o=m.ingredients)==null?void 0:o.storage_tips)||"No tips available",condition_id:m.condition_id,created_at:m.created_at,expiryDate:(b=m.expiry_date)==null?void 0:b.date})}return R}catch(x){return console.error("Error fetching items:",x),[]}},Ws=n=>{const s=/(\d+)-(\d+)\s*(months?|days?|years?)/i,i=n.match(s);if(i){const l=parseInt(i[1]),h=parseInt(i[2]),p=i[3].toLowerCase();let g;return p.includes("month")?g=(l+h)/2*30:p.includes("year")?g=(l+h)/2*365:g=(l+h)/2,Math.round(g)}const a=/(\d+)-(\d+)\s*(months?|days?|years?)/g;let r=0,c=0,y;for(;(y=a.exec(n))!==null;){const l=parseInt(y[1]),h=parseInt(y[2]),p=y[3].toLowerCase();let g;p.includes("month")?g=(l+h)/2*30:p.includes("year")?g=(l+h)/2*365:g=(l+h)/2,r+=g,c++}return c>0?Math.round(r/c):null},qt=async(n,s,i)=>{try{if(!i)throw new Error("User ID is required.");if(!n)throw new Error("Item ID is required.");if(s==null)throw new Error("New quantity is required.");const{data:a,error:r}=await d.from("inventory").update({quantity:s,updated_at:new Date().toISOString()}).match({ingredient_id:n,user_id:i});if(r)throw r;console.log("Quantity and updated_at timestamp updated for user:",a)}catch(a){throw console.error("Error updating quantity:",a.message||a),a}},Ys=async(n,s,i)=>{try{if(!i)throw new Error("User ID is required.");if(!n)throw new Error("Item is required.");if(!s||s<=0)throw new Error("Portion must be greater than 0.");console.log("Item before update:",n),console.log("Portion to deduct:",s);let a=n.quantity-s;return a=Math.max(0,parseFloat(a.toFixed(2))),console.log("New quantity:",a),await qt(n.id,a,i),a}catch(a){throw console.error("Error handling portion click:",a.message||a),a}},Hs=async(n,s,i,a)=>{try{if(!a)throw new Error("User ID is required.");if(!n)throw new Error("Item is required.");if(s==null||s<0)throw new Error("New quantity must be a non-negative number.");const r=parseFloat(s);if(isNaN(r))throw new Error("Invalid quantity entered.");await qt(n.id,r,a),i(c=>c.map(y=>y.id===n.id?{...y,quantity:r}:y)),console.log("Quantity updated successfully in UI.")}catch(r){console.error("Error handling quantity change:",r.message||r)}},Xs=async(n,s)=>{console.log("Attempting to update item condition..."),console.log("Item ID:",n),console.log("Condition ID:",s);try{const i=await d.from("inventory").update({condition_id:s}).eq("ingredient_id",n).select("*",{count:"exact"});if(i.error)throw new Error(i.error.message);return{data:i.data,error:null,count:i.count}}catch(i){return console.error("Error updating condition:",i.message),{data:null,error:i.message,count:0}}},jt={fetchItems:Vs,updateQuantityInDatabase:qt,handlePortionClick:Ys,handleQuantityChange:Hs,updateItemCondition:Xs},Js=()=>{const[n,s]=t.useState(null),i=ue(),[a,r]=t.useState(!0),[c,y]=t.useState(""),[l,h]=t.useState(null),[p,g]=t.useState([]),[o,b]=t.useState({}),[x,L]=t.useState(null),[k,R]=t.useState(!1),[m,_]=t.useState({}),[N,w]=t.useState(null),[C,G]=t.useState(!1);if(t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]),t.useEffect(()=>{(async()=>{var Y;r(!0);const{data:X,error:q}=await d.auth.getSession();if(q)console.error("Error fetching user session:",q.message),i("/login");else{const P=((Y=X==null?void 0:X.session)==null?void 0:Y.user)||null;if(s(P),P){const I=await jt.fetchItems(P.id);g(I)}}r(!1)})()},[i]),t.useEffect(()=>{N&&T()},[N]),a)return e.jsx(Ue,{});const u=p.filter(U=>U.condition_id===1).filter(U=>U.name.toLowerCase().includes(c.toLowerCase())).sort((U,X)=>x==="days_left"?(U.daysLeft||1/0)-(X.daysLeft||1/0):x==="category"?U.category.localeCompare(X.category):0),v=()=>{R(U=>!U)},D=U=>{L(U),R(!1)},j=U=>{b(X=>({...X,[U]:!X[U]}))},S=U=>{h(X=>X===U?null:U)},M=U=>{const X=parseFloat(m[U.id]||0);if(X>0&&X<=U.quantity){const q=U.quantity-X;ee(U,q,n==null?void 0:n.id),_({...m,[U.id]:""})}else alert("Please enter a valid amount within the range!")},Q=async(U,X,q)=>{try{const Y=await jt.handlePortionClick(U,X,q);g(P=>P.map(I=>I.id===U.id?{...I,quantity:Y}:I))}catch(Y){console.error("Error handling portion click:",Y)}},ee=async(U,X,q)=>{try{await jt.handleQuantityChange(U,X,g,q)}catch(Y){console.error("Error handling quantity change:",Y)}},F=U=>{g(X=>X.filter(q=>q.id!==U))},T=async()=>{if(N&&!C){G(!0);const{id:U,action:X}=N,q=X==="discard"?3:2;try{const{data:Y,error:P,count:I}=await jt.updateItemCondition(U,q);if(P){console.error("Error updating item condition:",P);return}if(I===0){console.warn("No matching rows found to update.");return}F(U)}catch(Y){console.error("Error during action confirmation:",Y.message)}finally{G(!1),w(null)}}},$=(U,X)=>{w({id:U.id,action:X})};return e.jsxs("div",{className:"inventory-container",children:[e.jsx("input",{type:"text",placeholder:"Search for items...",className:"search-bar",value:c,onChange:U=>y(U.target.value)}),e.jsxs("div",{className:"tracker-header",children:[e.jsx("img",{src:"src/assets/images/filter-icon.png",alt:"Filter Icon",className:"filter-icon",onClick:v}),e.jsx("div",{className:"tracker-title",children:"Tracker"})]}),k&&e.jsxs("div",{className:"filter-menu",children:[e.jsx("button",{onClick:()=>D("days_left"),children:"Sort by Days Left"}),e.jsx("button",{onClick:()=>D("category"),children:"Sort by Food Category"})]}),u.length===0?e.jsx("div",{className:"empty-inventory-message",children:"Oops, your inventory is empty..."}):e.jsxs("div",{className:"item-sections",children:[e.jsxs("div",{className:"expired-section",children:[e.jsx("h2",{className:"section-title",children:"Expired Food"}),e.jsx("div",{className:"item-list",children:u.filter(U=>U.daysLeft!==null&&U.daysLeft<=0).map((U,X)=>e.jsx(fn,{item:U,user:n,setItems:g,handleClick:j,expandedItems:o,setExpandedItems:b,usedAmount:m,setUsedAmount:_,handleQuantityChange:ee,handlePortionClickWithState:Q,handleDoneClick:M,activeDropdown:l,toggleDropdown:S,handleSwipeAction:$},`${U.id}-${X}`))})]}),e.jsxs("div",{className:"fresh-section",children:[e.jsx("h2",{className:"section-title",children:"Fresh & Good"}),e.jsx("div",{className:"item-list",children:u.filter(U=>U.daysLeft>0||U.daysLeft===null).map((U,X)=>e.jsx(fn,{item:U,user:n,setItems:g,handleClick:j,expandedItems:o,setExpandedItems:b,usedAmount:m,setUsedAmount:_,handleQuantityChange:ee,handlePortionClickWithState:Q,handleDoneClick:M,activeDropdown:l,toggleDropdown:S,handleSwipeAction:$},`${U.id}-${X}`))})]})]})]})},fn=({item:n,user:s,setItems:i,handleClick:a,expandedItems:r,setExpandedItems:c,usedAmount:y,setUsedAmount:l,handleQuantityChange:h,handlePortionClickWithState:p,handleDoneClick:g,activeDropdown:o,toggleDropdown:b,handleSwipeAction:x})=>{const[L,k]=t.useState(!1),[R,m]=t.useState(!1),_=vs({onSwipedLeft:()=>k(!0),onSwipedRight:()=>k(!1),preventDefaultTouchmoveEvent:!0,trackMouse:!0}),N=C=>{R||(m(!0),k(!1),x(n,C))},w=n.daysLeft!==null&&n.daysLeft<=0;return e.jsxs("div",{className:"item-container",..._,children:[e.jsx("div",{className:"swipeable-item",style:{transform:L?"translateX(-50%)":"translateX(0)"}}),e.jsxs("div",{className:"item",children:[L&&e.jsxs("div",{className:"action-buttons",children:[!w&&e.jsx(e.Fragment,{children:e.jsx("button",{className:"used-button",onClick:()=>N("used"),children:"Used"})}),w&&e.jsx("button",{className:"discard-button",onClick:()=>N("discard"),children:"Discard"})]}),e.jsxs("div",{className:"left-section",children:[e.jsx("div",{className:`green-dot ${n.statusColor}`}),e.jsx("div",{className:"circle-image",children:e.jsx("img",{src:n.imageUrl,alt:n.name})}),e.jsxs("div",{className:"text-section",children:[e.jsx("div",{className:"item-name",children:n.name}),e.jsx("div",{className:"item-days",children:n.expiryDate==null?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`shelf-life ${r[n.id]?"full-text":""}`,onClick:()=>a(n.id),children:r[n.id]?n.pred_shelf_life:`${n.pred_shelf_life.slice(0,20)}`}),n.daysLeft!=null&&e.jsx("div",{className:"days-left",children:n.daysLeft===0?e.jsx("span",{children:"Expired today"}):n.daysLeft<0?e.jsxs("span",{style:{color:"red"},children:["Expired ",Math.abs(n.daysLeft)," day(s) ago"]}):e.jsxs("span",{children:["Predicted ",n.daysLeft,"d left"]})})]}):e.jsx("div",{className:"days-left",children:n.daysLeft===0?e.jsx("span",{children:"Expired today"}):n.daysLeft<0?e.jsxs("span",{style:{color:"red"},children:["Expired ",Math.abs(n.daysLeft)," day ago"]}):e.jsxs("span",{children:[n.daysLeft,"d left"]})})})]})]}),e.jsxs("div",{className:"right-section",children:[e.jsxs("span",{className:"item-quantity",children:[n.quantity," ",n.quantity_unit]}),e.jsx("span",{className:"inventory-tag",children:n.category}),e.jsx("span",{className:"dropdown-icon",onClick:()=>b(n.id),children:"▼"})]})]}),o===n.id&&e.jsxs("div",{className:"dropdown-box",children:[e.jsxs("div",{className:"date-purchased",children:[e.jsx("img",{src:"src/assets/images/date-icon.png",alt:"Calendar Icon",className:"date-icon"}),"Date Purchased: ",new Date(n.created_at).toISOString().split("T")[0]]}),!w&&e.jsx(e.Fragment,{children:["unit","pcs","can","box"].includes(n.quantity_unit)?e.jsxs("div",{className:"unit-controls",children:[e.jsx("button",{onClick:()=>p(n,1,s.id),className:"quantity-button",children:"-"}),e.jsx("div",{className:"quantity-container",children:e.jsx("div",{className:"quantity-box",children:n.quantity})}),e.jsx("button",{onClick:()=>p(n,-1,s.id),className:"quantity-button",children:"+"})]}):e.jsxs("div",{className:"portion-section",children:[e.jsxs("div",{className:"quantity-container",children:[e.jsx("input",{type:"number",value:n.quantity===null||n.quantity===void 0?"":n.quantity,onChange:C=>h(n,C.target.value===""?"":parseFloat(C.target.value)),className:"quantity-box",min:"0"}),e.jsxs("div",{className:"quantity-unit",children:["(",n.quantity_unit,")"]})]}),e.jsxs("div",{className:"used-amount-container",children:[e.jsx("label",{htmlFor:`used-amount-${n.id}`,children:"Used amount:"}),e.jsx("input",{type:"number",id:`used-amount-${n.id}`,className:"used-amount-input",value:y[n.id]||"",onChange:C=>l({...y,[n.id]:C.target.value})}),e.jsxs("div",{className:"quantity-unit",children:["(",n.quantity_unit,")"]}),e.jsx("img",{src:"src/assets/images/tick-icon.png",alt:"Confirm",className:"done-icon",onClick:()=>g(n)})]}),e.jsx("p",{children:"or"}),e.jsxs("div",{className:"portion-row",children:[e.jsx("p",{children:"Used portion:"}),e.jsx("div",{className:"portion-buttons",children:s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(n,n.quantity*.2,s.id),children:"1/5"}),e.jsx("button",{onClick:()=>p(n,n.quantity*.4,s.id),children:"2/5"}),e.jsx("button",{onClick:()=>p(n,n.quantity*.6,s.id),children:"3/5"}),e.jsx("button",{onClick:()=>p(n,n.quantity*.8,s.id),children:"4/5"})]}):e.jsx(Ue,{})})]})]})}),e.jsxs("div",{className:"nutritional-facts",children:[e.jsxs("h4",{children:["Nutritional Facts",e.jsx("img",{src:"src/assets/images/nutrition-facts-icon.png",alt:"Nutrition Icon",className:"nutrition-icon"})]}),e.jsxs("div",{className:"nutrition-details",children:[e.jsxs("p",{children:[e.jsx("span",{children:"Fat"}),e.jsx("span",{className:"dots",children:"..............................."}),e.jsx("span",{children:n.nutritionalInfo.fat})]}),e.jsxs("p",{children:[e.jsx("span",{children:"Protein"}),e.jsx("span",{className:"dots",children:".............................."}),e.jsx("span",{children:n.nutritionalInfo.protein})]}),e.jsxs("p",{children:[e.jsx("span",{children:"Calories"}),e.jsx("span",{className:"dots",children:"........................"}),e.jsxs("span",{children:[n.nutritionalInfo.calories,"kcal"]})]}),e.jsxs("p",{children:[e.jsx("span",{children:"Carbohydrate"}),e.jsx("span",{className:"dots",children:"......................."}),e.jsx("span",{children:n.nutritionalInfo.carbohydrate})]})]})]}),e.jsxs("div",{className:"storage-tips",children:[e.jsxs("h4",{children:["Storage Tips",e.jsx("img",{src:"src/assets/images/yellow-bulb-icon.png",alt:"Bulb Icon",className:"bulb-icon"})]}),e.jsx("p",{children:n.storageTips})]})]})]})},Ks="_scanContainer_1kvtp_1",Zs="_scanCard_1kvtp_7",er="_scannerContainer_1kvtp_11",tr="_scanner_1kvtp_11",nr="_loadingContainer_1kvtp_37",sr="_instructionText_1kvtp_42",nt={scanContainer:Ks,scanCard:Zs,scannerContainer:er,scanner:tr,loadingContainer:nr,instructionText:sr},rr=()=>{const[n,s]=t.useState(!0),[i,a]=t.useState(!1),[r,c]=t.useState(null),[y,l]=t.useState("environment"),h=ue();t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]),t.useEffect(()=>{(async()=>{const{data:{session:L},error:k}=await d.auth.getSession();if(k||!L){console.error("Auth error:",k),tt.error("Please login to use the scanner"),h("/login");return}c(L.user.id)})()},[h]);const p=async x=>{if(x&&!i)try{a(!0),console.log("Scan Result:",x);try{JSON.parse(x.text)}catch{throw new Error("Invalid QR code format. Expected JSON data.")}await b(x.text),tt.success("Item added to inventory successfully!"),s(!1),h("/inventory")}catch(L){console.error("Scan Error:",L),tt.error("Failed to process scan: "+L.message)}finally{a(!1)}},g=x=>{(x==null?void 0:x.name)!=="NotFoundException"&&(console.error("Camera Error:",x),(x==null?void 0:x.name)==="NotAllowedError"?tt.error("Please allow camera access to use the scanner"):(x==null?void 0:x.name)==="NotFoundError"?tt.error("No camera found on your device"):(x==null?void 0:x.name)==="NotReadableError"?tt.error("Unable to access camera. Please check if another app is using it"):tt.error("Error accessing camera: "+x.message))},o=()=>{l(x=>x==="environment"?"user":"environment")},b=async x=>{try{console.log("Raw QR Data:",x);const L=JSON.parse(x);if(console.log("Parsed Receipt Data:",L),L.store.name!=="SuperMart Grocery")throw new Error("Invalid receipt: Not from SuperMart Grocery");if(!r)throw new Error("User not authenticated");console.log("Current User ID:",r);const k=L.receipt.items.map(async m=>{const{data:_,error:N}=await d.from("ingredients").select("*").eq("id",m.id).single();if(N)throw console.error("Error fetching ingredient:",N),new Error(`Invalid ingredient ID: ${m.id}`);let w=null;_.pred_shelf_life&&(w=parseInt(_.pred_shelf_life));const C={user_id:r,ingredient_id:m.id,quantity:m.quantity,expiry_date_id:_.expiry_date_id,created_at:new Date().toISOString(),condition_id:1,days_left:w,init_quantity:m.quantity};console.log("Preparing to insert item:",C);const{data:G,error:u}=await d.from("inventory").insert(C).select();if(u)throw console.error("Supabase Error:",u),u;return console.log("Successfully added item:",G[0]),G[0]});return await Promise.all(k)}catch(L){throw console.error("Error adding items to inventory:",L),L}};return r?e.jsx("div",{className:nt.scanContainer,children:e.jsx(mn,{title:"Scan QR Code",className:nt.scanCard,children:e.jsx(_s,{direction:"vertical",style:{width:"100%"},children:i?e.jsxs("div",{className:nt.loadingContainer,children:[e.jsx(gn,{size:"large"}),e.jsx("p",{children:"Processing scan..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:nt.scannerContainer,children:e.jsx(bs,{delay:300,onError:g,onScan:p,constraints:{video:{facingMode:y}},style:{width:"100%",maxWidth:"500px"}})}),e.jsx("div",{style:{textAlign:"center",marginTop:"10px"},children:e.jsxs(Ns,{onClick:o,children:["Switch Camera (",y==="environment"?"Back":"Front",")"]})}),e.jsx("p",{className:nt.instructionText,children:"Hold your QR code steady in front of the camera. Make sure there's good lighting and the code is clear."})]})})})}):e.jsx("div",{className:nt.scanContainer,children:e.jsx(mn,{children:e.jsxs("div",{className:nt.loadingContainer,children:[e.jsx(gn,{size:"large"}),e.jsx("p",{children:"Checking authentication..."})]})})})},Dn=t.createContext(),st=()=>t.useContext(Dn),ir=({children:n})=>{const[s,i]=t.useState(null),[a,r]=t.useState([]),[c,y]=t.useState([]),[l,h]=t.useState([]),[p,g]=t.useState([]),[o,b]=t.useState([]),[x,L]=t.useState([]),[k,R]=t.useState([]),[m,_]=t.useState(1),[N,w]=t.useState({categories:[],tags:[],equipment:[],cookTime:null,ingredients:[]}),[C,G]=t.useState(!0),u=async()=>{try{const{data:H,error:V}=await d.auth.getUser();V?console.error("Error fetching user data:",V):(i(H==null?void 0:H.user),console.log("User data fetched:",H==null?void 0:H.user))}catch(H){console.error("Unexpected error fetching user data:",H)}},v=async()=>{G(!0);try{const{data:H,error:V}=await d.from("recipes").select(`
          id,
          name,
          description,
          prep_time,
          cook_time,
          image_path,
          recipe_tags:recipe_tags_recipe_id_fkey ( tags (name) ),
          recipe_equipment ( equipment (name) ),
          recipe_category ( category (name) ),
          recipe_ingredients ( ingredients (name) )
        `);if(V)console.error("Error fetching recipes:",V);else{const ce=H.map(ge=>{var je,O,pe,ve;return{...ge,tags:((je=ge.recipe_tags)==null?void 0:je.map(A=>A.tags.name))||[],equipment:((O=ge.recipe_equipment)==null?void 0:O.map(A=>A.equipment.name))||[],categories:((pe=ge.recipe_category)==null?void 0:pe.map(A=>A.category.name))||[],ingredients:((ve=ge.recipe_ingredients)==null?void 0:ve.map(A=>A.ingredients.name))||[]}});r(ce||[])}}catch(H){console.error("Unexpected error:",H)}finally{G(!1)}},D=async()=>{try{const{data:H,error:V}=await d.from("tags").select("id, name");V?console.error("Error fetching tags:",V):y(H||[])}catch(H){console.error("Unexpected error fetching tags:",H)}},j=async()=>{try{const{data:H,error:V}=await d.from("category").select("id, name");V?console.error("Error fetching categories:",V):h(H||[])}catch(H){console.error("Unexpected error fetching categories:",H)}},S=async()=>{try{const{data:H,error:V}=await d.from("equipment").select("id, name");V?console.error("Error fetching equipments:",V):g(H||[])}catch(H){console.error("Unexpected error fetching equipment:",H)}},M=async()=>{try{const{data:H,error:V}=await d.from("ingredients").select("id, name");V?console.error("Error fetching ingredients:",V):b(H||[])}catch(H){console.error("Unexpected error fetching ingredients:",H)}},Q=t.useCallback(async()=>{if(!s){console.error("User not logged in. Skipping fetchFavorites.");return}try{const{data:H,error:V}=await d.from("favorites").select("recipe_id").eq("user_id",s.id);if(V){console.error("Error fetching favorites:",V.message);return}console.log("Favorites fetched:",H),R(H.map(ce=>ce.recipe_id))}catch(H){console.error("Unexpected error fetching favorites:",H.message)}},[s]),ee=async(H,V)=>{var ce;try{const{data:ge,error:je}=await d.from("meal_plan").select("serving_packs").eq("planned_date",H).eq("meal_type_id",V);return je?(console.error("Error fetching pax:",je.message),null):((ce=ge==null?void 0:ge[0])==null?void 0:ce.serving_packs)||null}catch(ge){return console.error("Unexpected error in fetchPax:",ge.message),null}},F=H=>{w(V=>({...V,...H}))};t.useEffect(()=>{(async()=>{await u(),await Promise.all([v(),D(),j(),S(),M(),X()])})()},[]),t.useEffect(()=>{v()},[N]),t.useEffect(()=>{s&&Q()},[s,Q]);const T=async H=>{try{const{data:V,error:ce}=await d.from("recipe_ingredients").select(`
              ingredients (
                id,
                name,
                icon_path,
                nutritional_info,
                unit:quantity_unit_id (
                  unit_tag,
                  unit_description,
                  conversion_rate_to_grams 
                )
              ),
              quantity,
              recipe_id
            `).eq("recipe_id",H);if(ce)console.error("Error fetching recipe ingredients:",ce);else return V||[]}catch(V){return console.error("Unexpected error fetching recipe ingredients:",V),[]}},$=async H=>{try{const{data:V,error:ce}=await d.from("steps").select(`
                step_number,
                instruction
            `).eq("recipe_id",H).order("step_number",{ascending:!0});if(ce)console.error("Error fetching recipe steps:",ce);else return V||[]}catch(V){return console.error("Unexpected error fetching recipe steps:",V),[]}},U=async H=>{try{const{data:V,error:ce}=await d.from("meal_plan").select(`
              id,
              meal_type_id,
              recipe_id,
              notes,
              planned_date,
              meal_type:meal_type_id ( name ),
              meal_plan_status:status_id ( 
                id,
                name,
                description
              ),
              serving_packs
            `).eq("planned_date",H);if(ce)return console.error("Error fetching meal plans:",ce),[];const{data:ge,error:je}=await d.from("meal_type").select("id, name");if(je)return console.error("Error fetching meal types:",je),[];const O=ge.reduce((ve,A)=>(ve[A.id]=A.name,ve),{});return V.map(ve=>({...ve,meal_type_name:O[ve.meal_type_id]||"Unknown"}))}catch(V){return console.error("Unexpected error fetching meal plans:",V),[]}},X=async()=>{try{const{data:H,error:V}=await d.from("meal_type").select("*");V?console.error("Error fetching meal types:",V):L(H||[])}catch(H){console.error("Unexpected error fetching meal types:",H)}},q=async H=>{try{const{data:V,error:ce}=await d.from("recipes").select(`
              id,
              name,
              description,
              prep_time,
              cook_time,
              image_path,
              recipe_tags:recipe_tags_recipe_id_fkey ( tags (name) ),
              recipe_equipment ( equipment (name) ),
              recipe_category ( category (name) ),
              recipe_ingredients ( ingredients (name) )
            `).in("id",H);return ce?(console.error("Error fetching recipes by IDs:",ce),[]):V||[]}catch(V){return console.error("Unexpected error fetching recipes by IDs:",V),[]}},Y=async(H=null)=>{try{if(!s)return console.error("User not logged in. Cannot fetch inventory."),[];const V=d.from("inventory").select(`
          id,
          user_id,
          ingredient_id,
          quantity,
          expiry_date_id,
          freshness_status_id,
          init_quantity,
          condition:condition_id (
            id,
            condition
          ),
          days_left,
          expiry_date (
            id, 
            date
          ),
          freshness_status (
            id, 
            status_color
          ),
          ingredients (
            id,
            name,
            nutritional_info,
            unit:quantity_unit_id (
              unit_tag,
              unit_description,
              conversion_rate_to_grams 
            ),
            unitInv:quantity_unitInv_id (
              id,
              unitInv_tag,
              conversion_rate_to_grams_for_check
            )
          )
        `).eq("user_id",s.id).eq("condition_id",1).gt("days_left",0);H&&V.eq("ingredient_id",H);const{data:ce,error:ge}=await V;return ge?(console.error("Error fetching user inventory:",ge),[]):ce||[]}catch(V){return console.error("Unexpected error fetching user inventory:",V),[]}},P=async H=>{try{const{data:V,error:ce}=await d.from("inventory_meal_plan_status").select("id").eq("name",H).single();return ce||!V?(console.error("Error fetching status ID:",ce),null):V.id}catch(V){return console.error("Unexpected error fetching status ID:",V.message),null}},I=async H=>{try{const{data:V,error:ce}=await d.from("inventory_meal_plan").select("inventory_id, meal_plan_id, used_quantity, status_id").eq("meal_plan_id",H);return ce?(console.error("Error fetching inventory meal plan data:",ce),[]):V}catch(V){return console.error("Unexpected error fetching inventory meal plan data:",V.message),[]}},E=async H=>{try{const{data:V,error:ce}=await d.from("inventory_meal_plan").select(`
          inventory_id, 
          meal_plan_id, 
          meal_plan (
            recipe_id,
            meal_type_id,
            planned_date,
            meal_type:meal_type_id (
              name
            ),
            meal_plan_status:status_id (
              id,
              name,
              description
            ),
            serving_packs
          ),
          used_quantity, 
          status_id, 
          inventory_meal_plan_status (
            name,
            description
          ),
          inventory (
            ingredient_id,
            quantity,
            expiry_date:expiry_date_id(
              date
            ),
            days_left,
            freshness_status_id,
            init_quantity,
            condition:condition_id (
              id, 
              condition
            )
          ),
          ingredients (
            id,
            name,
            nutritional_info,
            unit:quantity_unit_id (
              unit_tag,
              unit_description,
              conversion_rate_to_grams 
            ),
            unitInv:quantity_unitInv_id (
              id,
              unitInv_tag,
              conversion_rate_to_grams_for_check
            )
          )
        `).in("meal_plan_id",H);return ce?(console.error("Error fetching inventory meal plan data by meal_plan_id:",ce),[]):V}catch(V){return console.error("Unexpected error fetching inventory meal plan data by meal_plan_id:",V.message),[]}},te=async(H,V,ce)=>{try{return await Promise.all(H.map(async ge=>{if(ge.meal_plan_id)return ge;const{data:je,error:O}=await d.from("meal_plan").select("id").eq("planned_date",ce).eq("recipe_id",V.recipe_id).limit(1).single();return O?(console.warn(`Failed to fetch meal plan for inventory ID: ${ge.id}`,O),{...ge,meal_plan_id:null}):{...ge,meal_plan_id:(je==null?void 0:je.id)||null}}))}catch(ge){return console.error("Error enriching inventory:",ge.message),[]}},ne=async({mealPlanIds:H=null,plannedDate:V=null})=>{try{let ce=d.from("inventory_meal_plan").select(`
        inventory_id,
        meal_plan_id,
        meal_plan (
          recipe_id,
          meal_type_id,
          planned_date,
          serving_packs
        ),
        used_quantity,
        status_id,
        inventory_meal_plan_status (name, description),
        inventory (
          ingredient_id,
          quantity,
          expiry_date:expiry_date_id (date),
          days_left,
          freshness_status_id,
          init_quantity,
          condition:condition_id (
            id,
            condition
          )
        ),
        ingredients (
          id,
          name,
          nutritional_info,
          unit:quantity_unit_id (unit_tag, unit_description, conversion_rate_to_grams),
          unitInv:quantity_unitInv_id (
              id,
              unitInv_tag,
              conversion_rate_to_grams_for_check
            )
        )
      `);if(H&&(ce=ce.in("meal_plan_id",H)),V&&!H){const{data:O,error:pe}=await d.from("meal_plan").select("id").eq("planned_date",V);if(pe)return console.error("Error fetching meal plans by planned date:",pe.message),[];const ve=(O==null?void 0:O.map(A=>A.id))||[];if(ve.length>0)ce=ce.in("meal_plan_id",ve);else return console.warn("No meal plans found for the given date."),[]}const{data:ge,error:je}=await ce;return je?(console.error("Error fetching inventory data:",je.message),[]):ge||[]}catch(ce){return console.error("Unexpected error fetching inventory data:",ce.message),[]}},oe=async H=>{if(!s){alert("Please log in to add favorites.");return}try{const{data:V,error:ce}=await d.from("favorites").select("id").eq("recipe_id",H).eq("user_id",s.id).single();if(ce&&ce.code!=="PGRST116"){console.error("Error checking favorite status:",ce.message);return}if(V){const{error:ge}=await d.from("favorites").delete().eq("id",V.id);if(ge){console.error("Error removing favorite:",ge.message);return}R(je=>je.filter(O=>O!==H))}else{const{error:ge}=await d.from("favorites").insert({recipe_id:H,user_id:s.id});if(ge){console.error("Error adding favorite:",ge.message);return}R(je=>[...je,H])}}catch(V){console.error("Unexpected error toggling favorite:",V.message)}};return e.jsx(Dn.Provider,{value:{userData:s,recipes:a,tags:c,categories:l,equipment:p,filters:N,ingredients:o,mealTypes:x,favorites:k,pax:m,fetchRecipes:v,fetchTags:D,fetchCategories:j,fetchEquipment:S,fetchIngredients:M,fetchRecipeIngredients:T,fetchRecipeSteps:$,fetchMealPlansByDate:U,fetchRecipesByIds:q,fetchUserInventory:Y,getStatusIdByName:P,fetchInventoryMealPlanData:I,fetchInventoryMealPlanByMealPlanId:E,enrichInventory:te,fetchInventoryData:ne,applyFilters:F,toggleFavorite:oe,fetchPax:ee,loading:C},children:n})},ar=()=>{const n=ue();return t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]),e.jsxs("div",{style:{padding:"20px"},children:[e.jsx("h1",{children:"Recipe Dashboard"}),e.jsx("p",{children:"Welcome to your Recipe Dashboard! Use the options below to navigate to different sections of your recipe module."}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsx("button",{onClick:()=>n("/recipes/explore"),style:{padding:"10px 20px",cursor:"pointer",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"5px"},children:"Explore Recipes"}),e.jsx("button",{onClick:()=>n("/recipes/favorites"),style:{padding:"10px 20px",cursor:"pointer",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"5px"},children:"View Favorites"}),e.jsx("button",{onClick:()=>n("/recipes/calendar"),style:{padding:"10px 20px",cursor:"pointer",backgroundColor:"#FFC107",color:"white",border:"none",borderRadius:"5px"},children:"Plan Your Meals"})]})]})},Le=()=>{const n=ue(),s=()=>{n(-1)};return e.jsx("button",{onClick:s,className:"back-button",children:"← Back"})},or=()=>{var ge,je;const{recipes:n,filters:s,applyFilters:i,loading:a,fetchRecipes:r,mealTypes:c,userData:y,favorites:l,toggleFavorite:h}=st(),[p,g]=t.useState([]),[o,b]=t.useState([]),[x,L]=t.useState([]),[k,R]=t.useState(""),[m,_]=t.useState(!1),[N,w]=t.useState(!1),[C,G]=t.useState(""),[u,v]=t.useState([]);t.useState([]);const[D,j]=t.useState(null),[S,M]=t.useState({notes:"",time:"",meal_type_id:"",planned_date:"",recipe_id:""}),Q=Je(),ee=ue(),{planned_date:F,meal_type_id:T,activity_type:$}=Q.state||{},U=((ge=c.find(O=>O.id===T))==null?void 0:ge.name)||"Unknown Meal Type",X=async()=>{try{const[{data:O,error:pe},{data:ve},{data:A}]=await Promise.all([d.from("category").select("id, name"),d.from("tags").select("id, name"),d.from("equipment").select("id, name")]);if(pe){console.error("Error fetching categories:",pe);return}g(O||[]),b(ve||[]),L(A||[])}catch(O){console.error("Error fetching filter options:",O)}},q=async O=>{if(!O.trim()){v([]);return}try{const{data:pe,error:ve}=await d.from("ingredients").select("name, icon_path").ilike("name",`%${O}%`);if(ve){console.error("Error fetching ingredients:",ve);return}console.log("Matching Ingredients:",pe),v(pe||[])}catch(pe){console.error("Unexpected error:",pe)}};t.useEffect(()=>{r(),X()},[]),t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]),t.useEffect(()=>{r()},[s]);const Y=n.filter(O=>{var ke;const pe=(ke=O.name)==null?void 0:ke.toLowerCase().includes(k.toLowerCase()),ve=s.categories.length?s.categories.some(Re=>(O.categories||[]).includes(Re)):!0,A=s.tags.length?s.tags.some(Re=>(O.tags||[]).includes(Re)):!0,he=s.equipment.length?s.equipment.some(Re=>(O.equipment||[]).includes(Re)):!0,we=s.cookTime?O.cook_time<=s.cookTime:!0,_e=s.ingredients.length?s.ingredients.every(Re=>(O.ingredients||[]).some(Te=>Te.toLowerCase()===Re.toLowerCase())):!0;return pe&&ve&&A&&he&&we&&_e}),P=O=>{s.ingredients.includes(O.name)||(i({ingredients:[...s.ingredients,O.name]}),v(pe=>({...pe,[O.name]:O.icon_path})))},I=O=>{i({ingredients:s.ingredients.filter(pe=>pe!==O)})},E=()=>{_(!1)},te=()=>s.categories.length===p.length&&s.tags.length===o.length&&s.equipment.length===x.length,ne=()=>s.categories.length>0||s.tags.length>0||s.equipment.length>0,oe=()=>{i({categories:p.map(O=>O.name),tags:o.map(O=>O.name),equipment:x.map(O=>O.name)})},H=()=>{i({categories:[],tags:[],equipment:[]})},V=async()=>{try{const{error:O}=await d.from("meal_plan").insert([{user_id:y.id,recipe_id:S.recipe_id,planned_date:S.planned_date,meal_type_id:S.meal_type_id,notes:S.notes,time:S.time,serving_packs:S.servingPacks}]);if(O){console.error("Error adding meal:",O.message);return}alert("Meal successfully added!"),j(null)}catch(O){console.error("Unexpected error adding meal:",O.message)}},ce=O=>{var ve;const pe=((ve=c.find(A=>A.id===T))==null?void 0:ve.default_time)||"12:00";M({notes:"",time:pe,meal_type_id:T,planned_date:F,recipe_id:O}),j(!0)};return a?e.jsx(Ue,{}):e.jsxs("div",{className:"explore-recipes-container",children:[e.jsx(Le,{}),e.jsx("h1",{className:"page-title",children:"Explore Recipes"}),F&&$&&T&&e.jsx("div",{className:"meal-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Scheduling for:"})," ",F," (",U,")"]})}),e.jsxs("div",{className:"search-container",children:[e.jsx("input",{type:"text",placeholder:"Search recipes...",value:k,onChange:O=>R(O.target.value),className:"search-input"}),e.jsx("button",{onClick:()=>_(!0),className:"filters-button",title:"Filter",children:e.jsx("svg",{viewBox:"0 0 512 512",height:"1em",children:e.jsx("path",{d:"M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z"})})})]}),e.jsx("div",{className:"recipes-list",children:Y.length>0?Y.map(O=>e.jsxs("div",{onClick:()=>ee(`/recipes/recipe/${O.id}`,{state:{planned_date:F,meal_type_id:T,recipe_id:O.id,recipe_name:O.name,activity_type:$}}),className:"recipe-card",children:[e.jsxs("div",{className:"image-container",children:[e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${O.image_path}`,alt:O.name,className:"recipe-image"}),e.jsx("button",{onClick:pe=>{pe.stopPropagation(),h(O.id)},className:"favorite-button",children:l.includes(O.id)?"❤️":"🤍"})]}),e.jsxs("div",{className:"recipe-details",children:[e.jsx("h3",{children:O.name}),e.jsx("p",{children:O.description}),e.jsxs("p",{children:["Prep Time: ",O.prep_time," mins"]}),e.jsxs("p",{children:["Cook Time: ",O.cook_time," mins"]}),F&&T&&e.jsx("button",{onClick:pe=>{pe.stopPropagation(),ce(O.id)},className:"add-to-meal-button",children:"Add to Meal"}),(O.tags||[]).length>0&&e.jsxs("div",{className:"tags-container",children:[e.jsx("strong",{children:"Tags:"}),O.tags.map((pe,ve)=>e.jsx("span",{className:"tag",children:pe},ve))]}),(O.equipment||[]).length>0&&e.jsxs("div",{className:"equipment-container",children:[e.jsx("strong",{children:"Equipment:"}),O.equipment.map((pe,ve)=>e.jsx("span",{className:"equipment",children:pe},ve))]})]})]},O.id)):e.jsx("p",{className:"no-recipes",children:"No recipes found."})}),m&&e.jsxs("div",{className:"filter-overlay",children:[e.jsx("button",{className:"close-button",onClick:()=>_(!1),children:"X"}),e.jsx("h2",{className:"filter-title",children:"Filter Options"}),e.jsxs("div",{className:"filter-content",children:[!ne()&&e.jsx("button",{onClick:oe,className:"select-all-button",children:"Select All"}),ne()&&!te()&&e.jsxs("div",{className:"filter-buttons",children:[e.jsx("button",{onClick:H,className:"clear-button",children:"Clear"}),e.jsx("button",{onClick:oe,className:"select-all-button",children:"Select All"})]}),te()&&e.jsx("button",{onClick:H,className:"deselect-all-button",children:"Deselect All"})]}),e.jsxs("div",{className:"scrollable-content",children:[e.jsx("button",{onClick:()=>w(!0),className:"add-ingredient-button",children:"+ Search Recipe by Ingredient"}),e.jsxs("div",{className:"selected-ingredients",children:[e.jsx("h3",{children:"Selected Ingredients:"}),s.ingredients.length>0?s.ingredients.map((O,pe)=>e.jsxs("div",{className:"ingredient-item",children:[e.jsx("span",{children:O}),e.jsx("button",{onClick:()=>I(O),className:"remove-ingredient-button",children:"X"})]},pe)):e.jsx("p",{children:"No ingredients selected."})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("h3",{children:"Category"}),p.map(O=>e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.categories.includes(O.name),onChange:pe=>{const ve=pe.target.checked;i({...s,categories:ve?[...s.categories,O.name]:s.categories.filter(A=>A!==O.name)})}}),O.name]},O.id))]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("h3",{children:"Tags"}),o.map(O=>e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.tags.includes(O.name),onChange:pe=>{const ve=pe.target.checked;i({...s,tags:ve?[...s.tags,O.name]:s.tags.filter(A=>A!==O.name)})}}),O.name]},O.id))]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("h3",{children:"Equipment"}),x.map(O=>e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.equipment.includes(O.name),onChange:pe=>{const ve=pe.target.checked;i({...s,equipment:ve?[...s.equipment,O.name]:s.equipment.filter(A=>A!==O.name)})}}),O.name]},O.id))]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("h3",{children:"Cooking Time"}),e.jsxs("select",{className:"cook-time-dropdown",value:s.cookTime||"",onChange:O=>i({...s,cookTime:O.target.value?Number(O.target.value):null}),children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"15",children:"Less than 15 mins"}),e.jsx("option",{value:"30",children:"Less than 30 mins"}),e.jsx("option",{value:"60",children:"Less than 60 mins"})]})]})]}),e.jsx("button",{onClick:E,className:"apply-filters-button",children:"Apply Filters"})]}),N&&e.jsxs("div",{className:"ingredient-overlay",children:[e.jsx("button",{onClick:()=>w(!1),className:"close-overlay-button",children:"X"}),e.jsx("h2",{children:"Search Ingredients"}),e.jsx("div",{className:"search-bar",children:e.jsx("input",{type:"text",placeholder:"Type an ingredient...",value:C,onChange:O=>{G(O.target.value),q(O.target.value)}})}),e.jsx("div",{className:"matching-ingredients",children:u.length>0?u.map((O,pe)=>e.jsxs("div",{className:"ingredient-item",onClick:()=>P(O),children:[e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${O.icon_path}`,alt:O.name,className:"ingredient-icon"}),e.jsx("span",{children:O.name})]},pe)):e.jsx("p",{children:"No matching ingredients found."})}),e.jsxs("div",{className:"selected-ingredients",children:[e.jsx("h3",{children:"Selected Ingredients:"}),s.ingredients.length>0?s.ingredients.map((O,pe)=>e.jsxs("div",{className:"ingredient-item",children:[e.jsx("span",{children:O}),e.jsx("button",{onClick:()=>I(O),className:"remove-ingredient-button",children:"X"})]},pe)):e.jsx("p",{children:"No ingredients selected."})]}),e.jsx("button",{onClick:()=>w(!1),className:"find-recipes-button",children:"Find Recipes"})]}),D&&e.jsx("div",{className:"favorite-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Add a Meal"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Meal Type:"})," ",((je=c.find(O=>O.id===S.meal_type_id))==null?void 0:je.name)||"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Planned Date:"})," ",S.planned_date]}),e.jsxs("div",{className:"serving-adjuster",children:[e.jsx("strong",{children:"Serving Packs:"}),e.jsxs("div",{className:"adjuster-buttons",children:[e.jsx("button",{onClick:()=>M(O=>({...O,servingPacks:Math.max(1,(O.servingPacks||1)-1)})),className:"adjust-serving-button",children:"-"}),e.jsx("span",{className:"serving-count",children:S.servingPacks||1}),e.jsx("button",{onClick:()=>M(O=>({...O,servingPacks:(O.servingPacks||1)+1})),className:"adjust-serving-button",children:"+"})]})]}),e.jsxs("label",{children:["Notes:",e.jsx("textarea",{value:S.notes,placeholder:"Enter additional notes (e.g., extra ingredients, instructions)",onChange:O=>M(pe=>({...pe,notes:O.target.value})),rows:"3"})]}),e.jsxs("label",{children:["Time:",e.jsx("input",{type:"time",value:S.time,onChange:O=>M(pe=>({...pe,time:O.target.value}))})]}),e.jsx("button",{onClick:V,className:"save-meal-button",children:"Save"}),e.jsx("button",{onClick:()=>j(null),className:"cancel-button",children:"Cancel"})]})})]})},cr=()=>{var we,_e,ke,Re,Te,Oe,gt,Ke,it,$e;const{recipes:n,fetchRecipeIngredients:s,fetchRecipeSteps:i,mealTypes:a,userData:r,favorites:c,toggleFavorite:y}=st(),{id:l}=Ee(),h=ue(),[p,g]=t.useState(null),[o,b]=t.useState([]),[x,L]=t.useState([]),[k,R]=t.useState(!0),[m,_]=t.useState(!1),[N,w]=t.useState(0),[C,G]=t.useState(null);t.useState([]);const[u,v]=t.useState(2),[D,j]=t.useState(1),[S,M]=t.useState({calories:0,protein:0,carbohydrate:0,fat:0}),[Q,ee]=t.useState(0),T=Je().state,[$,U]=t.useState(null),[X,q]=t.useState({notes:"",time:"",meal_type_id:"",planned_date:"",recipe_id:""}),[Y,P]=t.useState(!1),[I,E]=t.useState("ingredients");t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]),t.useEffect(()=>{(async()=>{const xe=n.find(Fe=>Fe.id===parseInt(l));if(xe){g(xe);const Fe=await s(xe.id);b(Fe),te(Fe);const Ge=await i(xe.id);if(L(Ge),r)try{const{data:Me,error:at}=await d.from("favorites").select("id").eq("recipe_id",xe.id).eq("user_id",r.id).single();!at&&Me&&P(!0)}catch(Me){console.error("Error checking favorite status:",Me.message)}}else g(null);R(!1)})()},[l,n,s,i,r]);const te=ie=>{let xe={calories:0,protein:0,carbohydrate:0,fat:0},Fe=0;ie.forEach(Me=>{const{nutritional_info:at,unit:xt}=Me.ingredients,{quantity:bt}=Me;let{calories:_t,protein:Ve,carbohydrate:We,fat:Ye}=at;Ve=typeof Ve=="string"?parseFloat(Ve.replace("g",""))||0:Ve||0,We=typeof We=="string"?parseFloat(We.replace("g",""))||0:We||0,Ye=typeof Ye=="string"?parseFloat(Ye.replace("g",""))||0:Ye||0;const ot=xt.conversion_rate_to_grams;let ct=bt;if(ot&&ot>0)ct*=ot;else{console.warn(`Unit ${xt.unit_tag} does not have a valid conversion rate.`);return}Fe+=ct;const rt=ct/100;xe.calories+=_t*rt,xe.protein+=Ve*rt,xe.carbohydrate+=We*rt,xe.fat+=Ye*rt}),ee(Fe);const Ge={calories:(xe.calories/(Fe/100)).toFixed(2),protein:(xe.protein/(Fe/100)).toFixed(2),carbohydrate:(xe.carbohydrate/(Fe/100)).toFixed(2),fat:(xe.fat/(Fe/100)).toFixed(2)};M({total:{calories:xe.calories.toFixed(2),protein:xe.protein.toFixed(2),carbohydrate:xe.carbohydrate.toFixed(2),fat:xe.fat.toFixed(2)},per100g:Ge})},ne=()=>{if(m)G(N);else if(C!==null){const ie=window.confirm("Would you like to continue from your last step or start over?");w(ie?C:0)}else w(0);_(ie=>!ie)},oe=()=>{if(N<x.length-1){const ie=N+1;w(ie),console.log(`Now on Step ${ie+1}: ${x[ie].instruction}`)}},H=()=>{if(N>0){const ie=N-1;w(ie),console.log(`Now on Step ${ie+1}: ${x[ie].instruction}`)}},V=()=>{alert("Congratulations! You have finished cooking this recipe."),_(!1),G(null)},ce=()=>{navigator.clipboard.writeText(window.location.href),alert("Recipe link copied to clipboard!")};if(!p)return e.jsx("div",{children:"Recipe not found!"});const ge=()=>v(ie=>ie+1),je=()=>{u>1&&v(ie=>ie-1)},O=()=>{const ie=u/D;return console.log("Test ingredients:",o),o.map(xe=>({...xe,quantity:(xe.quantity*ie).toFixed(2)}))};if(k)return e.jsx(Ue,{});if(!p)return e.jsx("div",{children:"Recipe not found!"});const pe=async()=>{if(!T)return;const{planned_date:ie,meal_type_id:xe,recipe_id:Fe}=T;if(window.confirm("Are you sure you want to cancel this scheduled recipe?"))try{const{error:Me}=await d.from("meal_plan").delete().eq("planned_date",ie).eq("meal_type_id",xe).eq("recipe_id",Fe);if(Me){console.error("Error canceling schedule:",Me.message);return}alert("Schedule canceled successfully."),h(-1)}catch(Me){console.error("Unexpected error:",Me.message)}},ve=a.reduce((ie,xe)=>(ie[xe.id]=xe.name,ie),{}),A=async()=>{try{const{error:ie}=await d.from("meal_plan").insert([{user_id:r.id,recipe_id:X.recipe_id,planned_date:X.planned_date,meal_type_id:X.meal_type_id,notes:X.notes,time:X.time,serving_packs:X.servingPacks||1}]);if(ie){console.error("Error adding meal:",ie.message);return}alert("Meal successfully added!"),U(null)}catch(ie){console.error("Unexpected error adding meal:",ie.message)}},he=ie=>{var Fe;const xe=((Fe=a.find(Ge=>Ge.id===T.meal_type_id))==null?void 0:Fe.default_time)||"12:00";q({notes:"",time:xe,meal_type_id:(T==null?void 0:T.meal_type_id)||"",planned_date:(T==null?void 0:T.planned_date)||"",recipe_id:ie}),U(!0)};return e.jsxs("div",{className:"recipe-details-container",children:[e.jsxs("section",{className:"recipe-image-detail-section",children:[e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${p.image_path}`,alt:p.name,className:"recipe-detail-image"}),e.jsxs("div",{className:"image-overlay",children:[e.jsx(Le,{}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:ce,className:"share-button",children:"Share"}),e.jsx("button",{onClick:ie=>{ie.stopPropagation(),y(p.id)},className:"favorite-button",children:c.includes(p.id)?"❤️":"🤍"})]})]})]}),e.jsxs("div",{className:"recipe-detail-lower-section",children:[e.jsxs("section",{className:"recipe-details",children:[e.jsx("h2",{className:"recipe-detail-title",children:p.name}),e.jsx("p",{className:"recipe-description",children:p.description}),e.jsxs("div",{className:"left-right-space-evenly-section",children:[e.jsxs("p",{className:"prep-time",children:["Prep Time: ",p.prep_time," mins"]}),e.jsxs("p",{className:"cook-time",children:["Cook Time: ",p.cook_time," mins"]})]}),e.jsx("div",{className:"total-meal-weight",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Total Meal Weight: "}),(Q*(u/D)).toFixed(2)," g"]})})]}),e.jsxs("section",{className:"nutrition-facts",children:[e.jsx("h3",{children:"Nutrition Facts"}),e.jsxs("div",{className:"nutrition-content",children:[e.jsxs("div",{className:"total-nutrition",children:[e.jsx("h4",{children:"Total Nutrition"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Calories: ",((we=S.total)==null?void 0:we.calories)||0," kcal"]}),e.jsxs("li",{children:["Protein: ",((_e=S.total)==null?void 0:_e.protein)||0," g"]}),e.jsxs("li",{children:["Carbohydrate: ",((ke=S.total)==null?void 0:ke.carbohydrate)||0," g"]}),e.jsxs("li",{children:["Fats: ",((Re=S.total)==null?void 0:Re.fat)||0," g"]})]})]}),e.jsxs("div",{className:"per-100g-nutrition",children:[e.jsx("h4",{children:"Per 100g"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Calories: ",((Te=S.per100g)==null?void 0:Te.calories)||0," kcal"]}),e.jsxs("li",{children:["Protein: ",((Oe=S.per100g)==null?void 0:Oe.protein)||0," g"]}),e.jsxs("li",{children:["Carbohydrate: ",((gt=S.per100g)==null?void 0:gt.carbohydrate)||0," g"]}),e.jsxs("li",{children:["Fats: ",((Ke=S.per100g)==null?void 0:Ke.fat)||0," g"]})]})]})]})]}),e.jsxs("div",{className:"radio-inputs",children:[e.jsxs("label",{className:"radio",children:[e.jsx("input",{type:"radio",name:"toggle",checked:I==="ingredients",onChange:()=>E("ingredients")}),e.jsx("span",{className:"name",children:"Ingredients"})]}),e.jsxs("label",{className:"radio",children:[e.jsx("input",{type:"radio",name:"toggle",checked:I==="steps",onChange:()=>E("steps")}),e.jsx("span",{className:"name",children:"Steps"})]})]}),I==="ingredients"&&e.jsxs("section",{className:"ingredients-section",children:[e.jsx("h3",{children:"Ingredients"}),e.jsxs("section",{className:"serving-adjuster",children:[e.jsx("h4",{children:"Serving Packs"}),e.jsx("button",{onClick:je,className:"adjust-serving-button",children:"-"}),e.jsx("span",{className:"serving-count",children:u}),e.jsx("button",{onClick:ge,className:"adjust-serving-button",children:"+"})]}),e.jsxs("section",{className:"ingredients-section",children:[e.jsxs("h3",{children:["Ingredients List (",O().length," item(s))"]}),e.jsx("ul",{className:"ingredients-list",children:O().map(ie=>{var xe;return e.jsxs("li",{className:"ingredient-item",children:[console.log("ingredient:",ie),e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${ie.ingredients.icon_path}`,alt:ie.ingredients.name,className:"ingredient-image"}),e.jsxs("span",{children:[ie.ingredients.name," - ",ie.quantity," ",((xe=ie.ingredients.unit)==null?void 0:xe.unit_tag)||""]})]},ie.ingredients.id)})})]})]}),I==="steps"&&e.jsxs("section",{className:"steps-section",children:[e.jsx("h3",{children:"Steps"}),e.jsx("ul",{className:"steps-list",children:x.map(ie=>e.jsxs("li",{className:"step-item",children:[e.jsxs("strong",{children:[ie.step_number,":"]})," ",ie.instruction]},ie.step_number))})]}),console.log("Schedule Data:",T),T.activity_type?e.jsx(e.Fragment,{children:(T==null?void 0:T.activity_type)==="view"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:pe,className:"button cancel-schedule-button ",onMouseEnter:ie=>ie.target.classList.add("cancel-schedule-hover"),onMouseLeave:ie=>ie.target.classList.remove("cancel-schedule-hover"),children:[e.jsx("span",{className:"cancel-icon ",children:"✖"}),"Cancel Schedule for "," ",new Date(T.planned_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," "," ","(",ve[T.meal_type_id]||"Unknown",")"]}),e.jsx("button",{onClick:()=>h("/recipes/calendar",{state:{recipeId:l,recipeName:p.name}}),className:"button reschedule-another-button",children:"Reschedule Another Meal"})]}):e.jsx("button",{onClick:ie=>{ie.stopPropagation(),he(p.id)},className:"button add-meal-button",children:"Add to Meal"})}):e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>h("/recipes/calendar",{state:{recipeId:l,recipeName:p.name,servingPacks:u}}),className:"button reschedule-button floating-down",children:"Reschedule"})}),m&&e.jsxs("section",{className:"cooking-mode-overlay",children:[e.jsxs("h2",{children:["Step ",N+1]}),e.jsx("p",{children:(it=x[N])==null?void 0:it.instruction}),e.jsxs("div",{className:"cooking-mode-controls",children:[e.jsx("button",{onClick:H,className:"previous-step-button",disabled:N===0,children:"Previous"}),e.jsx("button",{onClick:oe,className:"next-step-button",disabled:N===x.length-1,children:"Next"}),N===x.length-1&&e.jsx("button",{onClick:V,className:"finish-cooking-button",children:"Finish Cooking"}),e.jsx("button",{onClick:ne,className:"exit-cooking-mode-button",children:"Exit Cooking Mode"})]})]}),$&&e.jsx("div",{className:"favorite-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Add a Meal"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Meal Type:"})," ",(($e=a.find(ie=>ie.id===X.meal_type_id))==null?void 0:$e.name)||"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Planned Date:"})," ",X.planned_date]}),e.jsxs("div",{className:"serving-adjuster",children:[e.jsx("strong",{children:"Serving Packs:"}),e.jsxs("div",{className:"adjuster-buttons",children:[e.jsx("button",{onClick:()=>q(ie=>({...ie,servingPacks:Math.max(1,(ie.servingPacks||1)-1)})),className:"adjust-serving-button",children:"-"}),e.jsx("span",{className:"serving-count",children:u||1}),e.jsx("button",{onClick:()=>q(ie=>({...ie,servingPacks:(ie.servingPacks||1)+1})),className:"adjust-serving-button",children:"+"})]})]}),e.jsxs("label",{children:["Notes:",e.jsx("textarea",{value:X.notes,placeholder:"Enter additional notes (e.g., extra ingredients, instructions)",onChange:ie=>q(xe=>({...xe,notes:ie.target.value})),rows:"3",className:"notes-textarea"})]}),e.jsxs("label",{children:["Time:",e.jsx("input",{type:"time",value:X.time,onChange:ie=>q(xe=>({...xe,time:ie.target.value})),className:"time-input"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:A,className:"save-button",children:"Save"}),e.jsx("button",{onClick:()=>U(null),className:"cancel-button",children:"Cancel"})]})]})})]})]})},lr=()=>{const[n,s]=t.useState(new Date),[i,a]=t.useState(!1),[r,c]=t.useState(null),[y,l]=t.useState([]),h=ue();t.useRef(null);const p=Je(),{userData:g}=st(),{recipeId:o,recipeName:b,servingPacks:x}=p.state||{},L=async()=>{const{data:m,error:_}=await d.from("meal_plan").select("*").eq("user_id",g.id);if(_){console.error("Error fetching data:",_);return}const N={};m.forEach(C=>{const{planned_date:G,meal_type_id:u,status_id:v}=C;N[G]||(N[G]={breakfast:null,lunch:null,dinner:null,others:null});const j={1:"breakfast",2:"lunch",3:"dinner",4:"others"}[u];N[G][j]=v});const w=Object.entries(N).map(([C,G])=>{const u=Object.values(G),v=u.filter(Q=>Q===null).length,D=u.filter(Q=>Q===2).length,j=u.filter(Q=>Q===1).length,S=G.others!==null?4:3,M=G.others!==null;return console.log(`Date: ${C}`),console.log("Meals:",G),console.log(`No Plan: ${v}, Complete: ${D}, Planning: ${j}, Total Meals: ${S}`),{date:C,noPlan:v,complete:D,planning:j,totalMeals:S,hasOthersMeal:M}});console.log("Processed data:",w),l(w)};t.useEffect(()=>{L()},[]),t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]);const k=m=>{const _=wt(m,"yyyy-MM-dd");h(`/recipes/calendar/${_}`,{state:{recipeId:o,recipeName:b,servingPacks:x}})},R=({date:m})=>{const _=new Date,N=wt(m,"yyyy-MM-dd");if(m.toDateString()===_.toDateString())return"today-date";const C=y.find(G=>G.date===N);if(C&&C.totalMeals===3&&C.noPlan===3&&m<_)return"no-plan-past-date";if(m>_)return C&&C.planning>0?"future-date-planned":"future-date";if(C){if(C.complete===3&&C.hasOthersMeal===!1)return"complete-date";if(C.noPlan===0){if(C.totalMeals===4&&C.complete===4)return"complete-date others-complete"}else if(C.complete>0)return"partial-complete-date"}return m>_?"coming-date":"past-date"};return e.jsxs("div",{className:"calendar-container",children:[e.jsxs("header",{className:"calendar-header",children:[e.jsx(Le,{}),e.jsx("div",{className:"date-display",children:o&&b&&e.jsx("div",{className:"recipe-calender-details",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Recipe to Schedule:"})," ",b," (",x," pax)"]})})})]}),e.jsx("h1",{children:"Calendar"}),e.jsx(ws,{onChange:m=>s(m),value:n,tileClassName:R,locale:"en-US",onClickDay:m=>k(m),tileContent:({date:m})=>{const _=wt(m,"yyyy-MM-dd"),N=y.find(w=>w.date===_);if(N){const w=N.totalMeals-(N.hasOthersMeal?N.noPlan:N.noPlan-1),C=N.complete;return w===0?e.jsx("div",{className:"tile-content no-plan-past-date"}):e.jsx("div",{className:"tile-content",children:e.jsxs("span",{children:["(",C,"/",w,")"]})})}return e.jsx("div",{className:"tile-content"})}}),i&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("h2",{children:["Details for ",r]}),e.jsx("button",{onClick:()=>a(!1),children:"Close"})]})})]})},dr=()=>{var Y,P;const{date:n}=Ee(),s=ue(),i=Je(),{userData:a,fetchMealPlansByDate:r,fetchRecipesByIds:c,mealTypes:y}=st(),[l,h]=t.useState([]),[p,g]=t.useState(!0),[o,b]=t.useState({}),[x,L]=t.useState({}),[k,R]=t.useState(null),[m,_]=t.useState({show:!1,mealTypeId:null}),[N,w]=t.useState(!1),[C,G]=t.useState(!1),{recipeId:u,recipeName:v,date:D,servingPacks:j}=i.state||{};console.log("Recipe ID:",u),console.log("Recipe Name:",v),console.log("Date:",n),console.log("Passed Date:",D);const[S,M]=t.useState({notes:"",time:"",meal_type_id:""});t.useEffect(()=>{(async()=>{g(!0);try{const E=await r(n),te=E.map(V=>V.recipe_id),ne=await c(te),oe=E.map(V=>({...V,recipe:ne.find(ce=>ce.id===V.recipe_id)}));console.log("Enriched Meal Plans:",oe),h(oe);const H={};y.forEach(V=>{const ce=oe.filter(ge=>ge.meal_type_name===V.name);H[V.name]=Q(ce)}),L(H)}catch(E){console.error("Error fetching meal plans or recipes:",E.message)}finally{g(!1)}})()},[n,r,c,y,N]);const Q=I=>{var te;return I.length===0?null:I.length===1?`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${(te=I[0].recipe)==null?void 0:te.image_path}`:I.slice(0,2).map(ne=>{var oe;return`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${(oe=ne.recipe)==null?void 0:oe.image_path}`})},ee=I=>{b(E=>({...E,[I]:!E[I]}))},F=async(I,E,te)=>{if(window.confirm("Are you sure you want to cancel this meal?"))try{const{error:oe}=await d.from("meal_plan").delete().eq("planned_date",I).eq("recipe_id",E).eq("meal_type_id",te);if(oe){console.error("Error deleting meal:",oe.message);return}h(H=>H.filter(V=>V.planned_date!==I||V.recipe_id!==E||V.meal_type_id!==te)),console.log(`Meal with date: ${I}, recipe_id: ${E}, meal_type_id: ${te} deleted successfully.`)}catch(oe){console.error("Unexpected error deleting meal:",oe.message)}},T=async()=>{try{const{error:I}=await d.from("meal_plan").insert([{user_id:a.id,recipe_id:u,planned_date:D||n,meal_type_id:k,notes:S.notes,time:S.time,serving_packs:j}]);if(console.log("Adding meal..."),console.log("Recipe ID:",u),console.log("Planned Date:",D),console.log("Meal Type ID:",k),console.log("Notes:",S.notes),console.log("Time:",S.time),console.log("User ID:",a.id),console.log("Date:",n),console.log("Passed Date:",D),console.log("Serving Packs:",j),I){console.error("Error adding meal:",I.message);return}h(E=>[...E,{recipe_id:u,planned_date:D||n,meal_type_id:k,notes:S.notes,time:S.time,serving_packs:j}]),R(null),w(E=>!E),G(!0)}catch(I){console.error("Unexpected error adding meal:",I.message)}},$=()=>{G(!1),s("/recipes/explore")},U=()=>{G(!1)},X=I=>{const E=y.find(ne=>ne.id===I),te=(E==null?void 0:E.default_time)||"12:00";M(ne=>({...ne,meal_type_id:I,time:te})),R(I)},q=(I,E)=>{s(`/recipes/${I==="favorites"?"favorites":"explore"}`,{state:{planned_date:n,meal_type_id:m.mealTypeId,activity_type:E}}),_({show:!1,mealTypeId:null})};return p?e.jsx(Ue,{}):e.jsxs("div",{className:"meal-planner-container",children:[e.jsxs("header",{className:"meal-planner-header",children:[e.jsx(Le,{}),e.jsx("div",{className:"date-display",children:e.jsx("p",{children:n})})]}),u&&v&&e.jsx("div",{className:"recipe-calender-details",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Recipe to Schedule:"})," ",v," (",j," pax)"]})}),y.map(I=>{const E=l.filter(ne=>ne.meal_type_name===I.name),te=E.length>0;return e.jsxs("div",{className:"meal-section",children:[e.jsxs("div",{className:"meal-section-header",children:[e.jsxs("div",{className:`meal-header-image ${te?Array.isArray(x[I.name])?"split-images":"full-image":"no-image"}`,children:[te?Array.isArray(x[I.name])?e.jsxs("div",{className:"split-images",children:[e.jsx("img",{src:x[I.name][0],alt:"Meal 1",className:"meal-image-left"}),e.jsx("img",{src:x[I.name][1],alt:"Meal 2",className:"meal-image-right"})]}):e.jsx("img",{src:x[I.name],alt:"Single Meal",className:"meal-full-image"}):e.jsx("div",{className:"no-meal-placeholder",children:e.jsxs("p",{children:["No meals planned for ",I.name,"."]})}),e.jsxs("div",{className:"meal-title-overlay",children:[e.jsx("h2",{children:I.name}),e.jsxs("div",{className:"meal-section-controls",children:[e.jsx("button",{onClick:()=>u?X(I.id):_({show:!0,mealTypeId:I.id}),className:"action-button",children:u?"Add Here":"Schedule Meal"}),te&&e.jsx("button",{onClick:()=>s(`/recipes/calendar/preparation/${n}`,{state:{planned_date:n,meal_type_id:I.id}}),className:"view-details-button",children:"View Details"})]})]})]}),e.jsx("span",{onClick:()=>ee(I.name),className:"toggle-section-button",children:o[I.name]?"▲":"▼"})]}),o[I.name]&&te&&e.jsx("div",{className:"meal-list",children:E.map((ne,oe)=>{var H,V,ce;return e.jsxs("div",{className:"meal-item",children:[e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${((H=ne.recipe)==null?void 0:H.image_path)||"path/to/default/image.jpg"}`,alt:((V=ne.recipe)==null?void 0:V.name)||"Meal Image",className:"meal-image",onClick:()=>{var ge;return s(`/recipes/recipe/${((ge=ne.recipe)==null?void 0:ge.id)||""}`,{state:{planned_date:ne.planned_date,meal_type_id:ne.meal_type_id,recipe_id:ne.recipe_id,activity_type:"view"}})}}),e.jsxs("div",{className:"meal-overlay",children:[e.jsx("span",{className:"meal-name",children:((ce=ne.recipe)==null?void 0:ce.name)||"Unknown Recipe"}),e.jsx("p",{className:"meal-notes",children:ne.notes}),e.jsx("button",{onClick:ge=>{ge.stopPropagation(),F(ne.planned_date,ne.recipe_id,ne.meal_type_id)},className:"cancel-meal-button",children:"Cancel"})]})]},oe)})}),o[I.name]&&!te&&e.jsx("div",{className:"no-meal-message",children:e.jsxs("p",{children:["No meals added for ",I.name,'. Click "Schedule Meal" to start planning!']})})]},I.id)}),k&&e.jsx("div",{className:"calender-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Add a Meal"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Recipe:"})," ",v]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Meal Type:"})," ",((Y=y.find(I=>I.id===k))==null?void 0:Y.name)||"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",D||n]}),e.jsxs("div",{className:"serving-adjuster",children:[e.jsx("strong",{children:"Serving Packs:"}),e.jsxs("div",{className:"serving-adjuster",children:[e.jsx("button",{onClick:()=>M(I=>({...I,servingPacks:Math.max(1,(I.servingPacks||1)-1)})),className:"adjust-serving-button",children:"-"}),e.jsx("span",{className:"serving-count",children:j||1}),e.jsx("button",{onClick:()=>M(I=>({...I,servingPacks:(I.servingPacks||1)+1})),className:"adjust-serving-button",children:"+"})]})]}),e.jsxs("label",{children:["Notes:",e.jsx("textarea",{value:S.notes,placeholder:"Enter additional notes (e.g., extra ingredients, instructions)",onChange:I=>M(E=>({...E,notes:I.target.value})),rows:"3",className:"notes-textarea"})]}),e.jsxs("label",{children:["Time:",e.jsx("input",{type:"time",value:S.time,onChange:I=>M(E=>({...E,time:I.target.value})),className:"time-input"})]}),e.jsx("button",{onClick:T,className:"save-button",children:"Save"}),e.jsx("button",{onClick:()=>R(null),className:"cancel-button",children:"Cancel"})]})}),m.show&&e.jsx("div",{className:"calender-modal",children:e.jsxs("div",{className:"navigation-modal-content",children:[e.jsx("h2",{children:"Schedule Meal"}),e.jsxs("p",{children:["Would you like to schedule a meal for ",e.jsx("strong",{children:(P=y.find(I=>I.id===m.mealTypeId))==null?void 0:P.name})," from your favorites or all recipes?"]}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:()=>q("favorites","add"),className:"modal-button favorites-button",children:"Favorites"}),e.jsx("button",{onClick:()=>q("all","add"),className:"modal-button all-recipes-button",children:"All Recipes"})]}),e.jsx("button",{onClick:()=>_({show:!1,mealTypeId:null}),className:"modal-close-button",children:"Cancel"})]})}),C&&e.jsx("div",{className:"navigation-modal-overlay",children:e.jsxs("div",{className:"navigaton-modal",children:[e.jsx("p",{children:"Meal Added Successfully! Would you like to navigate to the Recipe Explore page or continue adding meals?"}),e.jsxs("div",{className:"left-right-space-evenly-section",children:[e.jsx("button",{className:"yes-no-button",onClick:()=>$(),children:"Back to Explore"}),e.jsx("button",{className:"yes-no-button",onClick:()=>U(),children:"Add More Meals"})]})]})})]})},ur=({id:n,recipe:s})=>{const{attributes:i,listeners:a,setNodeRef:r,transform:c,transition:y}=vn({id:n}),l={transform:bn.Transform.toString(c),transition:y,padding:"10px",border:"1px solid #ccc",borderRadius:"5px",marginBottom:"10px",background:"#f9f9f9",display:"flex",alignItems:"center"};return e.jsxs("li",{ref:r,style:l,...i,children:[e.jsx("span",{...a,style:{cursor:"grab",fontSize:"20px",marginRight:"10px",touchAction:"none"},className:"drag-handle",children:"☰"}),e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${s.image_path}`,alt:s.name,style:{width:"50px",height:"50px",borderRadius:"5px",marginRight:"10px"}}),e.jsx("span",{children:s.name})]})},pr=({recipes:n,setRecipes:s})=>{const i=_n(Nn(In,{activationConstraint:{distance:10}})),a=r=>{const{active:c,over:y}=r;if(c.id!==(y==null?void 0:y.id)){const l=qn(n,n.findIndex(h=>h.id===c.id),n.findIndex(h=>h.id===y.id));s(l)}};return e.jsx(wn,{sensors:i,collisionDetection:Cn,onDragEnd:a,children:e.jsx(Sn,{items:n.map(r=>r.id),strategy:kn,children:e.jsx("ul",{style:{listStyleType:"none",padding:0},children:n.map(r=>e.jsx(ur,{id:r.id,recipe:r},r.id))})})})},hr=({active:n,payload:s})=>{if(n&&s&&s.length){const i=s[0].payload;return console.log("INIIIII",i),e.jsxs("div",{style:{background:"#fff",border:"1px solid #ccc",padding:"10px",borderRadius:"5px"},children:[e.jsx("p",{children:e.jsx("strong",{children:i.name})},`tooltip-name-${i.id}`),e.jsxs("p",{children:["Initial Quantity: ",i.initialQuantity+i.allocatedQuantity+i.remainingQuantity]}),e.jsxs("p",{children:["Remaining Quantity: ",i.remainingQuantity+i.allocatedQuantity]}),e.jsxs("p",{children:["Allocated Quantity: ",i.allocatedQuantity]})]})}return null},mr=({linkedInventory:n,recipe:s})=>{const i=n.filter(a=>a.meal_plan.recipe_id===s.id).map(a=>{const r=a.used_quantity,c=a.inventory.quantity-r,y=a.inventory.init_quantity-r-c;return{id:`${a.id}-${a.ingredients.name}`,name:a.ingredients.name||"Unknown Ingredient",allocatedQuantity:r>0?r:0,remainingQuantity:c>0?c:0,initialQuantity:y}});return e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h4",{children:"Inventory Progress"}),e.jsx(Cs,{width:"100%",height:200,children:e.jsxs(Ss,{data:i,layout:"vertical",margin:{top:20,right:30,left:40,bottom:20},children:[e.jsx(ks,{strokeDasharray:"3 3"}),e.jsx(Is,{type:"number"}),e.jsx(qs,{dataKey:"name",type:"category"}),e.jsx(Es,{content:e.jsx(hr,{})}),e.jsx(Ds,{}),e.jsx(Ct,{dataKey:"allocatedQuantity",stackId:`inventory-${s.id}`,fill:"#82ca9d",name:"Allocated Quantity"}),e.jsx(Ct,{dataKey:"remainingQuantity",stackId:`inventory-${s.id}`,fill:"#ffc658",name:"Remaining Quantity"}),e.jsx(Ct,{dataKey:"initialQuantity",stackId:`inventory-${s.id}`,fill:"#d3d3d3",name:"Initial Quantity"})]})})]})},gr=()=>{var Ut,Pt,Tt,At,Lt,Mt,$t,Qt,Ot,Bt;const{fetchMealPlansByDate:n,fetchRecipesByIds:s,fetchRecipeIngredients:i,fetchRecipeSteps:a,fetchUserInventory:r,mealTypes:c,getStatusIdByName:y,fetchInventoryMealPlanData:l,fetchInventoryMealPlanByMealPlanId:h,enrichInventory:p,fetchInventoryData:g,fetchPax:o,toggleFavorite:b,favorites:x}=st();ue(),Ee();const L=Je(),{planned_date:k,meal_type_id:R}=L.state||{},[m,_]=t.useState(0),[N,w]=t.useState([]),[C,G]=t.useState(!0),[u,v]=t.useState(!1),[D,j]=t.useState([]),[S,M]=t.useState([]),[Q,ee]=t.useState(null),[F,T]=t.useState([]),[$,U]=t.useState([]),[X,q]=t.useState(!1),[Y,P]=t.useState([]),[I,E]=t.useState(null),[te,ne]=t.useState([]),[oe,H]=t.useState([]),[V,ce]=t.useState([]),[ge,je]=t.useState(!1),[O,pe]=t.useState([]),[ve,A]=t.useState(!1),[he,we]=t.useState(0),[_e,ke]=t.useState(0),[Re,Te]=t.useState(null),[Oe,gt]=t.useState(0),[Ke,it]=t.useState("ingredients"),[$e,ie]=t.useState(1),[xe,Fe]=t.useState({calories:0,protein:0,carbohydrate:0,fat:0}),Ge=Math.max(0,($||[]).reduce((f,B)=>f+B.selectedQuantity,0)-((Q==null?void 0:Q.quantity)||0)),Me=f=>{let B={calories:0,protein:0,carbohydrate:0,fat:0},W=0;f.forEach(Z=>{const{nutritional_info:J,unit:se}=Z.ingredients,{quantity:re}=Z;let{calories:ae,protein:me,carbohydrate:Ne,fat:de}=J;me=typeof me=="string"?parseFloat(me.replace("g",""))||0:me||0,Ne=typeof Ne=="string"?parseFloat(Ne.replace("g",""))||0:Ne||0,de=typeof de=="string"?parseFloat(de.replace("g",""))||0:de||0;const fe=(se==null?void 0:se.conversion_rate_to_grams)||1,ye=fe>0?re*fe:0;if(ye>0){W+=ye;const be=ye/100;B.calories+=ae*be,B.protein+=me*be,B.carbohydrate+=Ne*be,B.fat+=de*be}else console.warn(`Invalid conversion rate for unit: ${se==null?void 0:se.unit_tag}`)}),gt(W);const z=W?{calories:(B.calories/(W/100)).toFixed(2),protein:(B.protein/(W/100)).toFixed(2),carbohydrate:(B.carbohydrate/(W/100)).toFixed(2),fat:(B.fat/(W/100)).toFixed(2)}:{calories:0,protein:0,carbohydrate:0,fat:0};Fe({total:{calories:B.calories.toFixed(2),protein:B.protein.toFixed(2),carbohydrate:B.carbohydrate.toFixed(2),fat:B.fat.toFixed(2)},per100g:z})};t.useEffect(()=>{k&&R&&(async()=>{try{G(!0);const[B,W]=await Promise.all([n(k),g({plannedDate:k})]),z=B.filter(me=>me.meal_type_id===R);if(ne(z),z.length===0){console.warn("No meal plans found for the given date and meal type."),w([]),j([]),H(W);return}const Z=z.map(me=>me.recipe_id),J=await s(Z);w(J);const se=await Promise.all(J.map(async me=>{const de=(await i(me.id)).map(fe=>({...fe,quantity:fe.quantity*$e}));return{recipeId:me.id,ingredients:de}}));j(se),Me(se.flatMap(me=>me.ingredients));const re=z.map(me=>me.id);P(re);const ae=await h(re);H(W)}catch(B){console.error("Error loading data:",B.message)}finally{G(!1)}})()},[k,R,n,s,i,g,$e,m]),t.useEffect(()=>{$.length>0&&$n()},[$]),t.useEffect(()=>{Ge>0&&On()},[Ge]),t.useEffect(()=>{(async()=>{var B;if(N.length>0){const W=(B=N[0])==null?void 0:B.id,z=await a(W);pe(z)}})()},[N,a]),t.useEffect(()=>{(async()=>{if(k&&R)try{console.log("Fetching pax value..."),console.log("Planned Date:",k),console.log("Meal Type ID:",R);const B=await o(k,R);console.log("Fetched Pax:",B),B!=null?ie(B):(console.warn("No pax value returned. Defaulting to 1."),ie(1))}catch(B){console.error("Error fetching pax:",B.message),ie(1)}})()},[k,R,o]),t.useEffect(()=>{const f=D.map(B=>({...B,ingredients:B.ingredients.map(W=>({...W,quantity:W.quantity*$e}))}));j(f)},[$e]),t.useEffect(()=>{(async()=>{if(N.length>0&&he<N.length){const B=N[he];if(!(B!=null&&B.steps)||B.steps.length===0)try{const W=await a(B.id);w(z=>z.map((Z,J)=>J===he?{...Z,steps:W}:Z)),pe(W)}catch(W){console.error("Failed to load steps for the current recipe:",W)}else pe(B.steps)}})()},[he,N,a]);const at=()=>N.every(f=>{var W;return(((W=D.find(z=>z.recipeId===f.id))==null?void 0:W.ingredients)||[]).every(z=>oe.filter(se=>se.inventory.ingredient_id===z.ingredients.id&&te.some(re=>re.id===se.meal_plan_id)).reduce((se,re)=>{var de,fe,ye,be;const ae=((de=z.ingredients.unit)==null?void 0:de.conversion_rate_to_grams)||1,me=((fe=re.ingredients.unitInv)==null?void 0:fe.conversion_rate_to_grams_for_check)||1;if(((ye=z.ingredients.unit)==null?void 0:ye.unit_tag)===((be=re.ingredients.unitInv)==null?void 0:be.unitInv_tag))return se+re.used_quantity;const Ne=re.used_quantity*me/ae;return se+Ne},0)>=z.quantity)}),xt=()=>{if($e<1){alert("Please select at least 1 pax.");return}at()?v(!0):alert("Some ingredients are incomplete. Please ensure all ingredients are complete before starting.")},bt=async()=>{try{const{error:f}=await d.from("meal_plan").update({status_id:2,updated_at:new Date().toISOString()}).eq("status_id",3);if(f)throw f;alert("Meal plans marked as cooked!"),_(B=>B+1)}catch(f){console.error("Error marking as cooked:",f.message),alert("Failed to mark meal plans as cooked. Please try again.")}},_t=()=>{v(!1)},Ve=()=>{v(!1)},We=(f,B)=>{var de,fe;const W=f.quantity,z=((de=f.ingredients.unit)==null?void 0:de.conversion_rate_to_grams)||1,Z=W*z,J=5*z,se=[...B].sort((ye,be)=>{var K,Se;const De=new Date(((K=ye.expiry_date)==null?void 0:K.date)||"9999-12-31"),Ie=new Date(((Se=be.expiry_date)==null?void 0:Se.date)||"9999-12-31");return De-Ie!==0?De-Ie:ye.quantity-be.quantity});let re=Z;const ae=[],me=[];for(let ye=0;ye<se.length;ye++){const be=se[ye],De=((fe=be.ingredients.unitInv)==null?void 0:fe.conversion_rate_to_grams_for_check)||1,Ie=be.quantity*De;if(Ie<J){me.push({...be,preselected:!1,predisqualified:!0,selectedQuantity:0,adjustedQuantity:0});continue}const K=Ie/z;if(Ie>=re){ae.push({...be,selectedQuantity:re/De,preselected:!0,predisqualified:!1,adjustedQuantity:re/z}),re=0;break}if(ae.push({...be,selectedQuantity:be.quantity,preselected:!0,predisqualified:!1,adjustedQuantity:K}),re-=Ie,re<=0)break}return se.map(ye=>{const be=ae.find(Ie=>Ie.id===ye.id),De=me.find(Ie=>Ie.id===ye.id);return be||De||{...ye,preselected:!1,predisqualified:!1,selectedQuantity:0,adjustedQuantity:0}})},Ye=(f,B)=>(f.map(z=>z.inventory_id),B.map(z=>{const Z=f.find(J=>J.inventory_id===z.id);return Z?{...z,selectedQuantity:Z.used_quantity,preselected:!0}:{...z,selectedQuantity:0,preselected:!1}})),ot=async(f,B)=>{try{ee(f),T([]),U([]),q(!1);const W=await r(f.ingredients.id);if(W.length===0){console.warn("No inventory available for this ingredient."),q(!1);return}const Z=(await h(Y)).filter(re=>{var ae;return re.inventory.ingredient_id===f.ingredients.id&&((ae=re.meal_plan)==null?void 0:ae.recipe_id)===B});let J;Z.length>0?(J=Ye(Z,W),je(!0)):(J=We(f,W),je(!1));const se=J.map(re=>{const ae=$.find(me=>me.id===re.id);return ae?{...re,selectedQuantity:ae.selectedQuantity,preselected:ae.preselected}:re});T(W),U(se),E(f.quantity),q(!0)}catch(W){console.error("Error fetching inventory for ingredient:",W.message)}},ct=f=>{console.log("Before toggle:",$),U(B=>B.find(z=>z.id===f.id)?B.map(z=>z.id===f.id?{...z,preselected:!z.preselected}:z):[...B,{...f,selectedQuantity:f.selectedQuantity||1,preselected:!0}])},rt=()=>{var W;const f=$.filter(z=>z.preselected),B=f.reduce((z,Z)=>z+Z.quantity,0);if(f.length===0||B<Q.quantity){alert(`You must select at least one item to proceed. Now you have selected ${B} ${((W=Q.ingredients.unit)==null?void 0:W.unit_tag)||""}.`);return}U(z=>z.map(Z=>f.find(J=>J.id===Z.id)?{...Z,selectedQuantity:Z.selectedQuantity||Z.quantity}:Z)),q(!0)},Dt=(f,B)=>{U(W=>{const z=W||[],Z=Q.quantity;let J=z.reduce((re,ae)=>re+ae.selectedQuantity,0);const se=z.map(re=>{if(re.id===f){const ae=Math.max(1,Math.min(re.selectedQuantity+B,re.quantity));return J+=ae-re.selectedQuantity,{...re,selectedQuantity:ae}}return re});if(J>Z){const re=J-Z;return Tn(se,f,re)}return se})},Pn=(f,B)=>{U(W=>{const z=Math.max(1,parseInt(B)||1);return W.map(J=>{var se,re;if(J.id===f){const ae=((se=J.ingredients.unit)==null?void 0:se.conversion_rate_to_grams)||1,me=((re=J.ingredients.unitInv)==null?void 0:re.conversion_rate_to_grams_for_check)||1,Ne=J.isConverted||!1,de=Ne?Q.quantity:Q.quantity*(ae/me),fe=Ne?J.quantity:Math.floor(J.quantity*me/ae);return z>fe||z>de?J:{...J,selectedQuantity:z}}return J})})},Tn=(f,B,W)=>f.map(z=>{if(z.id===B||W<=0)return z;const Z=Math.min(z.selectedQuantity,W);return W-=Z,{...z,selectedQuantity:z.selectedQuantity-Z}}),An=async()=>{var f,B;try{if(!Q||!$||$.length===0){console.warn("Ingredient or inventory selection is missing.");return}const W=$.filter(ae=>ae.selectedQuantity>0);if(W.length===0){alert("No valid inventory selected. Please select quantities to proceed.");return}const z=await y("Planning");if(!z){alert("Failed to fetch status ID for 'Planning'.");return}const Z=await p(W,Q,k);for(const ae of Z){const me=((f=Q.ingredients.unit)==null?void 0:f.conversion_rate_to_grams)||1,Ne=((B=ae.ingredients.unitInv)==null?void 0:B.conversion_rate_to_grams_for_check)||1,fe=ae.isConverted||!1?I:I*me/Ne;if(ae.selectedQuantity>fe){alert(`Selected quantity (${ae.selectedQuantity}) exceeds the required cap (${fe}) for inventory ID ${ae.id}. Please adjust and try again.`);return}}const J=Z.map(ae=>{var ye,be;const me=((ye=ae.ingredients.unit)==null?void 0:ye.conversion_rate_to_grams)||1,Ne=((be=ae.ingredients.unitInv)==null?void 0:be.conversion_rate_to_grams_for_check)||1,fe=ae.isConverted||!1?ae.selectedQuantity*me/Ne:ae.selectedQuantity;return{inventory_id:ae.id,meal_plan_id:ae.meal_plan_id,used_quantity:fe,status_id:z,created_at:new Date().toISOString(),ingredient_id:Q.ingredients.id}}),{data:se,error:re}=await d.from("inventory_meal_plan").insert(J);if(re)throw re;ee(null),U([]),q(!1),_(ae=>ae+1)}catch(W){console.error("Error finalizing quantities:",W.message),alert("Failed to finalize quantities. Please try again.")}},Ln=async()=>{try{if(!Q||!$||$.length===0){console.warn("Ingredient or inventory selection is missing.");return}const f=$.filter(Z=>Z.selectedQuantity>0);if(f.length===0){alert("No valid inventory selected. Please select quantities to proceed.");return}console.log("Filtered Inventory:",f);const W=(await p(f,Q,k)).map(Z=>(console.log("Updating row with the following details:",{meal_plan_id:Z.meal_plan_id,inventory_id:Z.inventory_id,ingredient_id:Q.ingredients.id,used_quantity:Z.selectedQuantity}),d.from("inventory_meal_plan").update({used_quantity:Z.selectedQuantity,updated_at:new Date().toISOString()}).eq("meal_plan_id",Z.meal_plan_id).eq("inventory_id",Z.id).eq("ingredient_id",Q.ingredients.id)));(await Promise.all(W)).forEach(({data:Z,error:J},se)=>{J?console.error(`Error updating row ${se+1}:`,J.message):console.log(`Update successful for row ${se+1}:`,Z)}),console.log("Updated Quantities Successfully using meal_plan_id, inventory_id, and ingredient_id!"),ee(null),U([]),q(!1),_(Z=>Z+1)}catch(f){console.error("Error updating quantities:",f.message),alert("Failed to update quantities. Please try again.")}},Mn=async(f,B,W)=>{try{const{data:z,error:Z}=await d.from("inventory_meal_plan").delete().eq("inventory_id",f).eq("meal_plan_id",B).eq("ingredient_id",W);if(Z){console.error("Error deleting inventory:",Z.message),alert("Failed to delete the inventory item. Please try again.");return}console.log("Deleted inventory:",z);const J=V.filter(se=>se.inventory_id!==f||se.meal_plan_id!==B||se.ingredient_id!==W);ce(J),_(se=>se+1)}catch(z){console.error("Unexpected error deleting inventory:",z.message),alert("Failed to delete the inventory item. Please try again.")}},$n=()=>{const f=S.map(B=>{let W=B.quantity;const z=B.recipes.map(Z=>{const J=Math.min(W,Z.quantity);return W-=J,{recipeId:Z.recipeId,quantity:J}});return{...B,recipes:z}});M(f)};if(C)return e.jsx(Ue,{});if(N.length===0)return e.jsx("div",{children:"No recipes found for this meal plan."});const Qn=()=>{var z,Z;const f=((z=Q.ingredients.unit)==null?void 0:z.conversion_rate_to_grams)||1;let B=Q.quantity*f;console.log("Base Conversion Rate:",f),console.log("Remaining Required (Base Unit):",B);const W=($||[]).map(J=>{var de,fe,ye,be;const se=((de=J.ingredients.unitInv)==null?void 0:de.conversion_rate_to_grams_for_check)||1,re=J.isConverted||!1;console.log("Processing Item:",J.id),console.log("Item Quantity:",J.quantity),console.log("Inventory Conversion Rate:",se),console.log("Is Currently Converted:",re);const ae=re?J.quantity*f/se:J.quantity*se;if(console.log("Available Quantity in Base Unit:",ae),!J.preselected||B<=0)return{...J,selectedQuantity:0,convertedUnit:((fe=J.ingredients.unitInv)==null?void 0:fe.unitInv_tag)||"unit not specified"};const me=Math.min(ae,B),Ne=re?me*se/f:me;return B-=me,{...J,selectedQuantity:Math.round(Ne),convertedUnit:re?((ye=J.ingredients.unitInv)==null?void 0:ye.unitInv_tag)||"unit not specified":((be=Q.ingredients.unit)==null?void 0:be.unit_description)||"unit not specified"}});U(W),B>0&&alert(`Not enough inventory to fulfill the required amount of ${Q.quantity} ${(Z=Q.ingredients.unit)==null?void 0:Z.unit_tag}.`)},On=()=>{ee(f=>{if(!f||!f.recipes||f.recipes.length===0)return console.warn("No recipes found to allocate exceed."),f;const B=Math.max(0,$.reduce((se,re)=>se+re.selectedQuantity,0)-f.quantity);if(B<=0)return console.log("No exceed to allocate."),f;console.log("Total Exceed to Allocate:",B);const W=f.recipes.length,z=Math.floor(B/W);let Z=B%W;const J=f.recipes.map((se,re)=>{let ae=z;return Z>0&&(ae+=1,Z-=1),{...se,exceedAllocation:ae}});return console.log("Updated Recipes with Exceed Allocation:",J),{...f,recipes:J}})},Bn=async()=>{var f;try{const B=[],W=[];for(const z of N){const Z=((f=D.find(J=>J.recipeId===z.id))==null?void 0:f.ingredients)||[];for(const J of Z){const se=(await h(Y)).filter(fe=>{var ye;return fe.inventory.ingredient_id===J.ingredients.id&&((ye=fe.meal_plan)==null?void 0:ye.recipe_id)===z.id}),re=se.reduce((fe,ye)=>fe+ye.used_quantity,0);if(re>=J.quantity){W.push({ingredient:J.ingredients.name,totalAllocated:re});continue}const ae=await r(J.ingredients.id);let me;se.length>0?me=Ye(se,ae):me=We(J,ae);const Ne=me.map(fe=>({...fe,selectedQuantity:fe.selectedQuantity||0,preselected:!0}));ee(J),U(Ne);const de=Ne.filter(fe=>fe.selectedQuantity>0);if(de.length>0){const fe=await y("Planning"),be=(await p(de,J,k)).map(K=>({inventory_id:K.id,meal_plan_id:K.meal_plan_id,used_quantity:K.selectedQuantity,status_id:fe,created_at:new Date().toISOString(),ingredient_id:J.ingredients.id})),{error:De}=await d.from("inventory_meal_plan").insert(be);if(De)throw De;const Ie=de.reduce((K,Se)=>K+Se.selectedQuantity,0);Ie<J.quantity&&B.push({ingredient:J.ingredients.name,required:J.quantity,distributed:Ie})}else B.push({ingredient:J.ingredients.name,required:J.quantity,distributed:0})}}_(z=>z+1),alert("Auto-distribution complete!"),W.length>0&&(console.log("Ingredients already completed:",W),alert(`The following ingredients were already complete and skipped:
${W.map(z=>`${z.ingredient} (Allocated: ${z.totalAllocated})`).join(`
`)}`)),B.length>0&&(console.warn("Failed to distribute for some ingredients:",B),alert(`The following ingredients could not be fully distributed due to insufficient inventory:
${B.map(z=>`${z.ingredient} (Required: ${z.required}, Distributed: ${z.distributed})`).join(`
`)}`))}catch(B){console.error("Error during auto-distribution:",B.message),alert("Failed to auto-distribute inventory. Please try again.")}},Gn=async()=>{try{if(!Y||Y.length===0){alert("No meal plans found to delete inventory allocations.");return}if(!window.confirm("Are you sure you want to delete all inventory allocations for this meal plan? This action cannot be undone."))return;const{data:B,error:W}=await d.from("inventory_meal_plan").delete().in("meal_plan_id",Y);if(W)throw W;console.log("Deleted inventory allocations:",B),ce([]),_(z=>z+1),alert("All inventory allocations have been deleted successfully.")}catch(f){console.error("Error deleting all inventory allocations:",f.message),alert("Failed to delete all inventory allocations. Please try again.")}},Rt=()=>{ve?Te(_e):(Re!==null||he>0)&&window.confirm("Would you like to continue from your last step(Yes) or start over(No)?")?ke(Re||0):(we(0),ke(0)),A(f=>!f)},zn=()=>{_e<O.length-1&&ke(f=>f+1)},Vn=()=>{_e>0&&ke(f=>f-1)},Wn=async()=>{try{const{data:f,error:B}=await d.from("inventory_meal_plan").update({status_id:2,updated_at:new Date().toISOString()}).in("meal_plan_id",Y);if(B)throw B;console.log("Updated inventory_meal_plan:",f);const{error:W}=await d.from("meal_plan").update({status_id:2,updated_at:new Date().toISOString()}).in("id",Y);if(W)throw W;console.log("Updated meal_plan status to Complete");const{data:z,error:Z}=await d.from("inventory_meal_plan").select("inventory_id, used_quantity").in("meal_plan_id",Y);if(Z)throw Z;console.log("Affected Rows in inventory_meal_plan:",z);const J=z.map(async se=>{const{data:re,error:ae}=await d.from("inventory").select("quantity").eq("id",se.inventory_id).single();if(ae)throw ae;const me=Math.max(0,re.quantity-se.used_quantity),{error:Ne}=await d.from("inventory").update({quantity:me,updated_at:new Date().toISOString()}).eq("id",se.inventory_id);if(Ne)throw Ne;console.log(`Updated inventory for ID ${se.inventory_id} to quantity ${me}`)});await Promise.all(J),alert("Cooking finished, quantities updated, and status set to complete!"),A(!1),ke(0),Te(null),_(se=>se+1)}catch(f){console.error("Error finishing cooking:",f.message),alert("Failed to finish cooking. Please try again.")}},Ft=f=>{ie(W=>{const z=Math.max(1,W+f);return te.forEach(Z=>{Yn(Z.id,z)}),z});const B=D.map(W=>({...W,ingredients:W.ingredients.map(z=>({...z,quantity:z.quantity*($e+f)}))}));j(B)},Yn=async(f,B)=>{try{console.log("Updating Pax for meal plan ID:",f),console.log("New Pax Value:",B);const{error:W}=await d.from("meal_plan").update({serving_packs:B,updated_at:new Date().toISOString()}).eq("id",f);if(W)throw W;console.log(`Pax updated to ${B} for meal plan ID ${f}`)}catch(W){console.error("Error updating pax:",W.message),alert("Failed to update Pax. Please try again.")}};return e.jsxs("div",{className:"recipe-preparation-page",children:[N.map(f=>{var W,z,Z,J,se,re,ae,me,Ne;const B=((W=D.find(de=>de.recipeId===f.id))==null?void 0:W.ingredients)||[];return e.jsxs("div",{className:"recipe-details",children:[e.jsxs("section",{className:"recipe-image-detail-section",children:[e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${f.image_path}`,alt:f.name,className:"recipe-detail-image"}),e.jsxs("div",{className:"image-overlay",children:[e.jsx(Le,{}),e.jsx("div",{className:"meal-plan-status-container",children:e.jsx("span",{className:`meal-plan-status ${te.every(de=>de.meal_plan_status.id===2)?"complete":te.some(de=>de.meal_plan_status.id===3)?"deadline-passed":"planning"}`,children:te.every(de=>de.meal_plan_status.id===2)?"Complete":te.some(de=>de.meal_plan_status.id===3)?"Deadline Passed":"Planning"})}),e.jsx("div",{className:"action-buttons",children:e.jsx("button",{onClick:de=>{de.stopPropagation(),b(f.id)},className:"favorite-button",children:x.includes(f.id)?"❤️":"🤍"})})]})]}),e.jsxs("div",{className:"recipe-detail-lower-section",children:[e.jsxs("section",{className:"recipe-details",children:[e.jsx("h2",{className:"recipe-detail-title",children:f.name}),e.jsx("p",{className:"recipe-description",children:f.description}),e.jsxs("div",{className:"left-right-space-evenly-section",children:[e.jsxs("p",{className:"prep-time",children:["Prep Time: ",f.prep_time," mins"]}),e.jsxs("p",{className:"cook-time",children:["Cook Time: ",f.cook_time," mins"]})]}),e.jsx("div",{className:"total-meal-weight",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Total Meal Weight: "}),(Oe*($e/1)).toFixed(2)," g"]})})]}),e.jsxs("section",{className:"nutrition-facts",children:[e.jsx("h3",{children:"Nutrition Facts"}),e.jsxs("div",{className:"nutrition-content",children:[e.jsxs("div",{className:"total-nutrition",children:[e.jsx("h4",{children:"Total Nutrition"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Calories: ",((z=xe.total)==null?void 0:z.calories)||0," kcal"]}),e.jsxs("li",{children:["Protein: ",((Z=xe.total)==null?void 0:Z.protein)||0," g"]}),e.jsxs("li",{children:["Carbohydrate: ",((J=xe.total)==null?void 0:J.carbohydrate)||0," g"]}),e.jsxs("li",{children:["Fats: ",((se=xe.total)==null?void 0:se.fat)||0," g"]})]})]}),e.jsxs("div",{className:"per-100g-nutrition",children:[e.jsx("h4",{children:"Per 100g"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Calories: ",((re=xe.per100g)==null?void 0:re.calories)||0," kcal"]}),e.jsxs("li",{children:["Protein: ",((ae=xe.per100g)==null?void 0:ae.protein)||0," g"]}),e.jsxs("li",{children:["Carbohydrate: ",((me=xe.per100g)==null?void 0:me.carbohydrate)||0," g"]}),e.jsxs("li",{children:["Fats: ",((Ne=xe.per100g)==null?void 0:Ne.fat)||0," g"]})]})]})]})]}),e.jsxs("div",{className:"radio-inputs",children:[e.jsxs("label",{className:"radio",children:[e.jsx("input",{type:"radio",name:"toggle",checked:Ke==="ingredients",onChange:()=>it("ingredients")}),e.jsx("span",{className:"name",children:"Ingredients"})]}),e.jsxs("label",{className:"radio",children:[e.jsx("input",{type:"radio",name:"toggle",checked:Ke==="steps",onChange:()=>it("steps")}),e.jsx("span",{className:"name",children:"Steps"})]})]}),Ke==="ingredients"&&e.jsxs("section",{className:"ingredients-section",children:[e.jsx("h3",{children:"Ingredients"}),e.jsxs("section",{className:"serving-adjuster",children:[e.jsx("h4",{children:"Serving Packs"}),e.jsx("button",{onClick:()=>Ft(-1),className:"adjust-serving-button",children:"-"}),e.jsx("span",{className:"serving-count",children:$e}),e.jsx("button",{onClick:()=>Ft(1),className:"adjust-serving-button",children:"+"})]}),e.jsxs("section",{className:"ingredients-section",children:[e.jsxs("h3",{children:["Ingredients List (",B.length," item(s))"]}),e.jsxs("div",{className:"left-right-space-evenly-section",children:[e.jsx("button",{onClick:Bn,className:"auto-distribute-button",children:"Auto Distribute All"}),e.jsx("button",{onClick:Gn,className:"delete-all-button",children:"Delete All"})]}),e.jsx("ul",{className:"ingredients-list",children:B.map((de,fe)=>{var Ie;const ye=oe.filter(K=>K.inventory.ingredient_id===de.ingredients.id&&te.some(Se=>Se.id===K.meal_plan_id)),De=ye.reduce((K,Se)=>{var Pe,et,Ae,He;const qe=((Pe=de.ingredients.unit)==null?void 0:Pe.conversion_rate_to_grams)||1,Be=((et=Se.ingredients.unitInv)==null?void 0:et.conversion_rate_to_grams_for_check)||1;if(((Ae=de.ingredients.unit)==null?void 0:Ae.unit_tag)===((He=Se.ingredients.unitInv)==null?void 0:He.unitInv_tag)||qe===Be)return K+Se.used_quantity;const Ze=Se.used_quantity*Be/qe;return K+Ze},0)>=de.quantity;return e.jsxs("li",{onClick:()=>ot(de,f.id),className:"ingredient-item",children:[e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${de.ingredients.icon_path}`,alt:de.ingredients.name,className:"ingredient-image"}),de.ingredients.name," - ",de.quantity," ",((Ie=de.ingredients.unit)==null?void 0:Ie.unit_tag)||"",ye.filter(K=>K.meal_plan.recipe_id===f.id).length>0&&e.jsxs("div",{className:"linked-inventory-container",children:[e.jsxs("h4",{className:"linked-inventory-header",children:["Linked Inventory Data"," ",e.jsxs("span",{className:`inventory-status ${De?"complete":"incomplete"}`,children:["(",De?"Complete":"Incomplete",")"]}),e.jsx("button",{className:"delete-all-button",onClick:K=>{K.stopPropagation(),ye.forEach(Se=>Mn(Se.inventory_id,Se.meal_plan_id,Se.ingredients.id))},children:"Delete All"})]}),ye.filter(K=>K.meal_plan.recipe_id===f.id).map(K=>{var Se,qe,Be,Ze,Pe,et,Ae,He,lt,dt,ut,pt,ft,Gt,zt,Vt,Wt,Yt,Ht,Xt,Jt,Kt,Zt,en,tn,nn,sn,rn,an,on,cn,ln,dn;return K.used_quantity/K.inventory.init_quantity*100,e.jsxs("div",{className:"inventory-item",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Quantity left:"})," ",((Se=K.ingredients.unit)==null?void 0:Se.unit_tag)===((qe=K.ingredients.unitInv)==null?void 0:qe.unitInv_tag)?e.jsxs(e.Fragment,{children:[K.inventory.quantity," ",((Be=K.ingredients.unit)==null?void 0:Be.unit_tag)||"","(of ",K.inventory.init_quantity," ",((Ze=K.ingredients.unit)==null?void 0:Ze.unit_tag)||"",")"]}):((Pe=K.ingredients.unit)==null?void 0:Pe.conversion_rate_to_grams)===((et=K.ingredients.unitInv)==null?void 0:et.conversion_rate_to_grams_for_check)?e.jsxs(e.Fragment,{children:[K.inventory.quantity," ",((Ae=K.ingredients.unitInv)==null?void 0:Ae.unitInv_tag)||""," /",K.inventory.quantity," ",((He=K.ingredients.unit)==null?void 0:He.unit_tag)||"","(of ",K.inventory.init_quantity," ",((lt=K.ingredients.unitInv)==null?void 0:lt.unitInv_tag)||""," /",K.inventory.init_quantity," ",((dt=K.ingredients.unit)==null?void 0:dt.unit_tag)||"",")"]}):e.jsxs(e.Fragment,{children:[K.inventory.quantity," ",((ut=K.ingredients.unitInv)==null?void 0:ut.unitInv_tag)||""," /",Math.round(K.inventory.quantity*(((pt=K.ingredients.unitInv)==null?void 0:pt.conversion_rate_to_grams_for_check)||1)/(((ft=K.ingredients.unit)==null?void 0:ft.conversion_rate_to_grams)||1))," ",((Gt=K.ingredients.unit)==null?void 0:Gt.unit_tag)||"","(of ",K.inventory.init_quantity," ",((zt=K.ingredients.unitInv)==null?void 0:zt.unitInv_tag)||""," /",Math.round(K.inventory.init_quantity*(((Vt=K.ingredients.unitInv)==null?void 0:Vt.conversion_rate_to_grams_for_check)||1)/(((Wt=K.ingredients.unit)==null?void 0:Wt.conversion_rate_to_grams)||1))," ",((Yt=K.ingredients.unit)==null?void 0:Yt.unit_tag)||"",")"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"This recipe use:"})," ",((Ht=K.ingredients.unit)==null?void 0:Ht.unit_tag)===((Xt=K.ingredients.unitInv)==null?void 0:Xt.unitInv_tag)?e.jsxs(e.Fragment,{children:[K.used_quantity," ",((Jt=K.ingredients.unit)==null?void 0:Jt.unit_tag)||""]}):((Kt=K.ingredients.unit)==null?void 0:Kt.conversion_rate_to_grams)===((Zt=K.ingredients.unitInv)==null?void 0:Zt.conversion_rate_to_grams_for_check)?e.jsxs(e.Fragment,{children:[K.used_quantity," ",((en=K.ingredients.unitInv)==null?void 0:en.unitInv_tag)||""," /",K.used_quantity," ",((tn=K.ingredients.unit)==null?void 0:tn.unit_tag)||""]}):e.jsxs(e.Fragment,{children:[K.used_quantity," ",((nn=K.ingredients.unitInv)==null?void 0:nn.unitInv_tag)||""," /"," ",Number.isInteger(K.used_quantity*(((sn=K.ingredients.unitInv)==null?void 0:sn.conversion_rate_to_grams_for_check)||1)/(((rn=K.ingredients.unit)==null?void 0:rn.conversion_rate_to_grams)||1))?Math.round(K.used_quantity*(((an=K.ingredients.unitInv)==null?void 0:an.conversion_rate_to_grams_for_check)||1)/(((on=K.ingredients.unit)==null?void 0:on.conversion_rate_to_grams)||1)):`~${Math.round(K.used_quantity*(((cn=K.ingredients.unitInv)==null?void 0:cn.conversion_rate_to_grams_for_check)||1)/(((ln=K.ingredients.unit)==null?void 0:ln.conversion_rate_to_grams)||1))}`," ",((dn=K.ingredients.unit)==null?void 0:dn.unit_tag)||""]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expiry Date:"})," ",K.inventory.expiry_date.date||"No expiry date","(",K.inventory.days_left," days left)"]}),e.jsx("span",{className:`meal-plan-status ${K.inventory_meal_plan_status.name==="Completed"?"complete":K.inventory_meal_plan_status.name==="Pass Deadline"?"deadline-passed":K.inventory_meal_plan_status.name==="Canceled"?"canceled":"planning"}`,children:K.inventory_meal_plan_status.name}),e.jsx(mr,{linkedInventory:ye,recipe:f})]},K.id)})]})]},fe)})})]})]}),Ke==="steps"&&e.jsxs("section",{className:"steps-section",children:[e.jsx("h3",{children:"Steps"}),e.jsx("ul",{className:"steps-list",children:O.map(de=>e.jsxs("li",{className:"step-item",children:[e.jsxs("strong",{children:[de.step_number,":"]})," ",de.instruction]},de.step_number))})]})]})]},f.id)}),te.some(f=>f.meal_plan_status.id===3)?e.jsx("button",{onClick:bt,className:"mark-cooked-button floating-down",children:"Mark as Cooked"}):te.every(f=>f.meal_plan_status.id===2)?null:e.jsxs("button",{onClick:xt,className:"start-cooking-button floating-down",children:["Start Cooking",console.log("HEREEEEEEEE")]}),Q&&e.jsx("div",{className:"recipes-preparation-modal-overlay",onClick:()=>ee(null),children:e.jsx("div",{className:"modal-content",onClick:f=>f.stopPropagation(),style:{background:"white",padding:"20px",borderRadius:"10px"},children:X?e.jsxs(e.Fragment,{children:[e.jsxs("h3",{children:["Adjust Quantities for: ",Q.ingredients.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Required:"})," ",Q.quantity," ",((Pt=Q.ingredients.unit)==null?void 0:Pt.unit_tag)||""]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Your Adjusted Total:"})," ",$.filter(f=>f.preselected).map(f=>{var se,re,ae,me,Ne,de,fe,ye,be;const B=f.isConverted||!1,W=((se=f.ingredients.unit)==null?void 0:se.conversion_rate_to_grams)===((re=f.ingredients.unitInv)==null?void 0:re.conversion_rate_to_grams_for_check),z=W?f.selectedQuantity:f.selectedQuantity/(((ae=f.ingredients.unit)==null?void 0:ae.conversion_rate_to_grams)||1),Z=Number.isInteger(z)?z:`~${Math.round(z)}`,J=f.selectedQuantity*((me=f.ingredients.unit)==null?void 0:me.conversion_rate_to_grams);return B?`${f.selectedQuantity} ${((Ne=f.ingredients.unit)==null?void 0:Ne.unit_tag)||"unit not specified"} 
                                (${J} ${((de=f.ingredients.unitInv)==null?void 0:de.unitInv_tag)||"unit not specified"})`:W?`${f.selectedQuantity} ${((fe=f.ingredients.unit)==null?void 0:fe.unit_tag)||"unit not specified"}`:`${Z} ${((ye=f.ingredients.unit)==null?void 0:ye.unit_tag)||"unit not specified"} 
                            (${f.selectedQuantity} ${((be=f.ingredients.unitInv)==null?void 0:be.unitInv_tag)||"unit not specified"})`}).join(", ")," "]}),!ge&&e.jsx("button",{onClick:()=>q(!1),style:{marginTop:"10px",padding:"10px 20px",background:"orange",color:"white",borderRadius:"5px"},children:"Back to Select"}),e.jsx("ul",{children:$.filter(f=>f.preselected).map(f=>{var re,ae,me,Ne,de,fe,ye,be,De,Ie,K,Se,qe,Be,Ze;const B=((re=f.ingredients.unit)==null?void 0:re.conversion_rate_to_grams)||1,W=((ae=f.ingredients.unitInv)==null?void 0:ae.conversion_rate_to_grams_for_check)||1;B!==W?f.selectedQuantity*W/B:f.selectedQuantity,(me=f.ingredients.unitInv)==null||me.unitInv_tag,(Ne=f.ingredients.unit)==null||Ne.unit_tag;const z=((de=f.ingredients.unit)==null?void 0:de.unit_description)||"unit not specified";(fe=f.ingredients.unitInv)!=null&&fe.unitInv_tag;const Z=B===W,J=Z?f.quantity:f.quantity/(((ye=f.ingredients.unit)==null?void 0:ye.conversion_rate_to_grams)||1),se=Pe=>{U(et=>et.map(Ae=>{var He,lt;if(Ae.id===Pe){const dt=((He=Ae.ingredients.unit)==null?void 0:He.conversion_rate_to_grams)||1,ut=((lt=Ae.ingredients.unitInv)==null?void 0:lt.conversion_rate_to_grams_for_check)||1,pt=Ae.isConverted||!1,ft=Math.floor(pt?Ae.selectedQuantity*dt/ut:Ae.selectedQuantity*ut/dt);return{...Ae,selectedQuantity:ft,isConverted:!pt}}return console.log("Updated Inventory:",$),Ae}))};return e.jsxs("li",{style:{backgroundColor:(be=$.find(Pe=>Pe.id===f.id))!=null&&be.preselected?"lightgreen":f.predisqualified?"red":"white",padding:"5px",borderRadius:"5px",position:"relative"},children:[e.jsx("label",{children:Z?e.jsxs(e.Fragment,{children:[f.quantity.toFixed(2)," ",z," (Expiry:"," ",((De=f.expiry_date)==null?void 0:De.date)||"No expiry date",")"]}):e.jsxs(e.Fragment,{children:[f.quantity," ",((Ie=f.ingredients.unitInv)==null?void 0:Ie.unitInv_tag)||"unit not specified"," "," / ",Number.isInteger(J)?J.toFixed(2):`~${Math.round(J)}`," ",z," (Expiry: ",((K=f.expiry_date)==null?void 0:K.date)||"No expiry date",")"]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginTop:"5px",gap:"10px"},children:[e.jsx("span",{style:{padding:"5px",backgroundColor:"lightgrey",borderRadius:"5px",fontWeight:"bold"}}),e.jsx("button",{onClick:()=>Dt(f.id,-1),disabled:f.selectedQuantity<=1,style:{backgroundColor:"blue",color:"white",borderRadius:"5px"},children:"-"}),e.jsx("input",{type:"number",min:"1",max:f.quantity,value:f.selectedQuantity.toFixed(2),onChange:Pe=>Pn(f.id,Pe.target.value),style:{width:"60px",textAlign:"center",border:"1px solid #ccc",borderRadius:"5px"}}),e.jsx("span",{children:f.isConverted?((Se=f.ingredients.unit)==null?void 0:Se.unit_description)||"unit not specified":((qe=f.ingredients.unitInv)==null?void 0:qe.unitInv_tag)||"unit not specified"}),e.jsx("button",{onClick:()=>Dt(f.id,1),disabled:f.isConverted?$.filter(Pe=>Pe.preselected).length===1&&f.selectedQuantity>=Q.quantity||f.selectedQuantity>=f.quantity:$.filter(Pe=>Pe.preselected).length===1&&f.selectedQuantity>=Math.floor(Q.quantity*(((Be=f.ingredients.unit)==null?void 0:Be.conversion_rate_to_grams)||1)/(((Ze=f.ingredients.unitInv)==null?void 0:Ze.conversion_rate_to_grams_for_check)||1))||f.selectedQuantity>=f.quantity,style:{backgroundColor:"blue",color:"white",borderRadius:"5px"},children:"+"}),!Z&&e.jsx("button",{onClick:()=>se(f.id),style:{backgroundColor:"orange",color:"white",borderRadius:"5px",padding:"5px 10px",fontWeight:"bold"},children:"Convert"})]})]},f.id)})}),e.jsx("button",{onClick:()=>ee(null),style:{marginTop:"10px",marginLeft:"10px",padding:"10px 20px",background:"red",color:"white",borderRadius:"5px"},children:"Cancel"}),e.jsx("button",{onClick:Qn,style:{marginTop:"10px",padding:"10px 20px",background:"blue",color:"white",borderRadius:"5px"},children:"Auto Adjust Quantities"}),ge?e.jsx("button",{onClick:Ln,style:{padding:"10px 20px",background:"blue",color:"white",borderRadius:"5px",marginTop:"20px"},children:"Update Quantities"}):e.jsx("button",{onClick:An,style:{padding:"10px 20px",background:"green",color:"white",borderRadius:"5px",marginTop:"20px"},children:"Finalize Quantities"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{children:["Select Inventory for: ",Q.ingredients.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Required:"})," ",Q.quantity," ",((Ut=Q.ingredients.unit)==null?void 0:Ut.unit_tag)||""]}),F.length===0?e.jsx(e.Fragment,{children:e.jsx("p",{children:e.jsxs("strong",{children:["No ",Q.ingredients.name," in your inventory."]})})}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Your Selection:"})," ",$.filter(f=>f.preselected).map(f=>{var z,Z,J,se,re,ae;const B=((z=f.ingredients.unit)==null?void 0:z.conversion_rate_to_grams)===((Z=f.ingredients.unitInv)==null?void 0:Z.conversion_rate_to_grams_for_check),W=B?f.quantity:f.quantity/(((J=f.ingredients.unit)==null?void 0:J.conversion_rate_to_grams)||1);return B?`${f.quantity} ${((se=f.ingredients.unit)==null?void 0:se.unit_tag)||"unit not specified"}`:`${f.quantity} ${((re=f.ingredients.unitInv)==null?void 0:re.unitInv_tag)||"unit not specified"} (~${Math.round(W)} ${((ae=f.ingredients.unit)==null?void 0:ae.unit_tag)||"unit not specified"})`}).join(", ")," "]}),e.jsxs("ul",{children:[console.log("Inventory Items Before Sorting:",F),console.log("Selected Inventory Before Sorting:",$),F.sort((f,B)=>{var Z,J;const W=new Date(((Z=f.expiry_date)==null?void 0:Z.date)||"9999-12-31"),z=new Date(((J=B.expiry_date)==null?void 0:J.date)||"9999-12-31");return W-z!==0?W-z:f.quantity-B.quantity}).map(f=>{var Z,J,se,re,ae,me,Ne,de,fe,ye,be,De,Ie,K,Se;const B=(Z=f.ingredients.unit)!=null&&Z.conversion_rate_to_grams&&((J=f.ingredients.unitInv)!=null&&J.conversion_rate_to_grams_for_check)?f.quantity/f.ingredients.unit.conversion_rate_to_grams:0,W=((se=f.ingredients.unit)==null?void 0:se.conversion_rate_to_grams)===((re=f.ingredients.unitInv)==null?void 0:re.conversion_rate_to_grams_for_check),z=((ae=f.ingredients.unitInv)==null?void 0:ae.unitInv_tag)===((me=f.ingredients.unit)==null?void 0:me.unit_tag);return e.jsx("li",{style:{backgroundColor:(()=>{const qe=$.find(Be=>Be.id===f.id);return qe!=null&&qe.preselected?"lightgreen":qe!=null&&qe.predisqualified?"red":"white"})(),color:f.predisqualified?"white":"black",padding:"5px",borderRadius:"5px",position:"relative"},children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:((Ne=$.find(qe=>qe.id===f.id))==null?void 0:Ne.preselected)||!1,onChange:()=>ct(f),disabled:((de=$.find(qe=>qe.id===f.id))==null?void 0:de.predisqualified)||!1}),((fe=$.find(qe=>qe.id===f.id))==null?void 0:fe.predisqualified)&&e.jsx("span",{style:{position:"absolute",top:"5px",right:"5px",backgroundColor:"darkred",color:"white",padding:"2px 6px",borderRadius:"3px",fontSize:"12px",fontWeight:"bold"},children:"Not Enough for 1 Unit"}),z?e.jsxs(e.Fragment,{children:[f.quantity||0," ",((ye=f.ingredients.unit)==null?void 0:ye.unit_description)||"unit not specified"]}):W?e.jsxs(e.Fragment,{children:[f.quantity||0," ",((be=f.ingredients.unitInv)==null?void 0:be.unitInv_tag)||"unit not specified"," /",((De=f.ingredients.unit)==null?void 0:De.unit_description)||"unit not specified"]}):e.jsxs(e.Fragment,{children:[f.quantity||0," ",((Ie=f.ingredients.unitInv)==null?void 0:Ie.unitInv_tag)||"unit not specified"," /",Math.round(B)," ",((K=f.ingredients.unit)==null?void 0:K.unit_description)||"unit not specified"]}),"(Expiry: ",((Se=f.expiry_date)==null?void 0:Se.date)||"No expiry date",")"]})},f.id)})]}),e.jsx("button",{onClick:rt,style:{marginTop:"10px",padding:"10px 20px",background:"green",color:"white",borderRadius:"5px"},children:"Confirm Selection"})]}),e.jsx("button",{onClick:()=>ee(null),style:{marginTop:"10px",marginLeft:"10px",padding:"10px 20px",background:"red",color:"white",borderRadius:"5px"},children:"Cancel"})]})})}),u&&e.jsx("div",{className:"modal-overlay",onClick:Ve,style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs("div",{className:"modal-content",onClick:f=>f.stopPropagation(),style:{background:"white",padding:"20px",borderRadius:"10px",width:"400px",maxHeight:"90vh",overflowY:"auto"},children:[e.jsx("h3",{children:"Arrange Cooking Sequence"}),e.jsx(pr,{recipes:N,setRecipes:w}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{onClick:Ve,style:{background:"red",color:"white",padding:"10px 20px",borderRadius:"5px"},children:"Cancel"}),e.jsx("button",{onClick:()=>{_t(),Rt()},style:{background:"green",color:"white",padding:"10px 20px",borderRadius:"5px"},children:"Confirm"})]})]})}),ve&&e.jsxs("div",{className:"cooking-mode-overlay",children:[e.jsxs("h2",{className:"cooking-mode-title",children:["Recipe: ",((Tt=N[he])==null?void 0:Tt.name)||"Unknown Recipe"," - Step"," ",_e+1]}),e.jsx("p",{className:"cooking-mode-instruction",children:((Mt=(Lt=(At=N[he])==null?void 0:At.steps)==null?void 0:Lt[_e])==null?void 0:Mt.instruction)||"No instruction available"}),e.jsxs("div",{className:"cooking-mode-buttons",children:[he>0&&_e===0&&e.jsx("button",{onClick:()=>{var f,B;we(W=>W-1),ke(((B=(f=N[he-1])==null?void 0:f.steps)==null?void 0:B.length)-1||0)},className:"cooking-mode-button previous-recipe-button",children:"Go to Previous Recipe"}),e.jsx("button",{onClick:Vn,className:`cooking-mode-button ${_e===0?"hidden":""}`,children:"Previous Step"}),e.jsx("button",{onClick:zn,className:`cooking-mode-button ${_e===(((Qt=($t=N[he])==null?void 0:$t.steps)==null?void 0:Qt.length)-1||0)?"hidden":""}`,children:"Next Step"}),_e===(((Bt=(Ot=N[he])==null?void 0:Ot.steps)==null?void 0:Bt.length)-1||0)&&(he<N.length-1?e.jsx("button",{onClick:()=>{we(f=>f+1),ke(0)},className:"cooking-mode-button next-recipe-button",children:"Proceed to Next Recipe"}):e.jsx("button",{onClick:Wn,className:"cooking-mode-button finish-cooking-button",children:"Finish Cooking"})),e.jsx("button",{onClick:Rt,className:"cooking-mode-button exit-cooking-button",children:"Exit Cooking Mode"})]})]})]})},xr=()=>{var pe,ve;const{favorites:n,toggleFavorite:s,fetchRecipesByIds:i,loading:a,filters:r,mealTypes:c,userData:y,applyFilters:l}=st(),[h,p]=t.useState([]),[g,o]=t.useState(!0),[b,x]=t.useState([]),[L,k]=t.useState([]),[R,m]=t.useState([]),[_,N]=t.useState(""),[w,C]=t.useState(!1),[G,u]=t.useState(!1),[v,D]=t.useState(""),[j,S]=t.useState([]),M=Je(),Q=ue(),[ee,F]=t.useState(null),[T,$]=t.useState({notes:"",time:"",meal_type_id:"",planned_date:"",recipe_id:""}),{planned_date:U,meal_type_id:X,activity_type:q}=M.state||{},Y=((pe=c.find(A=>A.id===X))==null?void 0:pe.name)||"Unknown Meal Type",P=async()=>{try{const[{data:A},{data:he},{data:we}]=await Promise.all([d.from("category").select("id, name"),d.from("tags").select("id, name"),d.from("equipment").select("id, name")]);x(A||[]),k(he||[]),m(we||[])}catch(A){console.error("Error fetching filter options:",A)}};t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]),t.useEffect(()=>{(async()=>{if(n.length===0){p([]),o(!1);return}try{const he=await i(n);if(he){const we=he.map(_e=>{var ke,Re;return{..._e,tags:((ke=_e.recipe_tags)==null?void 0:ke.map(Te=>Te.tags.name))||[],equipment:((Re=_e.recipe_equipment)==null?void 0:Re.map(Te=>Te.equipment.name))||[]}});p(we)}else p([])}catch(he){console.error("Error fetching favorite recipes:",he.message),p([])}finally{o(!1)}})(),P()},[n,i]);const I=h.filter(A=>{var Te;const he=(Te=A.name)==null?void 0:Te.toLowerCase().includes(_.toLowerCase()),we=r.categories.length?r.categories.some(Oe=>(A.categories||[]).includes(Oe)):!0,_e=r.tags.length?r.tags.some(Oe=>(A.tags||[]).includes(Oe)):!0,ke=r.equipment.length?r.equipment.some(Oe=>(A.equipment||[]).includes(Oe)):!0,Re=r.cookTime?A.cook_time<=r.cookTime:!0;return he&&we&&_e&&ke&&Re}),E=A=>{r.ingredients.includes(A.name)||(l({ingredients:[...r.ingredients,A.name]}),S(he=>({...he,[A.name]:A.icon_path})))},te=A=>{l({ingredients:r.ingredients.filter(he=>he!==A)})},ne=()=>{C(!1)},oe=()=>r.categories.length===b.length&&r.tags.length===L.length&&r.equipment.length===R.length,H=()=>r.categories.length>0||r.tags.length>0||r.equipment.length>0,V=()=>{l({categories:b.map(A=>A.name),tags:L.map(A=>A.name),equipment:R.map(A=>A.name)})},ce=()=>{l({categories:[],tags:[],equipment:[]})},ge=async A=>{if(!A.trim()){S([]);return}try{const{data:he,error:we}=await d.from("ingredients").select("name, icon_path").ilike("name",`%${A}%`);if(we){console.error("Error fetching ingredients:",we);return}console.log("Matching Ingredients:",he),S(he||[])}catch(he){console.error("Unexpected error:",he)}},je=async()=>{try{const{error:A}=await d.from("meal_plan").insert([{user_id:y.id,recipe_id:T.recipe_id,planned_date:T.planned_date,meal_type_id:T.meal_type_id,notes:T.notes,time:T.time,serving_packs:T.servingPacks||1}]);if(A){console.error("Error adding meal:",A.message);return}alert("Meal successfully added!"),F(null)}catch(A){console.error("Unexpected error adding meal:",A.message)}},O=A=>{var we;const he=((we=c.find(_e=>_e.id===X))==null?void 0:we.default_time)||"12:00";$({notes:"",time:he,meal_type_id:X,planned_date:U,recipe_id:A}),F(!0)};return g||a?e.jsx(Ue,{}):e.jsxs("div",{className:"explore-recipes-container",children:[e.jsx(Le,{}),e.jsx("h1",{className:"page-title",children:"Your Favorite Recipes"}),U&&q&&X&&e.jsx("div",{className:"meal-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Scheduling for:"})," ",U," (",Y,")"]})}),e.jsxs("div",{className:"search-container",children:[e.jsx("input",{type:"text",placeholder:"Search recipes...",value:_,onChange:A=>N(A.target.value),className:"search-input"}),e.jsx("button",{onClick:()=>C(!0),className:"filters-button",title:"Filter",children:e.jsx("svg",{viewBox:"0 0 512 512",height:"1em",children:e.jsx("path",{d:"M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z"})})})]}),e.jsx("div",{className:"recipes-list",children:I.length>0?I.map(A=>{var he,we;return e.jsxs("div",{onClick:()=>Q(`/recipes/recipe/${A.id}`,{state:{planned_date:U,meal_type_id:X,recipe_id:A.id,recipe_name:A.name,activity_type:q}}),className:"recipe-card",title:`View details for ${A.name}`,children:[e.jsxs("div",{className:"image-container",children:[e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${A.image_path}`,alt:A.name,className:"recipe-image"}),e.jsx("button",{onClick:_e=>{_e.stopPropagation(),s(A.id)},className:"favorite-button",children:n.includes(A.id)?"❤️":"🤍"})]}),e.jsxs("div",{className:"recipe-details",children:[e.jsx("h3",{children:A.name}),e.jsx("p",{children:A.description}),e.jsxs("p",{children:["Prep Time: ",A.prep_time," mins"]}),e.jsxs("p",{children:["Cook Time: ",A.cook_time," mins"]}),U&&X&&e.jsx("button",{onClick:_e=>{_e.stopPropagation(),O(A.id)},className:"add-to-meal-button",children:"Add to Meal"}),((he=A.tags)==null?void 0:he.length)>0&&e.jsxs("div",{className:"tags-container",children:[e.jsx("strong",{children:"Tags:"}),A.tags.map((_e,ke)=>e.jsx("span",{className:"tag",children:_e},ke))]}),((we=A.equipment)==null?void 0:we.length)>0&&e.jsxs("div",{className:"equipment-container",children:[e.jsx("strong",{children:"Equipment:"}),A.equipment.map((_e,ke)=>e.jsx("span",{className:"equipment",children:_e},ke))]})]})]},A.id)}):e.jsx("p",{className:"no-recipes-message",children:"No favorite recipes found. Start adding some!"})}),w&&e.jsxs("div",{className:"filter-overlay",children:[e.jsx("button",{className:"close-button",onClick:()=>C(!1),children:"X"}),e.jsx("h2",{className:"filter-title",children:"Filter Options"}),e.jsxs("div",{className:"filter-content",children:[!H()&&e.jsx("button",{onClick:V,className:"select-all-button",children:"Select All"}),H()&&!oe()&&e.jsxs("div",{className:"filter-buttons",children:[e.jsx("button",{onClick:ce,className:"clear-button",children:"Clear"}),e.jsx("button",{onClick:V,className:"select-all-button",children:"Select All"})]}),oe()&&e.jsx("button",{onClick:ce,className:"deselect-all-button",children:"Deselect All"})]}),e.jsxs("div",{className:"scrollable-content",children:[e.jsx("button",{onClick:()=>u(!0),className:"add-ingredient-button",children:"+ Search Recipe by Ingredient"}),e.jsxs("div",{className:"selected-ingredients",children:[e.jsx("h3",{children:"Selected Ingredients:"}),r.ingredients.length>0?r.ingredients.map((A,he)=>e.jsxs("div",{className:"ingredient-item",children:[e.jsx("span",{children:A}),e.jsx("button",{onClick:()=>te(A),className:"remove-ingredient-button",children:"X"})]},he)):e.jsx("p",{children:"No ingredients selected."})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("h3",{children:"Category"}),b.map(A=>e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:r.categories.includes(A.name),onChange:he=>{const we=he.target.checked;l({...r,categories:we?[...r.categories,A.name]:r.categories.filter(_e=>_e!==A.name)})}}),A.name]},A.id))]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("h3",{children:"Tags"}),L.map(A=>e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:r.tags.includes(A.name),onChange:he=>{const we=he.target.checked;l({...r,tags:we?[...r.tags,A.name]:r.tags.filter(_e=>_e!==A.name)})}}),A.name]},A.id))]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("h3",{children:"Equipment"}),R.map(A=>e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:r.equipment.includes(A.name),onChange:he=>{const we=he.target.checked;l({...r,equipment:we?[...r.equipment,A.name]:r.equipment.filter(_e=>_e!==A.name)})}}),A.name]},A.id))]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("h3",{children:"Cooking Time"}),e.jsxs("select",{className:"cook-time-dropdown",value:r.cookTime||"",onChange:A=>l({...r,cookTime:A.target.value?Number(A.target.value):null}),children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"15",children:"Less than 15 mins"}),e.jsx("option",{value:"30",children:"Less than 30 mins"}),e.jsx("option",{value:"60",children:"Less than 60 mins"})]})]})]}),e.jsx("button",{onClick:ne,className:"apply-filters-button",children:"Apply Filters"})]}),G&&e.jsxs("div",{className:"ingredient-overlay",children:[e.jsx("button",{onClick:()=>u(!1),className:"close-overlay-button",children:"X"}),e.jsx("h2",{children:"Search Ingredients"}),e.jsx("div",{className:"search-bar",children:e.jsx("input",{type:"text",placeholder:"Type an ingredient...",value:v,onChange:A=>{D(A.target.value),ge(A.target.value)}})}),e.jsx("div",{className:"matching-ingredients",children:j.length>0?j.map((A,he)=>e.jsxs("div",{className:"ingredient-item",onClick:()=>E(A),children:[e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${A.icon_path}`,alt:A.name,className:"ingredient-icon"}),e.jsx("span",{children:A.name})]},he)):e.jsx("p",{children:"No matching ingredients found."})}),e.jsxs("div",{className:"selected-ingredients",children:[e.jsx("h3",{children:"Selected Ingredients:"}),r.ingredients.length>0?r.ingredients.map((A,he)=>e.jsxs("div",{className:"ingredient-item",children:[e.jsx("span",{children:A}),e.jsx("button",{onClick:()=>te(A),className:"remove-ingredient-button",children:"X"})]},he)):e.jsx("p",{children:"No ingredients selected."})]}),e.jsx("button",{onClick:()=>u(!1),className:"find-recipes-button",children:"Find Recipes"})]}),ee&&e.jsx("div",{className:"favorite-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Add a Meal"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Meal Type:"})," ",((ve=c.find(A=>A.id===T.meal_type_id))==null?void 0:ve.name)||"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Planned Date:"})," ",T.planned_date]}),e.jsxs("div",{className:"serving-adjuster",children:[e.jsx("strong",{children:"Serving Packs:"}),e.jsxs("div",{className:"adjuster-buttons",children:[e.jsx("button",{onClick:()=>$(A=>({...A,servingPacks:Math.max(1,(A.servingPacks||1)-1)})),className:"adjust-serving-button",children:"-"}),e.jsx("span",{className:"serving-count",children:T.servingPacks||1}),e.jsx("button",{onClick:()=>$(A=>({...A,servingPacks:(A.servingPacks||1)+1})),className:"adjust-serving-button",children:"+"})]})]}),e.jsxs("label",{children:["Notes:",e.jsx("textarea",{value:T.notes,placeholder:"Enter additional notes (e.g., extra ingredients, instructions)",onChange:A=>$(he=>({...he,notes:A.target.value})),rows:"3"})]}),e.jsxs("label",{children:["Time:",e.jsx("input",{type:"time",value:T.time,onChange:A=>$(he=>({...he,time:A.target.value}))})]}),e.jsx("button",{onClick:je,className:"save-meal-button",children:"Save"}),e.jsx("button",{onClick:()=>F(null),className:"cancel-button",children:"Cancel"})]})})]})};class fr extends Hn.Component{constructor(s){super(s),this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0}}render(){return this.state.hasError?e.jsx("h1",{children:"Something went wrong."}):this.props.children}}const Rn=({chatHistory:n})=>{const s=t.useRef(null);return t.useEffect(()=>{var i;(i=s.current)==null||i.scrollTo({top:s.current.scrollHeight,behavior:"smooth"})},[n]),e.jsx("div",{className:"chat-history",ref:s,children:n.map((i,a)=>e.jsx("div",{className:`message ${i.type==="user"?"user":"bot"}`,children:e.jsx(Fs,{className:"markdown-output",remarkPlugins:[Us],children:i.message})},a))})};Rn.propTypes={chatHistory:Qe.arrayOf(Qe.shape({type:Qe.string.isRequired,message:Qe.string.isRequired})).isRequired};const yr=()=>e.jsxs("div",{className:"typing-indicator",children:[e.jsx("div",{className:"typing-circle"}),e.jsx("div",{className:"typing-circle"}),e.jsx("div",{className:"typing-circle"}),e.jsx("div",{className:"typing-shadow"}),e.jsx("div",{className:"typing-shadow"}),e.jsx("div",{className:"typing-shadow"})]}),Fn=({isLoading:n})=>n?e.jsx(yr,{}):null;Fn.propTypes={isLoading:Qe.bool.isRequired};const jr=`
You are an intelligent recipe assistant designed to help users find recipes based on their preferences, dietary restrictions, and cooking requirements.
You are an intelligent recipe assistant named Time2Use, designed for the CAT304 Assignment in Universiti Sains Malaysia.
Your sole purpose is to assist users with topics strictly related to food, recipes, cooking, ingredients, culinary techniques, and chef-related matters. You must avoid answering or engaging with any unrelated topics.

### Your Purpose:
- Understand natural language inputs from users.
- Suggest appropriate recipes by interpreting user intents.
- Apply relevant filters for recipe tags, categories, equipment, cooking time, or ingredients.
- Answer general queries without applying filters.

### Guidelines:
1. Analyze the user's input for keywords and context. 
   - Examples:
     - "I feel sick" -> Vegetarian or light meals.
     - "Quick recipes under 20 minutes" -> Recipes with cooking time <= 20 minutes.
     - "I need something spicy" -> Recipes with spicy tags.
   - For questions like "What recipes do I have?", "What are the available tags?", or "Show me all ingredients," respond naturally and list the information without applying filters.
     - Use the special tag \`[GENERAL QUERY]\` to differentiate general questions from filter commands.

2. Use user preferences to identify:
   - Tags: Spicy, sweet, vegetarian, etc.
   - Categories: Breakfast, lunch, dinner, etc.
   - Equipment: Blender, oven, etc.
   - Ingredients: Chicken, tofu, spinach, etc.
   - Cooking Time: Duration (e.g., under 30 minutes).

3. Respond naturally and conversationally:
   - For general queries (e.g., "What recipes do I have?"), use \`[GENERAL QUERY]\` and respond with a simple list: 
     - "You currently have access to these recipes: [list of recipes]."
   - Do not apply filters unless explicitly asked.

4. Clarify if needed:
   - If the user input is ambiguous, ask for clarification: "Could you please specify your preferences?"

### Your Behavior:
- Be friendly, helpful, and concise.
- If the user asks a general question, use \`[GENERAL QUERY]\` and respond with relevant data without changing filters.
- For commands like "apply filters" or "clear filters," execute the action and confirm.

### Your Inputs:
- Consider prior chat history to understand context.
- Accept inputs such as:
  - Dietary preferences ("vegetarian," "keto").
  - Specific ingredients ("chicken," "spinach").
  - Cooking constraints ("under 15 minutes").
  - General queries ("What recipes do I have?", "List all tags.").

### Your Outputs:
- Process input to derive filtering criteria for recipes or to answer general questions.
- Return a response with matched filters or suggestions for clarification.

EXAMPLES:
User: I’m in a hurry.  
Response: "Here are some quick recipes under 15 minutes."

User: I feel sick.  
Response: "I suggest these vegetarian recipes that are easy on the stomach."

User: Clear filters.  
Response: "All filters cleared. Showing all recipes."

User: Show me spicy food.  
Response: "Here are some spicy recipes you might like."

User: What recipes do I have?  
Response: "[GENERAL QUERY] You currently have access to these recipes: [list of recipes]."

Be proactive and engaging in your responses.
`,vr="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='%23000000'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20%3e%3crect%20x='3'%20y='11'%20width='18'%20height='10'%20rx='2'%20/%3e%3ccircle%20cx='12'%20cy='5'%20r='2'%20/%3e%3cpath%20d='M12%207v4'%20/%3e%3cline%20x1='8'%20y1='16'%20x2='8'%20y2='16'%20/%3e%3cline%20x1='16'%20y1='16'%20x2='16'%20y2='16'%20/%3e%3c/svg%3e",br=()=>{const[n,s]=t.useState(""),[i,a]=t.useState([]),[r,c]=t.useState(!1),y=t.useRef(null),l=Je(),h=ue(),p=l.pathname,[g,o]=t.useState(!1),[b,x]=t.useState(null),[L,k]=t.useState(!1),{tags:R,categories:m,equipment:_,ingredients:N,recipes:w,filters:C,applyFilters:G,fetchRecipes:u}=st(),v="AIzaSyAcjRHaEpo59EzIa3pgSvwfGcCE1dvGkbo",j=new Rs(v).getGenerativeModel({model:"gemini-1.5-flash"}),S=$=>{s($.target.value)};t.useEffect(()=>{var $;($=y.current)==null||$.scrollIntoView({behavior:"smooth"})},[i]);const M=$=>{o(!1),a(U=>[...U,{type:"user",message:$==="yes"?"Yes":"No"}]),$==="yes"&&b==="NAVIGATE_TO_RECIPE_EXPLORE"?(h("/recipes/explore"),a(U=>[...U,{type:"bot",message:"Navigated to RecipeExplore. What would you like me to help with?"}])):a(U=>[...U,{type:"bot",message:"No worries! Let me know if there's anything else you'd like me to help with."}]),x(null)},Q=async()=>{if(n.trim()!==""){a($=>[...$,{type:"user",message:n}]),s(""),c(!0);try{const $=i.map(E=>`${E.type==="user"?"User:":"Bot:"} ${E.message}`).join(`
`),U=`
    Available Tags: ${R.map(E=>E.name).join(", ")}
    Available Categories: ${m.map(E=>E.name).join(", ")}
    Available Ingredients: ${N.map(E=>E.name).join(", ")}
    Available Recipes: ${w.map(E=>E.name).join(", ")}
        `,X=`${jr}
${U}
${$}
User: ${n}`;console.log("Sending prompt to API:",X);const P=(await(await j.generateContent(X)).response).text();if(console.log("Gemini Response:",P),P.includes("[GENERAL QUERY]")){a(E=>[...E,{type:"bot",message:P.replace("[GENERAL QUERY]","").trim()}]);return}const I=P.toLowerCase().includes("apply")||P.toLowerCase().includes("filter");if(I&&p!=="/recipes/explore"){o(!0),x("NAVIGATE_TO_RECIPE_EXPLORE"),a(E=>[...E,{type:"bot",message:"It looks like you're not on the RecipeExplore page. Would you like to navigate there to apply filters? (Yes/No)"}]);return}if(P.toLowerCase().includes("apply all filters")||n.toLowerCase().includes("apply all filters")){G({tags:R.map(E=>E.name),categories:m.map(E=>E.name),equipment:_.map(E=>E.name),cookTime:null}),await u(),a(E=>[...E,{type:"bot",message:"All filters have been applied. Showing recipes!"}]);return}if(P.toLowerCase().includes("clear filters")||n.toLowerCase().includes("clear")){G({tags:[],categories:[],equipment:[],cookTime:null,ingredients:[]}),await u(),a(E=>[...E,{type:"bot",message:"All filters cleared. Showing all recipes!"}]);return}if(I){const E=P.toLowerCase(),te=R.find(je=>E.includes(je.name.toLowerCase())),ne=m.find(je=>E.includes(je.name.toLowerCase())),oe=_.find(je=>E.includes(je.name.toLowerCase())),H=E.match(/under (\d+)\s*minutes/),V=H?parseInt(H[1]):null,ce=N.filter(je=>E.includes(je.name.toLowerCase()));G({tags:te?[...C.tags,te.name]:C.tags,categories:ne?[...C.categories,ne.name]:C.categories,equipment:oe?[...C.equipment,oe.name]:C.equipment,cookTime:V||C.cookTime,ingredients:ce.length>0?[...C.ingredients,...ce.map(je=>je.name)]:C.ingredients}),await u();const ge=[te&&`Tag: ${te.name}`,ne&&`Category: ${ne.name}`,oe&&`Equipment: ${oe.name}`,V&&`Cooking Time: Under ${V} minutes`,ce.length>0&&`Ingredients: ${ce.map(je=>je.name).join(", ")}`].filter(Boolean).join(", ");a(je=>[...je,{type:"bot",message:ge?`Filters applied: ${ge}.`:P}])}else a(E=>[...E,{type:"bot",message:P}])}catch($){console.error("Error sending message:",$),a(U=>[...U,{type:"bot",message:"An error occurred. Please try again."}])}finally{s(""),c(!1)}}},ee=()=>{a([])},F=()=>{k($=>{const U=!$;return document.body.classList.toggle("overlay-open",U),U})},T=$=>{$.target.classList.contains("chat-overlay")&&k(!1)};return t.useEffect(()=>{const $=U=>{L&&U.target.classList.contains("chat-overlay")&&k(!1)};return window.addEventListener("pointerdown",$),()=>{window.removeEventListener("pointerdown",$)}},[L]),e.jsxs("div",{className:"chatbot-container",children:[e.jsx("div",{className:"chat-icon",onClick:F,children:e.jsx("img",{src:vr,alt:"Chatbot"})}),L&&e.jsx("div",{className:"chat-overlay",onClick:T,children:e.jsxs("div",{className:"chat-content",children:[e.jsxs("div",{className:"chat-header",children:[e.jsx("h1",{className:"title",children:"Chatbot"}),e.jsx("button",{className:"clear-chat-button",onClick:ee,children:e.jsx("svg",{className:"trash-can-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 7V18C6 19.1046 6.89543 20 8 20H16C17.1046 20 18 19.1046 18 18V7M6 7H5M6 7H8M18 7H19M18 7H16M10 11V16M14 11V16M8 7V5C8 3.89543 8.89543 3 10 3H14C15.1046 3 16 3.89543 16 5V7M8 7H16",stroke:"#000000","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})})}),e.jsx("button",{className:"close-chatbot-button",onClick:F,children:"✖"})]}),e.jsxs("div",{className:"chat-box",children:[e.jsx(Rn,{chatHistory:i}),e.jsx(Fn,{isLoading:r})]}),e.jsxs("div",{className:"input-section",children:[e.jsx("input",{type:"text",className:"input-box",placeholder:"Type your message...",value:n,onChange:S}),e.jsx("button",{className:"send-msg-button",onClick:Q,disabled:r,children:e.jsx("svg",{viewBox:"0 0 512 512",className:"paperplane",children:e.jsx("path",{d:"M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480V396.4c0-4 1.5-7.8 4.2-10.7L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"})})})]})]})}),g&&e.jsx("div",{className:"navigation-modal-overlay",children:e.jsxs("div",{className:"navigaton-modal",children:[e.jsx("p",{children:"Would you like to navigate to the RecipeExplore page?"}),e.jsxs("div",{className:"left-right-space-evenly-section",children:[e.jsx("button",{className:"yes-no-button",onClick:()=>M("yes"),children:"Yes"}),e.jsx("button",{className:"yes-no-button",onClick:()=>M("no"),children:"No"})]})]})})]})},_r=()=>(t.useEffect(()=>(document.body.classList.add("page"),()=>{document.body.classList.remove("page")}),[]),e.jsx("div",{style:{position:"relative"},children:e.jsxs(ir,{children:[e.jsxs(kt,{children:[e.jsx(le,{path:"/",element:e.jsx(ze,{to:"dashboard"})}),e.jsx(le,{path:"dashboard",element:e.jsx(ar,{})}),e.jsx(le,{path:"explore",element:e.jsx(or,{})}),e.jsx(le,{path:"recipe/:id",element:e.jsx(cr,{})}),e.jsx(le,{path:"calendar",element:e.jsx(lr,{})}),e.jsx(le,{path:"calendar/:date",element:e.jsx(dr,{})}),e.jsx(le,{path:"calendar/preparation/:date",element:e.jsx(gr,{})}),e.jsx(le,{path:"favorites",element:e.jsx(xr,{})}),e.jsx(le,{path:"*",element:e.jsx(ze,{to:"dashboard"})})]}),e.jsx(fr,{children:e.jsx(br,{})})]})})),yn="/Time2Use/assets/default_propic-C3a0Y4dY.png",Nr=({onClose:n,onChangePicture:s,onRemovePicture:i,isImageUploaded:a})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h3",{children:"Profile Picture Options"}),e.jsx("div",{className:"button-container",children:a?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s,children:"Change Image"}),e.jsx("button",{onClick:i,children:"Remove Image"})]}):e.jsx("button",{onClick:s,children:"Upload Image"})}),e.jsx("button",{onClick:n,children:"Close"})," "]})}),wr=()=>{var Y;const n=ue(),{updateUserRole:s}=It(),[i,a]=t.useState(!1),[r,c]=t.useState(null),[y,l]=t.useState([3]),[h,p]=t.useState({username:"",birthday:"",email:"",password:"••••••••",notificationDay:3}),[g,o]=t.useState(""),[b,x]=t.useState(!1),[L,k]=t.useState(!1),[R,m]=t.useState(!1),[_,N]=t.useState(!1),[w,C]=t.useState(""),[G,u]=t.useState(""),[v,D]=t.useState(""),[j,S]=t.useState(!1),M=t.useRef(null),Q=r!==null&&r!==yn,ee=P=>{if(!P)return"";const I=new Date(P),E=String(I.getDate()).padStart(2,"0"),te=String(I.getMonth()+1).padStart(2,"0"),ne=I.getFullYear();return`${E} / ${te} / ${ne}`};t.useEffect(()=>{(async()=>{var V;const{data:{user:I},error:E}=await d.auth.getUser();if(E){console.error("Error fetching user:",E);return}const{data:te,error:ne}=await d.from("profile").select("username, birthday, picture, notification_day(id, day)").eq("user",I.id).single();ne?console.error("Error fetching profile:",ne):(p({username:te.username,birthday:te.birthday,email:I.email,password:"••••••••",notificationDay:((V=te.notification_day)==null?void 0:V.id)||5}),c(te.picture));const{data:oe,error:H}=await d.from("notification_day").select("*");H?console.error("Error fetching notification options:",H):l(oe)})()},[]);const F=async P=>{const I=P.target.files[0];if(I){const E=`${Date.now()}-${I.name}`,{data:te,error:ne}=await d.storage.from("profile-picture").upload(E,I);if(ne)console.error("Error uploading image:",ne.message);else{const{data:oe}=d.storage.from("profile-picture").getPublicUrl(E);c(oe==null?void 0:oe.publicUrl)}}},T=async()=>{c(null);const{data:{user:P},error:I}=await d.auth.getUser();if(I){console.error("Error fetching user:",I);return}const E={picture:null},{error:te}=await d.from("profile").update(E).eq("user",P.id);te?console.error("Error updating profile:",te):console.log("Profile picture removed successfully!"),S(!1)},$=async()=>{if(i){const{data:{user:P},error:I}=await d.auth.getUser();if(I){console.error("Error fetching user:",I);return}const E={username:g,birthday:h.birthday,picture:r,notification_day:h.notificationDay},{error:te}=await d.from("profile").update(E).eq("user",P.id);if(te?console.error("Error updating profile:",te):(console.log("Profile updated successfully!"),p(ne=>({...ne,username:g}))),w){if(w!==v){alert("Passwords do not match!");return}const{error:ne}=await d.auth.updateUser({password:w});ne?console.error("Error updating password:",ne):(console.log("Password updated successfully!"),C(""))}}else o(h.username);a(P=>!P)},U=async()=>{if(!G){alert("Please enter your password.");return}if(w===G){alert("Current and New passwords cannot be the same."),X();return}if(w.length<6){alert("New password must be at least 6 characters."),X();return}if(w!==v){alert("Passwords do not match!"),X();return}const{data:P,error:I}=await d.auth.signInWithPassword({email:h.email,password:G});if(I){alert("Current password is incorrect."),X();return}const{error:E}=await d.auth.updateUser({password:w});E?console.error("Error updating password:",E):(alert("Password updated successfully!"),x(!1),X(),a(!1),await q())},X=()=>{u(""),C(""),D("")},q=async()=>{try{const{error:P}=await d.auth.signOut();if(P)throw P;s(null),n("/login")}catch(P){console.error("Error signing out:",P.message)}};return e.jsxs("div",{className:`profile-container ${i?"edit-mode":""}`,children:[e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"profile-avatar",children:[e.jsx("img",{src:r||yn,alt:"Profile",className:"avatar-image"}),i&&e.jsx("div",{className:"edit-icon-container",children:e.jsx("label",{className:"edit-icon",onClick:()=>S(!0),children:e.jsx(un,{})})})]}),e.jsx("h1",{className:"profile-username",children:h.username})]}),e.jsxs("div",{className:"profile-details",children:[e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"icon",children:e.jsx(Xe,{})}),e.jsx("span",{className:"profile-label",children:"Username"}),i?e.jsx("input",{type:"text",value:g,onChange:P=>o(P.target.value),className:"edit-input"}):e.jsx("span",{className:"profile-value",children:h.username})]}),e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"icon",children:e.jsx(ss,{})}),e.jsx("span",{className:"profile-label",children:"Birthday"}),i?e.jsx("input",{type:"date",value:h.birthday,onChange:P=>p(I=>({...I,birthday:P.target.value})),className:"edit-input"}):e.jsx("span",{className:"profile-value",children:ee(h.birthday)})]}),e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"icon",children:e.jsx(rs,{})}),e.jsx("span",{className:"profile-label",children:"Email"}),e.jsx("span",{className:"profile-value",children:h.email})]}),e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"icon",children:e.jsx(is,{})}),e.jsx("span",{className:"profile-label",children:"Password"}),e.jsxs("div",{className:"profile-password",children:[e.jsx("span",{className:"profile-value",children:"••••••••"}),i&&e.jsx("button",{type:"button",className:"edit-icon-button",onClick:()=>x(!0),children:e.jsx(un,{})})]})]}),e.jsxs("div",{className:"profile-row",children:[e.jsx("span",{className:"icon",children:e.jsx(as,{})}),e.jsx("span",{className:"profile-label",children:"Notification"}),i?e.jsx("select",{value:h.notificationDay,onChange:P=>p(I=>({...I,notificationDay:parseInt(P.target.value,10)})),className:"notification-select",children:y.sort((P,I)=>P.day-I.day).map(P=>e.jsxs("option",{value:P.id,children:[P.day," Day(s) Before"]},P.id))}):e.jsxs("span",{className:"profile-value",children:[((Y=y.find(P=>P.id===h.notificationDay))==null?void 0:Y.day)||7," Day(s) Before"]})]})]}),e.jsx("div",{className:"edit-profile",children:e.jsx("button",{className:"profile-button",onClick:$,children:i?"Save":"Edit Profile"})}),e.jsx("div",{className:"edit-profile",children:e.jsx("button",{className:"profile-button",onClick:q,children:"Sign Out"})}),b&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h3",{children:"Change Password"}),e.jsxs("div",{className:"password-container",children:[e.jsxs("div",{className:"password-input",children:[e.jsx("label",{children:"Current Password"}),e.jsx("input",{type:_?"text":"password",value:G,placeholder:"Enter current password",onChange:P=>u(P.target.value),className:"password-edit-input"}),e.jsx("button",{type:"button",className:"toggle-password",onClick:()=>N(P=>!P),children:_?"👁️":"👁️‍🗨️"})]}),e.jsxs("div",{className:"password-input",children:[e.jsx("label",{children:"New Password"}),e.jsx("input",{type:L?"text":"password",value:w,placeholder:"Enter new password",onChange:P=>C(P.target.value),className:"password-edit-input"}),e.jsx("button",{type:"button",className:"toggle-password",onClick:()=>k(P=>!P),children:L?"👁️":"👁️‍🗨️"})]}),e.jsxs("div",{className:"password-input",children:[e.jsx("label",{children:"Confirm Password"}),e.jsx("input",{type:R?"text":"password",value:v,placeholder:"Confirm password",onChange:P=>D(P.target.value),className:"password-edit-input"}),e.jsx("button",{type:"button",className:"toggle-password",onClick:()=>m(P=>!P),children:R?"👁️":"👁️‍🗨️"})]})]}),e.jsx("button",{onClick:U,className:"save-password-btn",children:"Save"}),e.jsx("button",{onClick:()=>{X(),x(!1)},className:"cancel-btn",children:"Cancel"})]})}),e.jsx("input",{type:"file",ref:M,style:{display:"none"},onChange:F,accept:"image/*"}),j&&e.jsx(Nr,{onClose:()=>S(!1),onChangePicture:()=>{S(!1),M.current.click()},onRemovePicture:T,isImageUploaded:Q})]})},Cr=[{title:"Admin Dashboard",link:"/admin/dashboard",icon:e.jsx(jn,{})},{title:"Manage Users",link:"/admin/users",icon:e.jsx(Xe,{})},{title:"Manage Inventory",link:"/admin/inventories",icon:e.jsx(Xe,{})},{title:"Manage Ingredient",icon:e.jsx(Xe,{}),dropdown:!0,items:[{title:"Ingredients Category",dropdown:!0,items:[{title:"View All Category",link:"/admin/ingredientscat/",icon:e.jsx(Nt,{})}]},{title:"Ingredients",dropdown:!0,items:[{title:"View All Ingredient",link:"/admin/ingredients",icon:e.jsx(Nt,{})}]}]},{title:"Manage Expiry Date",link:"/admin/expirydate",icon:e.jsx(Xe,{})},{title:"Manage Unit",link:"/admin/units",icon:e.jsx(Xe,{})},{title:"Manage Unit Inv",link:"/admin/unitinv",icon:e.jsx(Xe,{})},{title:"Settings",link:"/admin/settings",icon:e.jsx(os,{})},{title:"Recipes",icon:e.jsx(cs,{}),dropdown:!0,items:[{title:"Recipes",dropdown:!0,items:[{title:"View All Recipes",link:"/admin/recipe-management/recipes",icon:e.jsx(Nt,{})},{title:"Add New Recipe",link:"/admin/recipe-management/recipes/create",icon:e.jsx(yt,{})}]},{title:"Categories",dropdown:!0,items:[{title:"View Categories",link:"/admin/recipe-management/categories",icon:e.jsx(ls,{})},{title:"Add New Category",link:"/admin/recipe-management/categories/create",icon:e.jsx(yt,{})}]},{title:"Tags",dropdown:!0,items:[{title:"View Tags",link:"/admin/recipe-management/tags",icon:e.jsx(ds,{})},{title:"Add New Tag",link:"/admin/recipe-management/tags/create",icon:e.jsx(yt,{})}]},{title:"Equipment",dropdown:!0,items:[{title:"View Equipment",link:"/admin/recipe-management/equipment",icon:e.jsx(us,{})},{title:"Add New Equipment",link:"/admin/recipe-management/equipment/create",icon:e.jsx(yt,{})}]}]}],Et=({isCollapsed:n,toggleSidebar:s})=>{const[i,a]=t.useState({}),r=ue(),c=l=>{n&&s(),a(h=>({...h,[l]:!h[l]}))},y=(l,h)=>{a(p=>{var g;return{...p,[l]:{...p[l],[h]:!((g=p[l])!=null&&g[h])}}})};return t.useEffect(()=>{n&&a({})},[n]),e.jsxs("div",{className:`side-nav-container ${n?"collapsed":""}`,children:[e.jsx("div",{className:"toggle-btn",onClick:s,children:n?e.jsx(ps,{}):e.jsx(hs,{})}),e.jsx("ul",{className:"side-nav-items",children:Cr.map((l,h)=>e.jsx("li",{className:"side-nav-item",children:l.dropdown?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown-header",children:[l.link?e.jsxs(mt,{to:l.link,className:({isActive:p})=>p?"active":"",children:[e.jsx("div",{className:"nav-icon",children:l.icon}),e.jsx("span",{className:"nav-title",children:l.title})]}):e.jsxs("div",{onClick:()=>c(h),className:"dropdown-toggle",children:[e.jsx("div",{className:"nav-icon",children:l.icon}),e.jsx("span",{className:"nav-title",children:l.title})]}),e.jsx("div",{className:"dropdown-arrow",onClick:p=>{p.stopPropagation(),c(h)},children:i[h]?e.jsx(pn,{}):e.jsx(hn,{})})]}),e.jsx("ul",{className:`nested-menu ${i[h]?"expanded":""}`,children:l.items.map((p,g)=>{var o,b;return e.jsx("li",{className:"nested-item",children:p.dropdown?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dropdown-header",onClick:()=>y(h,g),children:[e.jsx("span",{className:"nested-title",children:p.title}),(o=i[h])!=null&&o[g]?e.jsx(pn,{className:"dropdown-arrow"}):e.jsx(hn,{className:"dropdown-arrow"})]}),e.jsx("ul",{className:`nested-menu ${(b=i[h])!=null&&b[g]?"expanded":""}`,children:p.items.map((x,L)=>e.jsx("li",{className:"nested-item",children:e.jsx(mt,{to:x.link,className:({isActive:k})=>k?"active":"",children:x.title})},L))})]}):e.jsx(mt,{to:p.link,className:({isActive:x})=>x?"active":"",children:p.title})},g)})})]}):e.jsxs(mt,{to:l.link,className:({isActive:p})=>p?"active":"",children:[e.jsx("div",{className:"nav-icon",children:l.icon}),e.jsx("span",{className:"nav-title",children:l.title})]})},h))}),e.jsx("div",{className:"logout-container",children:e.jsxs("button",{className:"logout-btn",onClick:async()=>{await d.auth.signOut(),r("/login")},children:[e.jsx(ms,{className:"nav-icon"}),!n&&e.jsx("span",{className:"logout-text",children:"Logout"})]})})]})};Et.propTypes={isCollapsed:Qe.bool.isRequired,toggleSidebar:Qe.func.isRequired,onLogout:Qe.func.isRequired};const Ce=({children:n,isCollapsed:s,toggleSidebar:i})=>e.jsxs("div",{className:`admin-layout-container ${s?"collapsed":""}`,children:[e.jsx(Et,{isCollapsed:s,toggleSidebar:i}),e.jsxs("div",{className:"admin-content-wrapper",children:[e.jsx("header",{className:"admin-header",children:e.jsx("h1",{children:"Admin Panel"})}),e.jsx("div",{className:"admin-content",children:n}),e.jsx("footer",{className:"admin-footer",children:e.jsx("p",{children:"Time2Use Admin Panel © 2024-2025"})})]})]});Ce.propTypes={children:Qe.node.isRequired,isCollapsed:Qe.bool.isRequired,toggleSidebar:Qe.func.isRequired};const Sr=()=>{const[n,s]=t.useState(null),[i,a]=t.useState(0),[r,c]=t.useState(0),[y,l]=t.useState(0),h=ue();t.useEffect(()=>{(async()=>{var x;const{data:o,error:b}=await d.auth.getSession();if(b)console.error("Error fetching admin user:",b.message),h("/login");else{const L=((x=o==null?void 0:o.session)==null?void 0:x.user)||null;s(L),p()}})()},[h]);const p=async()=>{try{const{data:g,error:o}=await d.from("profile").select("id",{count:"exact"});if(o)throw o;const{data:b,error:x}=await d.from("ingredients").select("id",{count:"exact"});if(x)throw x;const L=b.length,{data:k,error:R}=await d.from("inventory").select("id",{count:"exact"});if(R)throw R;a(g.length),c(b.length),l(k.length)}catch(g){console.error("Error fetching counts:",g.message)}};return e.jsxs("div",{className:"admin-dashboard",children:[e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{children:"Admin Dashboard"}),n&&e.jsxs("p",{children:["Welcome, Admin ",n.email]}),e.jsx("button",{className:"sign-out-btn",onClick:async()=>{await d.auth.signOut(),h("/login")},children:"Sign Out"})]}),e.jsxs("div",{className:"stats-container",children:[e.jsxs("div",{className:"stats-box",children:[e.jsx("h2",{children:"Active Users"}),e.jsx("p",{children:i})]}),e.jsxs("div",{className:"stats-box",children:[e.jsx("h2",{children:"Total Number of Ingredients"}),e.jsx("p",{children:r})]}),e.jsxs("div",{className:"stats-box",children:[e.jsx("h2",{children:"Total Inventory Records"}),e.jsx("p",{children:y})]})]})]})},kr=()=>e.jsxs("div",{children:[e.jsx("h1",{children:"Recipe Management Dashboard"}),e.jsx("p",{children:"Welcome to the Recipe Management Dashboard!"})]}),Ir=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState([]),[c,y]=t.useState(!0),[l,h]=t.useState(null),[p,g]=t.useState(""),[o,b]=t.useState({key:"created_at",direction:"desc"}),[x,L]=t.useState(1),[k,R]=t.useState(1),m=10,_=async(u=1)=>{y(!0),h(null);try{const v=(u-1)*m,D=v+m-1,{data:j,count:S,error:M}=await d.from("recipes").select("*",{count:"exact"}).order(o.key,{ascending:o.direction==="asc"}).range(v,D);if(M)throw M;i(j),r(j),R(Math.ceil(S/m))}catch(v){h("Failed to fetch recipes."),console.error(v)}finally{y(!1)}},N=u=>{const v=u.target.value.toLowerCase();if(g(v),v){const D=s.filter(j=>j.name.toLowerCase().includes(v)||j.description.toLowerCase().includes(v));r(D)}else r(s)},w=u=>{let v="asc";o.key===u&&o.direction==="asc"&&(v="desc"),b({key:u,direction:v}),_(x)},C=u=>{u>0&&u<=k&&(L(u),_(u))};t.useEffect(()=>{_(x)},[x]);const G=async(u,v)=>{if(window.confirm("Are you sure you want to delete this recipe?"))try{y(!0);const{error:j}=await d.storage.from("recipe-pictures").remove([v]);if(j){console.error("Failed to delete image:",j),h("Failed to delete recipe image.");return}const{error:S}=await d.from("recipes").delete().eq("id",u);if(S)throw S;i(M=>M.filter(Q=>Q.id!==u)),r(M=>M.filter(Q=>Q.id!==u)),alert("Recipe and image deleted successfully.")}catch(j){h("Failed to delete recipe."),console.error(j)}finally{y(!1)}};return e.jsxs("div",{className:"recipes-container",children:[e.jsx("h1",{className:"recipes-title",children:"Manage Recipes"}),e.jsx("p",{className:"recipes-description",children:"View, create, and edit recipes."}),e.jsxs("div",{className:"recipes-controls",children:[e.jsx("input",{type:"text",placeholder:"Search recipes...",value:p,onChange:N,className:"recipes-search"}),e.jsx("button",{onClick:()=>_(x),className:"recipes-refresh-button",children:"Refresh"}),e.jsx("button",{onClick:()=>n("create"),className:"recipes-create-button",children:"Create Recipe"})]}),c&&e.jsx(Ue,{}),l&&e.jsx("p",{className:"recipes-error",children:l}),!c&&!l&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"recipes-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>w("id"),className:"recipes-table-header",children:["ID ",o.key==="id"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("name"),className:"recipes-table-header",children:["Name ",o.key==="name"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{className:"recipes-table-header",children:"Description"}),e.jsxs("th",{onClick:()=>w("prep_time"),className:"recipes-table-header",children:["Prep Time ",o.key==="prep_time"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("cook_time"),className:"recipes-table-header",children:["Cook Time ",o.key==="cook_time"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("created_at"),className:"recipes-table-header",children:["Created At ",o.key==="created_at"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{className:"recipes-table-header",children:"Image"}),e.jsx("th",{className:"recipes-table-header",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(u=>e.jsxs("tr",{className:"recipes-table-row",children:[e.jsx("td",{children:u.id}),e.jsx("td",{children:u.name}),e.jsx("td",{children:u.description}),e.jsxs("td",{children:[u.prep_time," mins"]}),e.jsxs("td",{children:[u.cook_time," mins"]}),e.jsx("td",{children:new Date(u.created_at).toLocaleString()}),e.jsx("td",{children:e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${u.image_path}`,alt:u.name,className:"recipes-image"})}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>n(`view/${u.id}`),className:"recipes-action-button recipes-view-button",children:"View"}),e.jsx("button",{onClick:()=>n(`edit/${u.id}`),className:"recipes-action-button recipes-edit-button",children:"Edit"}),e.jsx("button",{onClick:()=>G(u.id,u.image_path),className:"recipes-action-button recipes-delete-button",children:"Delete"})]})]},u.id))})]}),e.jsxs("div",{className:"recipes-pagination",children:[e.jsx("button",{onClick:()=>C(x-1),disabled:x===1,className:"pagination-button",children:"Previous"}),e.jsxs("span",{children:["Page ",x," of ",k]}),e.jsx("button",{onClick:()=>C(x+1),disabled:x===k,className:"pagination-button",children:"Next"})]})]}):!c&&e.jsx("p",{children:"No recipes found."})]})},Un=({initialIngredients:n,onIngredientUpdate:s})=>{const[i,a]=t.useState(n.map((l,h)=>({...l,position:h+1}))),r=_n(Nn(In)),c=l=>{const{active:h,over:p}=l;if(h.id!==p.id){const o=qn(i,i.findIndex(b=>b.id===h.id),i.findIndex(b=>b.id===p.id)).map((b,x)=>({...b,position:x+1}));a(o),s(o),console.log("Updated order:",o)}},y=()=>{const l={id:Date.now(),name:"",quantity:"",unit:"",ingredient_id:null},h=[...i,l];a(h),s(h)};return e.jsxs("div",{children:[e.jsx(wn,{sensors:r,collisionDetection:Cn,onDragEnd:c,children:e.jsx(Sn,{items:i.map(l=>l.id),strategy:kn,children:e.jsx("ul",{style:{listStyleType:"none",padding:0},children:i.map(l=>e.jsx(qr,{id:l.id,ingredient:l,onUpdate:h=>{const p=i.map(g=>g.id===h.id?h:g);a(p),s(p)},onRemove:h=>{const p=i.filter(g=>g.id!==h).map((g,o)=>({...g,position:o+1}));a(p),s(p)}},l.id))})})}),e.jsx("button",{onClick:y,style:{marginTop:"10px",padding:"10px 20px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"+ Add Ingredient"})]})},qr=({id:n,ingredient:s,onUpdate:i,onRemove:a})=>{const{attributes:r,listeners:c,setNodeRef:y,transform:l,transition:h}=vn({id:n}),p={transform:bn.Transform.toString(l),transition:h,border:"1px solid #ccc",margin:"10px 0",padding:"10px",borderRadius:"5px",display:"flex",alignItems:"center",justifyContent:"space-between",background:"#f9f9f9",position:"relative"},[g,o]=t.useState([]),[b,x]=t.useState(!1),L=async R=>{x(!0);try{const{data:m,error:_}=await d.from("ingredients").select(`
              *,
              unit:unit!ingredients_quantity_unit_id_fkey (
                unit_tag
              )
            `).ilike("name",`%${R}%`).limit(5);_?(console.error("Error fetching ingredients:",_),o([])):o(m.map(N=>({...N,unit:N.unit.unit_tag,image:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${N.icon_path}`})))}catch(m){console.error("Error:",m),o([])}finally{x(!1)}},k=R=>{i({...s,name:R.name,ingredient_id:R.id,unit:R.unit||"",image:R.image}),o([])};return e.jsxs("li",{ref:y,style:p,...r,children:[e.jsx("span",{...c,style:{cursor:"grab",marginRight:"10px",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:"☰"}),s.image&&e.jsx("img",{src:s.image,alt:s.name,style:{width:"30px",height:"30px",borderRadius:"50%",marginRight:"10px",objectFit:"cover"}}),e.jsxs("div",{style:{flex:1,position:"relative"},children:[e.jsx("input",{type:"text",value:s.name,placeholder:"Ingredient Name",onChange:R=>{const m=R.target.value;i({...s,name:m}),m.length>1?L(m):o([])},style:{width:"100%",marginBottom:"5px",padding:"8px",border:"1px solid #ccc",borderRadius:"4px"}}),g.length>0&&e.jsx("ul",{style:{listStyle:"none",padding:"10px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:"white",maxHeight:"200px",width:"100%",overflowY:"auto",position:"absolute",top:"calc(100% + 5px)",zIndex:100,boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:g.map(R=>e.jsxs("li",{onClick:()=>k(R),style:{padding:"10px",cursor:"pointer",backgroundColor:"#f4f4f4",borderBottom:"1px solid #ddd",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("img",{src:R.image,alt:R.name,style:{width:"30px",height:"30px",borderRadius:"50%",marginRight:"10px",objectFit:"cover"}}),e.jsxs("span",{style:{flex:1,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:[e.jsx("strong",{children:R.name}),R.unit&&` (${R.unit})`]}),R.category&&e.jsx("span",{style:{fontSize:"12px",color:"#666"},children:R.category})]},R.id))})]}),e.jsx("input",{type:"number",value:s.quantity,placeholder:"Quantity",onChange:R=>i({...s,quantity:R.target.value}),style:{width:"80px",marginRight:"10px"}}),e.jsx("input",{type:"text",value:s.unit,placeholder:"Unit",readOnly:!0,style:{width:"80px",marginRight:"10px",backgroundColor:"#000"}}),e.jsx("button",{onClick:()=>a(n),style:{background:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",padding:"5px 10px"},children:"Remove"})]})},Er=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState([]),[c,y]=t.useState([]),[l,h]=t.useState([]),[p,g]=t.useState([]),[o,b]=t.useState({name:"",description:"",prep_time:"",cook_time:"",total_time:0,category_ids:[],tag_ids:[],equipment_ids:[],ingredients:[{name:"",quantity:"",unit:""}],steps:[{description:""}],image:null}),[x,L]=t.useState(!1),[k,R]=t.useState(""),[m,_]=t.useState([]),[N,w]=t.useState([]);t.useEffect(()=>{(async()=>{const{data:Y}=await d.from("category").select("*"),{data:P}=await d.from("tags").select("*").order("name",{ascending:!0}),{data:I}=await d.from("equipment").select("*");i(Y),r(P),h(I)})()},[]),t.useEffect(()=>{(async()=>{const{data:Y,error:P}=await d.from("ingredients").select("*");P?console.error("Error fetching ingredients:",P.message):(console.log("Fetched ingredients:",Y),_(Y))})()},[]),t.useEffect(()=>{b(q=>({...q,total_time:Number(q.prep_time||0)+Number(q.cook_time||0)}))},[o.prep_time,o.cook_time]);const C=async()=>{try{const q=o.image;let Y=null;q&&(Y=await u(q,o.name));const{data:P,error:I}=await d.from("recipes").insert({name:o.name,description:o.description,prep_time:o.prep_time,cook_time:o.cook_time,image_path:Y}).select().single();if(I)throw I;const E=P.id;console.log("Recipe id:",E),await v(E,c),await D(E,m),await j(E,p),await S(E,o.steps),await M(E,N),console.log("Recipe saved successfully:",P),n("/admin/category-management/recipes")}catch(q){console.error("Error saving recipe:",q.message)}},G=q=>q.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),u=async(q,Y)=>{try{const P=G(Y),I=q.name.split(".").pop(),E=`${P}.${I}`,{data:te,error:ne}=await d.storage.from("recipe-pictures").upload(E,q,{cacheControl:"3600",upsert:!1});if(ne)throw ne;const oe=`recipe-pictures/${te.path}`;return console.log("File uploaded successfully:",oe),oe}catch(P){return console.error("Error uploading file:",P.message),null}},v=async(q,Y)=>{try{if(Y.length>0){const P=Y.map(E=>({recipe_id:q,tag_id:E.id})),{error:I}=await d.from("recipe_tags").insert(P);if(I)throw I;console.log("Recipe tags saved successfully!")}}catch(P){console.error("Error saving recipe tags:",P.message)}},D=async(q,Y)=>{try{if(Y.length>0){const P=Y.filter(E=>E.ingredient_id).map(E=>({recipe_id:q,ingredient_id:E.ingredient_id,quantity:parseFloat(E.quantity)}));if(P.length===0){console.error("No valid ingredients to save");return}const{error:I}=await d.from("recipe_ingredients").insert(P);if(I)throw I}}catch(P){console.error("Error saving recipe ingredients:",P.message)}},j=async(q,Y)=>{try{if(Y.length>0){const P=Y.map(E=>({recipe_id:q,equipment_id:E.id,quantity:1})),{error:I}=await d.from("recipe_equipment").insert(P);if(I)throw I;console.log("Recipe equipment saved successfully!")}}catch(P){console.error("Error saving recipe equipment:",P.message)}},S=async(q,Y)=>{try{if(Y.length>0){const P=Y.map((E,te)=>({recipe_id:q,step_number:te+1,instruction:E.description})),{error:I}=await d.from("steps").insert(P);if(I)throw I}}catch(P){console.error("Error saving recipe steps:",P.message)}},M=async(q,Y)=>{try{if(Y.length>0){const P=Y.map(E=>({recipe_id:q,category_id:E.id})),{error:I}=await d.from("recipe_category").insert(P);if(I)throw I;console.log("Recipe categories saved successfully!")}}catch(P){console.error("Error saving recipe categories:",P.message)}},Q=async()=>{if(k.trim()==="")return;const{data:q,error:Y}=await d.from("category").insert({name:k});Y?console.error("Error adding category:",Y):(i(P=>[...P,q[0]]),L(!1),R(""))},ee=(q,Y,P)=>{q.some(I=>I.id===P.id)||Y([...q,P])},F=(q,Y,P)=>{Y(q.filter(I=>I.id!==P))},T=q=>{_(q),console.log("Updated Ingredients:",q)},$=(q,Y)=>{b(P=>({...P,steps:P.steps.map((I,E)=>E===q?{...I,description:Y}:I)}))},U=()=>{b(q=>({...q,steps:[...q.steps,{description:""}]}))},X=q=>{b(Y=>({...Y,steps:Y.steps.filter((P,I)=>I!==q)}))};return e.jsxs("div",{className:"create-recipe-container",children:[e.jsx("h1",{className:"create-recipe-title",children:"Create New Recipe"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{htmlFor:"recipe-name",className:"form-label",children:"Recipe Name:"}),e.jsx("input",{type:"text",value:o.name,onChange:q=>b({...o,name:q.target.value}),required:!0,className:"form-input"}),e.jsx("label",{htmlFor:"recipe-description",className:"form-label",children:"Description:"}),e.jsx("textarea",{id:"recipe-description",value:o.description,onChange:q=>b({...o,description:q.target.value}),className:"form-textarea"}),e.jsx("label",{htmlFor:"recipe-image",className:"form-label",children:"Image: (only file with <1mb allowed)"}),e.jsx("input",{id:"recipe-image",type:"file",onChange:q=>b({...o,image:q.target.files[0]}),className:"form-file-input"})]}),e.jsxs("div",{className:"prep-details",children:[e.jsx("label",{className:"form-label",children:"Preparation Time (mins):"}),e.jsx("input",{type:"number",value:o.prep_time,onChange:q=>b({...o,prep_time:q.target.value}),className:"form-input"}),e.jsx("label",{className:"form-label",children:"Cooking Time (mins):"}),e.jsx("input",{type:"number",value:o.cook_time,onChange:q=>b({...o,cook_time:q.target.value}),className:"form-input"}),e.jsx("label",{className:"form-label",children:"Total Time (mins):"}),e.jsx("input",{type:"number",value:o.total_time,readOnly:!0,className:"form-input-readonly"})]}),e.jsx("h2",{className:"form-subtitle",children:"Categories"}),e.jsxs("select",{onChange:q=>{const Y=Number(q.target.value),P=s.find(I=>I.id===Y);P&&ee(N,w,P),q.target.value=""},className:"form-select",children:[e.jsx("option",{value:"",children:"Select a category..."}),s.map(q=>e.jsx("option",{value:q.id,children:q.name},q.id))]}),e.jsxs("div",{className:"selected-list",children:[e.jsx("h3",{className:"selected-list-title",children:"Selected Categories:"}),N.map(q=>e.jsxs("div",{className:"selected-item",children:[q.name," ",e.jsx("button",{className:"remove-button",onClick:()=>F(N,w,q.id),children:"Remove"})]},q.id))]}),e.jsx("h2",{className:"form-subtitle",children:"Tags"}),e.jsxs("select",{onChange:q=>{const Y=Number(q.target.value),P=a.find(I=>I.id===Y);P&&ee(c,y,P),q.target.value=""},className:"form-select",children:[e.jsx("option",{value:"",children:"Select a tag..."}),a.map(q=>e.jsx("option",{value:q.id,children:q.name},q.id))]}),e.jsxs("div",{className:"selected-list",children:[e.jsx("h3",{className:"selected-list-title",children:"Selected Tags:"}),c.map(q=>e.jsxs("div",{className:"selected-item",children:[q.name," ",e.jsx("button",{className:"remove-button",onClick:()=>F(c,y,q.id),children:"Remove"})]},q.id))]}),e.jsx("h2",{className:"form-subtitle",children:"Equipment"}),e.jsxs("select",{onChange:q=>{const Y=Number(q.target.value),P=l.find(I=>I.id===Y);P&&ee(p,g,P),q.target.value=""},className:"form-select",children:[e.jsx("option",{value:"",children:"Select equipment..."}),l.map(q=>e.jsx("option",{value:q.id,children:q.name},q.id))]}),e.jsxs("div",{className:"selected-list",children:[e.jsx("h3",{className:"selected-list-title",children:"Selected Equipment:"}),p.map(q=>e.jsxs("div",{className:"selected-item",children:[q.name," ",e.jsx("button",{className:"remove-button",onClick:()=>F(p,g,q.id),children:"Remove"})]},q.id))]}),x&&e.jsxs("div",{className:"modal",children:[e.jsx("h2",{className:"modal-title",children:"Add New Category"}),e.jsx("input",{type:"text",value:k,onChange:q=>R(q.target.value),className:"form-input"}),e.jsx("button",{onClick:Q,className:"button-primary",children:"Add"}),e.jsx("button",{onClick:()=>L(!1),className:"button-secondary",children:"Cancel"})]}),e.jsxs("div",{className:"ingredients-section",children:[e.jsx("h1",{className:"form-subtitle",children:"Create Recipe"}),e.jsx(Un,{initialIngredients:m,onIngredientUpdate:T})]}),e.jsxs("div",{className:"steps-section",children:[e.jsx("h2",{className:"form-subtitle",children:"Steps"}),o.steps.map((q,Y)=>e.jsxs("div",{className:"step-item",children:[e.jsx("textarea",{value:q.description,onChange:P=>$(Y,P.target.value),placeholder:`Step ${Y+1}`,className:"form-textarea"}),e.jsx("button",{onClick:()=>X(Y),className:"button-secondary remove-step-button",children:"Remove"})]},Y)),e.jsx("button",{onClick:U,className:"button-primary add-step-button",children:"+ Add Step"})]}),e.jsx("button",{onClick:C,className:"button-primary save-recipe-button",children:"Save Recipe"})]})},Dr=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState([]),[r,c]=t.useState([]),[y,l]=t.useState([]),[h,p]=t.useState([]),[g,o]=t.useState([]),[b,x]=t.useState([]),[L,k]=t.useState(null),[R,m]=t.useState({name:"",description:"",prep_time:"",cook_time:"",total_time:0,category_ids:[],tag_ids:[],equipment_ids:[],ingredients:[{name:"",quantity:"",unit:""}],steps:[{id:null,description:""}],image:null,image_path:""}),[_,N]=t.useState([]),[w,C]=t.useState(!0);t.useEffect(()=>{(async()=>{C(!0);try{const{data:T,error:$}=await d.from("recipes").select("*").eq("id",n).single();if($)throw $;const{data:U}=await d.from("category").select("*"),{data:X}=await d.from("tags").select("*").order("name",{ascending:!0}),{data:q}=await d.from("equipment").select("*"),{data:Y}=await d.from("recipe_ingredients").select(`
                        ingredient_id,
                        quantity,
                        ingredients (
                            name,
                            quantity_unit_id,
                            icon_path,
                            unit:unit!ingredients_quantity_unit_id_fkey (
                                unit_tag
                            )
                        )
                    `).eq("recipe_id",n),{data:P}=await d.from("steps").select("*").eq("recipe_id",n).order("step_number",{ascending:!0}),{data:I}=await d.from("recipe_tags").select("tag_id").eq("recipe_id",n),{data:E}=await d.from("recipe_equipment").select("equipment_id").eq("recipe_id",n),{data:te}=await d.from("recipe_category").select("category_id").eq("recipe_id",n),ne={name:T.name,description:T.description,prep_time:T.prep_time,cook_time:T.cook_time,total_time:T.prep_time+T.cook_time,image_path:T.image_path,steps:P.map(oe=>({id:oe.id,description:oe.instruction})),category_ids:te.map(oe=>oe.category_id),tag_ids:I.map(oe=>oe.tag_id),equipment_ids:E.map(oe=>oe.equipment_id)};m(ne),k(ne),N(Y.map((oe,H)=>({id:oe.ingredient_id,name:oe.ingredients.name,quantity:oe.quantity,ingredient_id:oe.ingredient_id,unit:oe.ingredients.unit?oe.ingredients.unit.unit_tag:null,image:oe.ingredients.icon_path?`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${oe.ingredients.icon_path}`:null,position:H+1}))),a(U||[]),c(X||[]),p(q||[]),l(I.map(oe=>oe.tag_id)),o(E.map(oe=>oe.equipment_id)),x(te.map(oe=>oe.category_id))}catch(T){console.error("Error fetching data:",T)}finally{C(!1)}})()},[n]),t.useEffect(()=>{m(F=>({...F,total_time:Number(F.prep_time||0)+Number(F.cook_time||0)}))},[R.prep_time,R.cook_time]);const G=(F,T)=>{m($=>({...$,[F]:T}))},u=F=>{N(F),console.log("Updated Ingredients in edit:",F)},v=(F,T)=>{m($=>({...$,steps:$.steps.map((U,X)=>X===F?{...U,description:T}:U)}))},D=()=>{m(F=>({...F,steps:[...F.steps,{id:null,description:""}]}))},j=F=>{m(T=>({...T,steps:T.steps.filter(($,U)=>U!==F)}))},S=(F,T,$)=>{F.includes($.id)||T([...F,$.id])},M=(F,T,$)=>{T(F.filter(U=>U!==$))},Q=async()=>{var F;C(!0);try{const{error:T}=await d.from("recipes").update({name:R.name,description:R.description,prep_time:R.prep_time,cook_time:R.cook_time,image_path:R.image_path}).eq("id",n);if(T)throw T;for(const[E,te]of R.steps.entries())if(te.id){const{error:ne}=await d.from("steps").update({instruction:te.description,step_number:E+1}).eq("id",te.id);if(ne)throw ne}else{const{error:ne}=await d.from("steps").insert({recipe_id:n,instruction:te.description,step_number:E+1});if(ne)throw ne}const $=L.steps.map(E=>E.id),U=R.steps.map(E=>E.id),X=$.filter(E=>E&&!U.includes(E));for(const E of X){const{error:te}=await d.from("steps").delete().eq("id",E);if(te)throw te}const q=async(E,te,ne)=>{if(await d.from(E).delete().eq("recipe_id",n),ne.length>0){const oe=ne.map(V=>({recipe_id:n,[te]:V})),{error:H}=await d.from(E).insert(oe);if(H)throw H}};await q("recipe_category","category_id",b),await q("recipe_tags","tag_id",y),await q("recipe_equipment","equipment_id",g);for(const E of _)if(E.ingredient_id){const{error:te}=await d.from("recipe_ingredients").upsert({recipe_id:n,ingredient_id:E.ingredient_id,quantity:E.quantity},{onConflict:["recipe_id","ingredient_id"]});if(te)throw te}else console.error("Ingredient missing ingredient_id:",E);const Y=((F=L==null?void 0:L.ingredients)==null?void 0:F.map(E=>E.ingredient_id))||[],P=_.map(E=>E.ingredient_id),I=Y.filter(E=>E&&!P.includes(E));for(const E of I){const{error:te}=await d.from("recipe_ingredients").delete().eq("recipe_id",n).eq("ingredient_id",E);if(te)throw te}alert("Recipe updated successfully!"),s(`/admin/recipe-management/recipes/view/${n}`)}catch(T){console.error("Error saving recipe:",T),alert("Failed to save recipe.")}finally{C(!1)}},ee=()=>{m(L),s(-1)};return w?e.jsx(Ue,{}):e.jsxs("div",{className:"edit-recipe-container",children:[e.jsx(Le,{}),e.jsx("h1",{className:"edit-recipe-title",children:"Edit Recipe"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{className:"form-label",children:"Recipe Name:"}),e.jsx("input",{type:"text",value:R.name,onChange:F=>G("name",F.target.value),required:!0,className:"form-input"}),e.jsx("label",{className:"form-label",children:"Description:"}),e.jsx("textarea",{value:R.description,onChange:F=>G("description",F.target.value),className:"form-textarea"}),e.jsx("label",{className:"form-label",children:"Image:"}),e.jsx("input",{type:"file",onChange:F=>G("image",F.target.files[0]),className:"form-file-input"})]}),e.jsxs("div",{className:"prep-details",children:[e.jsx("label",{className:"form-label",children:"Preparation Time (mins):"}),e.jsx("input",{type:"number",value:R.prep_time,onChange:F=>G("prep_time",F.target.value),className:"form-input"}),e.jsx("label",{className:"form-label",children:"Cooking Time (mins):"}),e.jsx("input",{type:"number",value:R.cook_time,onChange:F=>G("cook_time",F.target.value),className:"form-input"}),e.jsx("label",{className:"form-label",children:"Total Time (mins):"}),e.jsx("input",{type:"number",value:R.total_time,readOnly:!0,className:"form-input-readonly"})]}),e.jsx("h2",{className:"form-subtitle",children:"Categories"}),e.jsxs("select",{onChange:F=>{const T=Number(F.target.value),$=i.find(U=>U.id===T);$&&S(b,x,$),F.target.value=""},className:"form-select",children:[e.jsx("option",{value:"",children:"Select a category..."}),i.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]}),e.jsxs("div",{className:"selected-list",children:[e.jsx("h3",{className:"selected-list-title",children:"Selected Categories:"}),b.map(F=>{const T=i.find($=>$.id===F);return T?e.jsxs("div",{className:"selected-item",children:[T.name,e.jsx("button",{onClick:()=>M(b,x,F),className:"remove-button",children:"Remove"})]},F):null})]}),e.jsx("h2",{className:"form-subtitle",children:"Tags"}),e.jsxs("select",{onChange:F=>{const T=Number(F.target.value),$=r.find(U=>U.id===T);$&&S(y,l,$),F.target.value=""},className:"form-select",children:[e.jsx("option",{value:"",children:"Select a tag..."}),r.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]}),e.jsxs("div",{className:"selected-list",children:[e.jsx("h3",{className:"selected-list-title",children:"Selected Tags:"}),y.map(F=>{const T=r.find($=>$.id===F);return T?e.jsxs("div",{className:"selected-item",children:[T.name,e.jsx("button",{onClick:()=>M(y,l,F),className:"remove-button",children:"Remove"})]},F):null})]}),e.jsx("h2",{className:"form-subtitle",children:"Equipment"}),e.jsxs("select",{onChange:F=>{const T=Number(F.target.value),$=h.find(U=>U.id===T);$&&S(g,o,$),F.target.value=""},className:"form-select",children:[e.jsx("option",{value:"",children:"Select equipment..."}),h.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]}),e.jsxs("div",{className:"selected-list",children:[e.jsx("h3",{className:"selected-list-title",children:"Selected Equipment:"}),g.map(F=>{const T=h.find($=>$.id===F);return T?e.jsxs("div",{className:"selected-item",children:[T.name,e.jsx("button",{onClick:()=>M(g,o,F),className:"remove-button",children:"Remove"})]},F):null})]}),e.jsxs("div",{className:"ingredients-section",children:[e.jsx("h2",{className:"form-subtitle",children:"Ingredients"}),e.jsx(Un,{initialIngredients:_,onIngredientUpdate:u})]}),e.jsxs("div",{className:"steps-section",children:[e.jsx("h2",{className:"form-subtitle",children:"Steps"}),R.steps.map((F,T)=>e.jsxs("div",{className:"step-item",children:[e.jsx("textarea",{value:F.description,onChange:$=>v(T,$.target.value),placeholder:`Step ${T+1}`,className:"form-textarea"}),e.jsx("button",{onClick:()=>j(T),className:"button-secondary remove-step-button",children:"Remove"})]},T)),e.jsx("button",{onClick:D,className:"button-primary add-step-button",children:"+ Add Step"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{onClick:Q,className:"button-primary",children:"Save"}),e.jsx("button",{onClick:ee,className:"button-secondary",children:"Cancel"})]})]})},Rr=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState(null),[r,c]=t.useState([]),[y,l]=t.useState([]),[h,p]=t.useState([]),[g,o]=t.useState([]),[b,x]=t.useState([]),[L,k]=t.useState(!0),[R,m]=t.useState(null);t.useEffect(()=>{(async()=>{k(!0),m(null);try{const{data:w,error:C}=await d.from("recipes").select("*").eq("id",n).single();if(C)throw C;console.log("Recipe Details:",w),a(w);const{data:G,error:u}=await d.from("recipe_category").select("category_id, categories:category_id(name)").eq("recipe_id",n);u?(console.error("Error fetching categories:",u.message),c([])):(console.log("Categories:",G),c((G==null?void 0:G.map(U=>U.categories.name))||[]));const{data:v,error:D}=await d.from("recipe_tags").select("tag_id, tags(name)").eq("recipe_id",n);D?(console.error("Error fetching tags:",D.message),l([])):(console.log("Tags:",v),l(v.map(U=>U.tags.name)));const{data:j,error:S}=await d.from("recipe_equipment").select("equipment_id, equipment(name)").eq("recipe_id",n);S?(console.error("Error fetching equipment:",S.message),p([])):(console.log("Equipment:",j),p(j.map(U=>U.equipment.name)));const{data:M,error:Q}=await d.from("recipe_ingredients").select(`
                        ingredient_id,
                        quantity,
                        ingredients (
                            name,
                            quantity_unit_id
                        )
                    `).eq("recipe_id",n);Q&&console.error("Error fetching ingredients:",Q.message);const{data:ee,error:F}=await d.from("unit").select("*");if(F&&console.error("Error fetching units:",F.message),M&&ee){const U=M.map(X=>{const q=ee.find(Y=>Y.id===X.ingredients.quantity_unit_id);return{name:X.ingredients.name,unit:(q==null?void 0:q.unit_tag)||"N/A",quantity:X.quantity}});o(U),console.log("Combined Ingredients:",U)}const{data:T,error:$}=await d.from("steps").select("*").eq("recipe_id",n).order("step_number",{ascending:!0});$?(console.error("Error fetching steps:",$.message),x([])):(console.log("Steps:",T),x(T))}catch(w){m("Failed to fetch recipe details."),console.error(w)}finally{k(!1)}})()},[n]);const _=async(N,w)=>{if(window.confirm("Are you sure you want to delete this recipe?"))try{k(!0);const{error:G}=await d.storage.from("recipe-pictures").remove([w]);if(G){console.error("Failed to delete image:",G),m("Failed to delete recipe image.");return}const{error:u}=await d.from("recipes").delete().eq("id",N);if(u)throw u;alert("Recipe and image deleted successfully."),s("/admin/recipe-management/recipes")}catch(G){m("Failed to delete recipe."),console.error(G)}finally{k(!1)}};return L?e.jsx(Ue,{}):R?e.jsx("p",{style:{color:"red"},children:R}):e.jsxs("div",{className:"recipe-detail-container",children:[e.jsx(Le,{}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>s(`/admin/recipe-management/recipes/edit/${n}`),className:"button-edit",children:"Edit Recipe"}),e.jsx("button",{onClick:()=>_(i.id,i.image_path),className:"button-delete",children:"Delete Recipe"})]}),e.jsx("h1",{className:"recipe-title",children:i.name}),e.jsx("p",{className:"recipe-description",children:i.description}),e.jsxs("p",{className:"recipe-time",children:["Preparation Time: ",i.prep_time," mins"]}),e.jsxs("p",{className:"recipe-time",children:["Cooking Time: ",i.cook_time," mins"]}),e.jsxs("p",{className:"recipe-time",children:["Total Time: ",i.prep_time+i.cook_time," mins"]}),i.image_path&&e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${i.image_path}`,alt:i.name,className:"recipe-admin-image"}),e.jsx("h2",{className:"section-title",children:"Categories"}),e.jsx("ul",{className:"category-list",children:r.map((N,w)=>e.jsx("li",{className:"list-item",children:N},w))}),e.jsx("h2",{className:"section-title",children:"Tags"}),e.jsx("ul",{className:"tag-list",children:y.map((N,w)=>e.jsx("li",{className:"list-item",children:N},w))}),e.jsx("h2",{className:"section-title",children:"Equipment"}),e.jsx("ul",{className:"equipment-list",children:h.map((N,w)=>e.jsx("li",{className:"list-item",children:N},w))}),e.jsx("h2",{className:"section-title",children:"Ingredients"}),e.jsx("ul",{className:"ingredients-list",children:g.map((N,w)=>e.jsxs("li",{className:"list-item",children:[N.name," - ",N.quantity," ",N.unit]},w))}),e.jsx("h2",{className:"section-title",children:"Steps"}),e.jsx("ol",{className:"steps-list",children:b.map(N=>e.jsx("li",{className:"step-item",children:N.instruction},N.step_number))})]})},Fr=()=>{const[n,s]=t.useState([]),[i,a]=t.useState([]),[r,c]=t.useState(!0),[y,l]=t.useState(null),[h,p]=t.useState(""),[g,o]=t.useState({key:"id",direction:"asc"}),b=ue(),x=async()=>{c(!0),l(null);try{const{data:m,error:_}=await d.from("category").select("*").order("id",{ascending:!0});if(_)throw _;s(m),a(m)}catch(m){l("Failed to fetch categories."),console.error(m)}finally{c(!1)}},L=m=>{const _=m.target.value.toLowerCase();if(p(_),_){const N=n.filter(w=>w.name.toLowerCase().includes(_)||w.description.toLowerCase().includes(_));a(N)}else a(n)},k=m=>{let _="asc";g.key===m&&g.direction==="asc"&&(_="desc"),o({key:m,direction:_});const N=[...i].sort((w,C)=>w[m]<C[m]?_==="asc"?-1:1:w[m]>C[m]?_==="asc"?1:-1:0);a(N)},R=async m=>{if(window.confirm("Are you sure you want to delete this category?")){c(!0);try{const{error:N}=await d.from("category").delete().eq("id",m);if(N)throw N;s(w=>w.filter(C=>C.id!==m)),a(w=>w.filter(C=>C.id!==m)),alert("Category deleted successfully!")}catch(N){console.error("Failed to delete category:",N),l("Failed to delete category.")}finally{c(!1)}}};return t.useEffect(()=>{x()},[]),e.jsxs("div",{className:"categories-container",children:[e.jsx("h1",{className:"categories-title",children:"Manage Categories"}),e.jsx("p",{className:"categories-description",children:"View, create, and edit recipe categories."}),e.jsxs("div",{className:"categories-controls",children:[e.jsx("input",{type:"text",placeholder:"Search categories...",value:h,onChange:L,className:"categories-search"}),e.jsx("button",{onClick:x,className:"categories-refresh-button",children:"Refresh"}),e.jsx("button",{onClick:()=>b("create"),className:"categories-create-button",children:"Create Category"})]}),r&&e.jsx(Ue,{}),y&&e.jsx("p",{className:"categories-error",children:y}),!r&&!y&&i.length>0?e.jsxs("table",{className:"categories-table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"categories-table-header-row",children:[e.jsxs("th",{onClick:()=>k("id"),className:"categories-table-header",children:["ID ",g.key==="id"&&(g.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>k("name"),className:"categories-table-header",children:["Name ",g.key==="name"&&(g.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>k("description"),className:"categories-table-header",children:["Description ",g.key==="description"&&(g.direction==="asc"?"↑":"↓")]}),e.jsx("th",{className:"categories-table-header actions-column",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(m=>e.jsxs("tr",{className:"categories-table-row",children:[e.jsx("td",{className:"categories-table-cell",children:m.id}),e.jsx("td",{className:"categories-table-cell",children:m.name}),e.jsx("td",{className:"categories-table-cell",children:m.description}),e.jsxs("td",{className:"categories-table-cell actions-cell",children:[e.jsx("button",{onClick:()=>b(`edit/${m.id}`),className:"categories-action-button categories-edit-button",children:"Edit"}),e.jsx("button",{onClick:()=>R(m.id),className:"categories-action-button categories-delete-button",children:"Delete"})]})]},m.id))})]}):!r&&e.jsx("p",{className:"categories-empty",children:"No categories found."})]})},Ur=()=>{const[n,s]=t.useState(""),[i,a]=t.useState(""),[r,c]=t.useState(!1),[y,l]=t.useState(null),h=ue(),p=async g=>{g.preventDefault(),c(!0),l(null);try{const{error:o}=await d.from("category").insert([{name:n,description:i}]);if(o)throw o;alert("Category created successfully!"),h("/admin/category-management/categories")}catch(o){l("Failed to create category."),console.error(o)}finally{c(!1)}};return e.jsxs("div",{className:"create-category-container",children:[e.jsx("h1",{className:"create-category-title",children:"Create Category"}),e.jsxs("form",{onSubmit:p,className:"form-container",children:[y&&e.jsx("p",{className:"form-error",children:y}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Name"}),e.jsx("input",{id:"name",type:"text",value:n,onChange:g=>s(g.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{id:"description",value:i,onChange:g=>a(g.target.value),required:!0,className:"form-textarea"})]}),e.jsx("button",{type:"submit",disabled:r,className:`button-primary ${r?"button-disabled":""}`,children:r?"Creating...":"Create Category"})]})]})},Pr=()=>{const{id:n}=Ee(),[s,i]=t.useState(""),[a,r]=t.useState(""),[c,y]=t.useState(!1),[l,h]=t.useState(null),p=ue();t.useEffect(()=>{(async()=>{y(!0),h(null);try{const{data:b,error:x}=await d.from("category").select("*").eq("id",n).single();if(x)throw x;i(b.name),r(b.description)}catch(b){h("Failed to fetch category details."),console.error(b)}finally{y(!1)}})()},[n]);const g=async o=>{o.preventDefault(),y(!0),h(null);try{const{error:b}=await d.from("category").update({name:s,description:a}).eq("id",n);if(b)throw b;alert("Category updated successfully!"),p("/admin/recipe-management/categories")}catch(b){h("Failed to update category."),console.error(b)}finally{y(!1)}};return e.jsxs("div",{className:"edit-category-container",children:[e.jsx("h1",{className:"edit-category-title",children:"Edit Category"}),e.jsxs("form",{onSubmit:g,className:"form-container",children:[l&&e.jsx("p",{className:"form-error",children:l}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Name"}),e.jsx("input",{id:"name",type:"text",value:s,onChange:o=>i(o.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{id:"description",value:a,onChange:o=>r(o.target.value),required:!0,className:"form-textarea"})]}),e.jsx("button",{type:"submit",disabled:c,className:`button-warning ${c?"button-disabled":""}`,children:c?"Updating...":"Update Category"})]})]})},Tr=()=>{const[n,s]=t.useState([]),[i,a]=t.useState([]),[r,c]=t.useState(!0),[y,l]=t.useState(null),[h,p]=t.useState(""),[g,o]=t.useState({key:"id",direction:"asc"}),b=ue(),x=async()=>{c(!0),l(null);try{const{data:m,error:_}=await d.from("tags").select("*").order("id",{ascending:!0});if(_)throw _;s(m),a(m)}catch(m){l("Failed to fetch tags."),console.error(m)}finally{c(!1)}},L=m=>{const _=m.target.value.toLowerCase();if(p(_),_){const N=n.filter(w=>w.name.toLowerCase().includes(_));a(N)}else a(n)},k=m=>{let _="asc";g.key===m&&g.direction==="asc"&&(_="desc"),o({key:m,direction:_});const N=[...i].sort((w,C)=>w[m]<C[m]?_==="asc"?-1:1:w[m]>C[m]?_==="asc"?1:-1:0);a(N)},R=async m=>{if(window.confirm("Are you sure you want to delete this tag?")){c(!0);try{const{error:N}=await d.from("tags").delete().eq("id",m);if(N)throw N;s(w=>w.filter(C=>C.id!==m)),a(w=>w.filter(C=>C.id!==m)),alert("Tag deleted successfully!")}catch(N){console.error("Failed to delete tag:",N),l("Failed to delete tag.")}finally{c(!1)}}};return t.useEffect(()=>{x()},[]),e.jsxs("div",{className:"manage-tags-container",children:[e.jsx("h1",{className:"manage-tags-title",children:"Manage Tags"}),e.jsx("p",{className:"manage-tags-description",children:"View, create, and edit recipe tags."}),e.jsxs("div",{className:"manage-tags-actions",children:[e.jsx("input",{type:"text",placeholder:"Search tags...",value:h,onChange:L,className:"search-input"}),e.jsx("button",{onClick:x,className:"button-primary",children:"Refresh"}),e.jsx("button",{onClick:()=>b("create"),className:"button-primary",children:"Create Tag"})]}),r&&e.jsx(Ue,{}),y&&e.jsx("p",{className:"error-text",children:y}),!r&&!y&&i.length>0?e.jsxs("table",{className:"tags-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>k("id"),className:"sortable-header",children:["ID ",g.key==="id"&&(g.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>k("name"),className:"sortable-header",children:["Name ",g.key==="name"&&(g.direction==="asc"?"↑":"↓")]}),e.jsx("th",{className:"actions-header",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"table-cell",children:m.id}),e.jsx("td",{className:"table-cell",children:m.name}),e.jsxs("td",{className:"table-cell actions-cell",children:[e.jsx("button",{onClick:()=>b(`edit/${m.id}`),className:"button-edit",children:"Edit"}),e.jsx("button",{onClick:()=>R(m.id),className:"button-delete",children:"Delete"})]})]},m.id))})]}):!r&&e.jsx("p",{className:"no-tags-text",children:"No tags found."})]})},Ar=()=>{const[n,s]=t.useState(""),[i,a]=t.useState(null),[r,c]=t.useState(null),y=ue(),l=async h=>{if(h.preventDefault(),!n.trim()){a("Tag name cannot be empty.");return}try{a(null),c(null);const{error:p}=await d.from("tags").insert([{name:n}]);if(p)throw p;c("Tag created successfully!"),s(""),y("/admin/recipe-management/tags")}catch(p){a("Failed to create tag."),console.error(p)}};return e.jsxs("div",{className:"create-tag-container",children:[e.jsx("h1",{className:"create-tag-title",children:"Create Tag"}),e.jsx("p",{className:"create-tag-description",children:"Use this form to add a new tag."}),e.jsxs("form",{onSubmit:l,className:"form-container",children:[e.jsx("label",{htmlFor:"tagName",className:"form-label",children:"Tag Name"}),e.jsx("input",{type:"text",id:"tagName",value:n,onChange:h=>s(h.target.value),placeholder:"Enter tag name",className:"form-input"}),e.jsx("button",{type:"submit",className:"button-primary",children:"Create Tag"})]}),i&&e.jsx("p",{className:"form-error",children:i}),r&&e.jsx("p",{className:"form-success",children:r}),e.jsx("button",{onClick:()=>y(-1),className:"button-secondary",children:"Back"})]})},Lr=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState(""),[r,c]=t.useState(!0),[y,l]=t.useState(null);t.useEffect(()=>{(async()=>{c(!0),l(null);try{const{data:g,error:o}=await d.from("tags").select("*").eq("id",n).single();if(o)throw o;a(g.name)}catch(g){console.error("Failed to fetch tag details:",g),l("Failed to fetch tag details.")}finally{c(!1)}})()},[n]);const h=async p=>{p.preventDefault(),c(!0),l(null);try{const{error:g}=await d.from("tags").update({name:i}).eq("id",n);if(g)throw g;alert("Tag updated successfully!"),s(-1)}catch(g){console.error("Failed to update tag:",g),l("Failed to update tag.")}finally{c(!1)}};return r?e.jsx(Ue,{}):y?e.jsx("p",{style:{color:"red"},children:y}):e.jsxs("div",{className:"edit-tag-container",children:[e.jsx("h1",{className:"edit-tag-title",children:"Edit Tag"}),y&&e.jsx("p",{className:"form-error",children:y}),r&&e.jsx(Ue,{}),e.jsxs("form",{onSubmit:h,className:"form-container",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tagName",className:"form-label",children:"Tag Name:"}),e.jsx("input",{id:"tagName",type:"text",value:i,onChange:p=>a(p.target.value),required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:()=>s(-1),className:"button-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-primary",children:"Save Changes"})]})]})]})},Mr=()=>{const[n,s]=t.useState([]),[i,a]=t.useState([]),[r,c]=t.useState(!0),[y,l]=t.useState(null),[h,p]=t.useState(""),[g,o]=t.useState({key:"id",direction:"asc"}),b=ue(),x=async()=>{c(!0),l(null);try{const{data:m,error:_}=await d.from("equipment").select("*").order("id",{ascending:!0});if(_)throw _;s(m),a(m)}catch(m){l("Failed to fetch equipment."),console.error(m)}finally{c(!1)}},L=m=>{const _=m.target.value.toLowerCase();if(p(_),_){const N=n.filter(w=>w.name.toLowerCase().includes(_));a(N)}else a(n)},k=m=>{let _="asc";g.key===m&&g.direction==="asc"&&(_="desc"),o({key:m,direction:_});const N=[...i].sort((w,C)=>w[m]<C[m]?_==="asc"?-1:1:w[m]>C[m]?_==="asc"?1:-1:0);a(N)},R=async m=>{if(window.confirm("Are you sure you want to delete this equipment?"))try{c(!0);const{error:N}=await d.from("equipment").delete().eq("id",m);if(N)throw N;s(w=>w.filter(C=>C.id!==m)),a(w=>w.filter(C=>C.id!==m)),alert("Equipment deleted successfully.")}catch(N){l("Failed to delete equipment."),console.error(N)}finally{c(!1)}};return t.useEffect(()=>{x()},[]),e.jsxs("div",{className:"manage-equipment-container",children:[e.jsx("h1",{className:"manage-equipment-title",children:"Manage Equipment"}),e.jsx("p",{className:"manage-equipment-description",children:"View, create, and edit equipment items."}),e.jsxs("div",{className:"manage-equipment-actions",children:[e.jsx("input",{type:"text",placeholder:"Search equipment...",value:h,onChange:L,className:"search-input"}),e.jsx("button",{onClick:x,className:"button-primary",children:"Refresh"}),e.jsx("button",{onClick:()=>b("create"),className:"button-primary",children:"Create Equipment"})]}),r&&e.jsx(Ue,{}),y&&e.jsx("p",{className:"error-text",children:y}),!r&&!y&&i.length>0?e.jsxs("table",{className:"equipment-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>k("id"),className:"sortable-header",children:["ID ",g.key==="id"&&(g.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>k("name"),className:"sortable-header",children:["Name ",g.key==="name"&&(g.direction==="asc"?"↑":"↓")]}),e.jsx("th",{className:"actions-header",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"table-cell",children:m.id}),e.jsx("td",{className:"table-cell",children:m.name}),e.jsxs("td",{className:"table-cell actions-cell",children:[e.jsx("button",{onClick:()=>b(`edit/${m.id}`),className:"button-edit",children:"Edit"}),e.jsx("button",{onClick:()=>R(m.id),className:"button-delete",children:"Delete"})]})]},m.id))})]}):!r&&e.jsx("p",{className:"no-equipment-text",children:"No equipment found."})]})},$r=()=>{const[n,s]=t.useState(""),[i,a]=t.useState(null),[r,c]=t.useState(null),y=ue(),l=async h=>{if(h.preventDefault(),!n.trim()){a("Equipment name cannot be empty.");return}try{a(null),c(null);const{error:p}=await d.from("equipment").insert([{name:n}]);if(p)throw p;c("Equipment created successfully!"),s(""),y("/admin/recipe-management/equipment")}catch(p){a("Failed to create equipment."),console.error(p)}};return e.jsxs("div",{className:"create-equipment-container",children:[e.jsx("h1",{className:"create-equipment-title",children:"Create Equipment"}),e.jsx("p",{className:"create-equipment-description",children:"Use this form to add a new equipment item."}),e.jsxs("form",{onSubmit:l,className:"form-container",children:[e.jsx("label",{htmlFor:"equipment-name",className:"form-label",children:"Equipment Name"}),e.jsx("input",{id:"equipment-name",type:"text",value:n,onChange:h=>s(h.target.value),placeholder:"Enter equipment name",className:"form-input"}),e.jsx("button",{type:"submit",className:"button-primary",children:"Create Equipment"})]}),i&&e.jsx("p",{className:"form-error",children:i}),r&&e.jsx("p",{className:"form-success",children:r}),e.jsx("button",{onClick:()=>y(-1),className:"button-secondary",children:"Back"})]})},Qr=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState(""),[r,c]=t.useState(!1),[y,l]=t.useState(null);t.useEffect(()=>{(async()=>{try{const{data:g,error:o}=await d.from("equipment").select("*").eq("id",n).single();if(o)throw o;a(g.name)}catch(g){console.error("Error fetching equipment details",g),l("Failed to fetch equipment details.")}})()},[n]);const h=async p=>{p.preventDefault(),c(!0);try{const{error:g}=await d.from("equipment").update({name:i}).eq("id",n);if(g)throw g;alert("Equipment updated successfully."),s("/equipment")}catch(g){console.error("Error updating equipment",g),l("Failed to update equipment.")}finally{c(!1)}};return e.jsxs("div",{className:"edit-equipment-container",children:[e.jsx("h1",{className:"edit-equipment-title",children:"Edit Equipment"}),y&&e.jsx("p",{className:"form-error",children:y}),e.jsxs("form",{onSubmit:h,className:"form-container",children:[e.jsx("label",{htmlFor:"equipmentName",className:"form-label",children:"Equipment Name:"}),e.jsx("input",{type:"text",id:"equipmentName",value:i,onChange:p=>a(p.target.value),required:!0,className:"form-input"}),e.jsx("button",{type:"submit",disabled:r,className:`button-primary ${r?"button-disabled":""}`,children:r?"Updating...":"Update Equipment"})]})]})},Or=()=>e.jsx("div",{style:{position:"relative"},children:e.jsxs(kt,{children:[e.jsx(le,{path:"/",element:e.jsx(ze,{to:"dashboard"})}),e.jsx(le,{path:"dashboard",element:e.jsx(kr,{})}),e.jsx(le,{path:"recipes",element:e.jsx(Ir,{})}),e.jsx(le,{path:"recipes/create",element:e.jsx(Er,{})}),e.jsx(le,{path:"recipes/view/:id",element:e.jsx(Rr,{})}),e.jsx(le,{path:"recipes/edit/:id",element:e.jsx(Dr,{})}),e.jsx(le,{path:"categories",element:e.jsx(Fr,{})}),e.jsx(le,{path:"categories/create",element:e.jsx(Ur,{})}),e.jsx(le,{path:"categories/edit/:id",element:e.jsx(Pr,{})}),e.jsx(le,{path:"tags",element:e.jsx(Tr,{})}),e.jsx(le,{path:"tags/create",element:e.jsx(Ar,{})}),e.jsx(le,{path:"tags/edit/:id",element:e.jsx(Lr,{})}),e.jsx(le,{path:"equipment",element:e.jsx(Mr,{})}),e.jsx(le,{path:"equipment/create",element:e.jsx($r,{})}),e.jsx(le,{path:"equipment/edit/:id",element:e.jsx(Qr,{})}),e.jsx(le,{path:"*",element:e.jsx(ze,{to:"dashboard"})})]})}),Br=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState([]),[c,y]=t.useState(!0),[l,h]=t.useState(null),[p,g]=t.useState(""),[o,b]=t.useState({key:"username",direction:"asc"}),[x,L]=t.useState(1),[k,R]=t.useState(1),m=10,_=async(u=1)=>{y(!0),h(null);try{const D=(u-1)*m+m-1,{data:j,error:S}=await d.from("profile").select("id,username, user");if(S)throw S;const{data:M,error:Q}=await d.from("user_roles").select("user_id, role_id");if(Q)throw Q;const ee=j.map(F=>{const T=M.find($=>$.user_id===F.user);return{id:F.id,username:F.username,unique_id:F.user,role:T?T.role_id===1?"Admin":"Client":"Unknown"}});i(ee),r(ee),R(Math.ceil(ee.length/m))}catch(v){h("Failed to fetch users."),console.error(v)}finally{y(!1)}},N=u=>{const v=u.target.value.toLowerCase();if(g(v),v){const D=s.filter(j=>j.username.toLowerCase().includes(v));r(D)}else r(s)},w=u=>{let v="asc";o.key===u&&o.direction==="asc"&&(v="desc"),b({key:u,direction:v}),_(x)},C=u=>{u>0&&u<=k&&(L(u),_(u))};t.useEffect(()=>{_(x)},[x]);const G=async u=>{if(window.confirm("Are you sure you want to delete this user?"))try{y(!0);const{error:D}=await d.from("profile").delete().eq("id",u);if(D)throw D;i(j=>j.filter(S=>S.id!==u)),r(j=>j.filter(S=>S.id!==u)),alert("User deleted successfully.")}catch(D){h("Failed to delete user."),console.error(D)}finally{y(!1)}};return e.jsxs("div",{className:"admin-users",children:[e.jsx("h1",{children:"Manage Users"}),e.jsx("p",{children:"View, create, and manage users."}),e.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:p,onChange:N,style:{padding:"10px",borderRadius:"4px",border:"1px solid #ccc",width:"100%",maxWidth:"400px"}}),e.jsx("button",{onClick:()=>_(x),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Refresh"})]}),c&&e.jsx("p",{children:"Loading users..."}),l&&e.jsx("p",{style:{color:"red"},children:l}),!c&&!l&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f4f4f4"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"ID"}),e.jsxs("th",{onClick:()=>w("username"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Username ",o.key==="username"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("role"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Role ",o.key==="role"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"Actions"})]})}),e.jsx("tbody",{children:a.map(u=>e.jsxs("tr",{style:{backgroundColor:"#fff"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.id}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.username}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.role}),e.jsxs("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>n(`/admin/users/view/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#FFA500",color:"white",border:"none",borderRadius:"4px"},children:"View"}),e.jsx("button",{onClick:()=>n(`/admin/users/edit/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px"},children:"Edit"}),e.jsx("button",{onClick:()=>G(u.id),style:{padding:"8px 12px",cursor:"pointer",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px"},children:"Delete"})]})]},u.id))})]}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>C(x-1),disabled:x===1,style:{marginRight:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===1?"not-allowed":"pointer"},children:"Previous"}),e.jsxs("span",{children:["Page ",x," of ",k]}),e.jsx("button",{onClick:()=>C(x+1),disabled:x===k,style:{marginLeft:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===k?"not-allowed":"pointer"},children:"Next"})]})]}):!c&&e.jsx("p",{children:"No users found."})]})},Gr=()=>{const n=ue(),[s,i]=t.useState({email:"",username:"",role:"2"}),[a,r]=t.useState(!1),[c,y]=t.useState(null),l=g=>{i({...s,[g.target.name]:g.target.value})},h=()=>{const o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let b="";for(let x=0;x<12;x++){const L=Math.floor(Math.random()*o.length);b+=o[L]}return b},p=async g=>{g.preventDefault(),r(!0),y(null);try{const o=h(),{data:b,error:x}=await d.auth.admin.createUser({email:s.email,password:o,email_confirm:!0});if(x)throw x;const{error:L}=await d.from("profile").insert({username:s.username,user:b.user.id});if(L)throw L;const{error:k}=await d.from("user_roles").insert({user_id:b.user.id,role_id:parseInt(s.role)});if(k)throw k;n("/admin/users")}catch(o){y(o.message)}finally{r(!1)}};return e.jsxs("div",{className:"create-user-container",children:[e.jsxs("div",{className:"create-user-header",children:[e.jsx("h2",{children:"Create New User"}),e.jsx("button",{className:"back-btn",onClick:()=>n("/admin/users"),children:"Back to Users"})]}),c&&e.jsx("div",{className:"error-message",children:c}),e.jsxs("form",{onSubmit:p,className:"create-user-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email:"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username:"}),e.jsx("input",{type:"text",id:"username",name:"username",value:s.username,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Role:"}),e.jsxs("select",{id:"role",name:"role",value:s.role,onChange:l,required:!0,children:[e.jsx("option",{value:"2",children:"Client"}),e.jsx("option",{value:"1",children:"Admin"})]})]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:a,children:a?"Creating...":""})]})]})},zr=()=>{var o;const{id:n}=Ee(),s=ue(),[i,a]=t.useState(null),[r,c]=t.useState([]),[y,l]=t.useState(!0),[h,p]=t.useState(null);t.useEffect(()=>{(async()=>{l(!0),p(null);try{const{data:x,error:L}=await d.from("profile").select("*").eq("id",n).single();if(L)throw L;a(x);const{data:k,error:R}=await d.from("roles").select("*");R?(console.error("Error fetching roles:",R.message),c([])):c(k||[])}catch(x){p("Failed to fetch user details."),console.error(x)}finally{l(!1)}})()},[n]);const g=async(b,x)=>{if(window.confirm("Are you sure you want to delete this user?"))try{l(!0);const{error:k}=await d.storage.from("profile-picture").remove([x]);if(k){console.error("Failed to delete picture:",k),p("Failed to delete user's profile picture.");return}const{error:R}=await d.from("profile").delete().eq("id",b);if(R)throw R;alert("User and profile picture deleted successfully."),s("/admin/users")}catch(k){p("Failed to delete user."),console.error(k)}finally{l(!1)}};return y?e.jsx("p",{children:"Loading user..."}):h?e.jsx("p",{style:{color:"red"},children:h}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx(Le,{}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>s(`/admin/users/edit/${n}`),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#FFA500",color:"white",cursor:"pointer"},children:"Edit User"}),e.jsx("button",{onClick:()=>g(i.id,i.picture_path),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#f44336",color:"white",cursor:"pointer"},children:"Delete User"})]}),e.jsx("h1",{children:i.username}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Birthday:"})," ",i.birthday]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Notification Day:"})," ",i.notification_day]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Role:"})," ",((o=r.find(b=>b.id===i.role_id))==null?void 0:o.role_name)||"N/A"]}),i.picture_path&&e.jsx("img",{src:`${d.storage.from("profile-picture").getPublicUrl(i.picture_path).publicURL}`,alt:i.username,style:{width:"150px",height:"150px",objectFit:"cover",borderRadius:"8px"}})]})},Vr=()=>{const{id:n}=Ee(),[s,i]=t.useState(""),[a,r]=t.useState(""),[c,y]=t.useState(""),[l,h]=t.useState(null),[p,g]=t.useState([]),[o,b]=t.useState(null),[x,L]=t.useState(""),[k,R]=t.useState(null),[m,_]=t.useState(""),[N,w]=t.useState([]),C=ue();t.useEffect(()=>{(async()=>{try{const{data:D,error:j}=await d.from("profile").select("*").eq("id",n).single();if(j)throw j;i(D.user),r(D.username),y(D.birthday),h(D.notification_day),_(D.picture_path);const{data:S,error:M}=await d.from("user_roles").select("role_id").eq("user_id",D.user).single();if(M)throw M;const{data:Q,error:ee}=await d.from("roles").select("id, role_name").eq("id",S.role_id).single();if(ee)throw ee;b(Q.id),L(Q.role_name);const{data:F,error:T}=await d.from("roles").select("id, role_name");T?console.error("Error fetching roles data:",T):w(F||[]);const{data:$,error:U}=await d.from("notification_day").select("id, day");U?console.error("Error fetching notification days:",U):g($||[])}catch(D){console.error("Error fetching user data:",D.message)}})()},[n]);const G=v=>{R(v.target.files[0])},u=async v=>{if(v.preventDefault(),!a||!o||!c||!p){alert("Please fill all required fields.");return}try{let D=m;if(k){const{data:S,error:M}=await d.storage.from("profile-picture").upload(`pictures/${k.name}`,k,{upsert:!0});if(M)throw M;D=S.path}const{error:j}=await d.from("profile").update({username:a,birthday:c,notification_day:l,picture_path:D}).eq("id",n);if(j)throw j;if(o){const{error:S}=await d.from("user_roles").update({role_id:o}).eq("user_id",s);if(S)throw S}alert("User updated successfully!"),C("/admin/users")}catch(D){console.error("Error updating user:",D.message),alert("Failed to update user.")}};return e.jsx("div",{className:"edit-user-container",children:e.jsxs("div",{className:"admin-content",children:[e.jsx("h2",{children:"Edit User"}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"User Name:"}),e.jsx("input",{type:"text",value:a,onChange:v=>r(v.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Birthday:"}),e.jsx("input",{type:"date",value:c,onChange:v=>y(v.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notification Day:"}),e.jsxs("select",{value:l||"",onChange:v=>h(v.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a notification day"}),p.map(v=>e.jsx("option",{value:v.id,children:v.day},v.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Profile Picture:"}),m&&e.jsx("img",{src:`${d.storage.from("profile-picture").getPublicUrl(m).publicURL}`,alt:"Current Picture",className:"current-picture"}),e.jsx("label",{children:"New Picture (optional):"}),e.jsx("input",{type:"file",accept:"image/*",onChange:G})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),e.jsxs("select",{value:o||"",onChange:v=>b(v.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a role"}),N.map(v=>e.jsx("option",{value:v.id,children:v.role_name},v.id))]})]}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Update User"})]})]})})},Wr=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState([]),[c,y]=t.useState(!0),[l,h]=t.useState(null),[p,g]=t.useState(""),[o,b]=t.useState({key:"id",direction:"desc"}),[x,L]=t.useState(1),[k,R]=t.useState(1),m=10,_=async(v=1)=>{y(!0),h(null);try{const D=(v-1)*m,j=D+m-1,{data:S,error:M,count:Q}=await d.from("inventory").select("*, ingredients:ingredient_id(name)",{count:"exact"}).order(o.key,{ascending:o.direction==="asc"}).range(D,j);if(M)throw M;const{data:ee,error:F}=await d.from("expiry_date").select("id, date");if(F)throw F;const{data:T,error:$}=await d.from("freshness_status").select("id, status_color");if($)throw $;const{data:U,error:X}=await d.from("condition").select("id, condition");if(X)throw X;const q=S.map(Y=>{var te;const P=ee.find(ne=>ne.id===Y.expiry_date_id),I=T.find(ne=>ne.id===Y.freshness_status_id),E=U.find(ne=>ne.id===Y.condition_id);return{...Y,ingredientName:((te=Y.ingredients)==null?void 0:te.name)||"Unknown",ingredient_expirydate:P?P.date:null,ingredient_freshness:I?I.status_color:null,ingredient_condition:E?E.condition:null}});i(q),r(q),R(Math.ceil(Q/m))}catch(D){h("Failed to fetch inventories."),console.error(D)}finally{y(!1)}},N=v=>{const D=v.target.value.toLowerCase();if(g(D),D){const j=s.filter(S=>S.name.toLowerCase().includes(D));r(j)}else r(s)},w=v=>{let D="asc";o.key===v&&o.direction==="asc"&&(D="desc"),b({key:v,direction:D}),_(x)},C=v=>{v>0&&v<=k&&(L(v),_(v))},G=v=>{const D=new Date(v);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}).format(D)};t.useEffect(()=>{_(x)},[x]);const u=async v=>{if(window.confirm("Are you sure you want to delete this inventory?"))try{y(!0);const{error:j}=await d.from("inventory").delete().eq("id",v);if(j)throw j;i(S=>S.filter(M=>M.id!==v)),r(S=>S.filter(M=>M.id!==v)),alert("Inventory and image deleted successfully.")}catch(j){h("Failed to delete inventory."),console.error(j)}finally{y(!1)}};return e.jsxs("div",{className:"admin-ingredients",children:[e.jsx("h1",{style:{color:"#333"},children:"Manage Inventory"}),e.jsx("p",{style:{color:"#555"},children:"View, create, and edit ingredients."}),e.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search inventories...",value:p,onChange:N,style:{padding:"10px",borderRadius:"4px",border:"1px solid #ccc",width:"100%",maxWidth:"400px"}}),e.jsx("button",{onClick:()=>_(x),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Refresh"}),e.jsx("button",{onClick:()=>n("create"),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Create Inventory"})]}),c&&e.jsx("p",{children:"Loading inventories..."}),l&&e.jsx("p",{style:{color:"red"},children:l}),!c&&!l&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f4f4f4"},children:[e.jsxs("th",{onClick:()=>w("id"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["ID ",o.key==="id"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("ingredientName"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Ingredient Name ",o.key==="ingredientName"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Quantity"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Initial Quantity"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Days Left"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Expiry Date"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Freshness Status"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Condition"}),e.jsxs("th",{onClick:()=>w("created_at"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Created At ",o.key==="created_at"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"Actions"})]})}),e.jsx("tbody",{children:a.map(v=>e.jsxs("tr",{style:{backgroundColor:"#fff"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:v.id}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:v.ingredientName}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:v.quantity}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:v.init_quantity}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:v.days_left}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:v.ingredient_expirydate}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:v.ingredient_freshness}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:v.ingredient_condition}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:G(v.created_at)}),e.jsxs("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>n(`/admin/inventories/view/${v.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#FFA500",color:"white",border:"none",borderRadius:"4px"},children:"View"}),e.jsx("button",{onClick:()=>n(`/admin/inventories/edit/${v.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px"},children:"Edit"}),e.jsx("button",{onClick:()=>u(v.id),style:{padding:"8px 12px",cursor:"pointer",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px"},children:"Delete"})]})]},v.id))})]}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>C(x-1),disabled:x===1,style:{marginRight:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===1?"not-allowed":"pointer"},children:"Previous"}),e.jsxs("span",{children:["Page ",x," of ",k]}),e.jsx("button",{onClick:()=>C(x+1),disabled:x===k,style:{marginLeft:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===k?"not-allowed":"pointer"},children:"Next"})]})]}):!c&&e.jsx("p",{children:"No inventories found."})]})},Yr=()=>{const[n,s]=t.useState(""),[i,a]=t.useState(null),[r,c]=t.useState(""),[y,l]=t.useState(""),[h,p]=t.useState(null),[g,o]=t.useState(null),[b,x]=t.useState(""),[L,k]=t.useState(""),[R,m]=t.useState([]),[_,N]=t.useState([]),[w,C]=t.useState([]);ue(),t.useEffect(()=>{(async()=>{const{data:S,error:M}=await d.from("ingredients").select("id, name"),{data:Q,error:ee}=await d.from("condition").select("id, condition"),{data:F,error:T}=await d.from("profile").select("user, username");M||ee||T?console.error("Error fetching dropdown data:",M||ee||T):(N(S||[]),C(Q||[]),m(F||[]))})()},[]);const G=j=>{s(j)},u=async j=>{a(j);try{const{data:S,error:M}=await d.from("ingredients_expiry").select("date_id").eq("ingredients_id",j).order("date_id",{ascending:!1}).limit(1);if(M||!S||S.length===0)throw new Error("No expiry data found for the selected ingredient.");const Q=S[0].date_id,{data:ee,error:F}=await d.from("expiry_date").select("id, date").eq("id",Q).single();if(F||!ee)throw new Error("No date found for the given date ID.");o(ee.id),x(ee.date);const T=new Date,U=new Date(ee.date)-T,X=Math.ceil(U/(1e3*60*60*24));k(X)}catch(S){console.error("Error retrieving expiry date or calculating days left:",S.message),o(null),x(""),k("")}},v=async j=>{if(j.preventDefault(),!n||!i||!r||!y||!h||!g){alert("Please fill all required fields.");return}try{const{error:S}=await d.from("inventory").insert({user_id:n,ingredient_id:i,quantity:parseFloat(r),init_quantity:parseFloat(y),condition_id:h,expiry_date_id:g,days_left:L});if(S)throw S;alert("Inventory added successfully!"),D()}catch(S){console.error("Error adding inventory:",S.message),alert("Failed to add inventory.")}},D=()=>{s(""),a(null),c(""),l(""),p(null),o(null),x(""),k("")};return e.jsxs("div",{className:"create-inventory-container",children:[e.jsx("h2",{children:"Create New Inventory"}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"User:"}),e.jsxs("select",{value:n,onChange:j=>G(j.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a user"}),R.map(j=>e.jsx("option",{value:j.user,children:j.username},j.user))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ingredient:"}),e.jsxs("select",{value:i||"",onChange:j=>u(parseInt(j.target.value)),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select an ingredient"}),_.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity:"}),e.jsx("input",{type:"number",value:r,onChange:j=>c(j.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Initial Quantity:"}),e.jsx("input",{type:"number",value:y,onChange:j=>l(j.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Condition:"}),e.jsxs("select",{value:h||"",onChange:j=>p(parseInt(j.target.value)),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a condition"}),w.map(j=>e.jsx("option",{value:j.id,children:j.condition},j.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Expiry Date:"}),e.jsx("input",{type:"text",value:b,readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Left:"}),e.jsx("input",{type:"text",value:L,readOnly:!0})]}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Add Inventory"})]})]})},Hr=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState(null),[r,c]=t.useState(null),[y,l]=t.useState(null),[h,p]=t.useState(null),[g,o]=t.useState(null),[b,x]=t.useState(null),[L,k]=t.useState(!0),[R,m]=t.useState(null);t.useEffect(()=>{(async()=>{k(!0),m(null);try{const{data:w,error:C}=await d.from("inventory").select("*").eq("id",n).single();if(C)throw C;a(w);const{data:G,error:u}=await d.from("ingredients").select("name").eq("id",w.ingredient_id).single();c(r);const{data:v,error:D}=await d.from("profile").select("username").eq("user",w.user_id).single();if(D)throw D;if(l(v),!(w!=null&&w.expiry_date_id))p({date:0});else{const{data:ee,error:F}=await d.from("expiry_date").select("date").eq("id",w.expiry_date_id).single();if(F)throw F;p(ee)}const{data:j,error:S}=await d.from("freshness_status").select("status_color").eq("id",w.freshness_status_id).single();if(S)throw S;o(j);const{data:M,error:Q}=await d.from("condition").select("condition").eq("id",w.condition_id).single();if(Q)throw Q;x(M)}catch(w){m("Failed to fetch inventory details."),console.error(w)}finally{k(!1)}})()},[n]);const _=async N=>{if(window.confirm("Are you sure you want to delete this inventory?"))try{k(!0);const{error:C}=await d.from("inventory").delete().eq("id",N);if(C)throw C;alert("Inventory deleted successfully."),s("/admin/inventories")}catch(C){m("Failed to delete inventory."),console.error(C)}finally{k(!1)}};return L?e.jsx("p",{children:"Loading inventory..."}):R?e.jsx("p",{style:{color:"red"},children:R}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx(Le,{}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>s(`/admin/inventories/edit/${n}`),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#FFA500",color:"white",cursor:"pointer"},children:"Edit Inventory"}),e.jsx("button",{onClick:()=>_(i.id),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#f44336",color:"white",cursor:"pointer"},children:"Delete Inventory"})]}),e.jsx("h1",{children:i.name}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Quantity:"})," ",i.quantity]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Initial Quantity:"})," ",i.init_quantity]}),r&&e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Ingredient Name:"})," ",r.name]}),y&&e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Added by:"})," ",y.username]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Expiry Date:"})," ",h.expiry_date]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Days Left:"})," ",i.days_left]}),g&&e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Freshness Status:"})," ",e.jsx("span",{style:{color:g.status_color},children:g.status_color})]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Condition:"})," ",b.condition]}),i.icon_path&&e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${i.icon_path}`,alt:i.name,style:{width:"300px",height:"300px",objectFit:"cover",borderRadius:"8px"}})]})},Xr=()=>{const{id:n}=Ee(),[s,i]=t.useState(""),[a,r]=t.useState(null),[c,y]=t.useState(""),[l,h]=t.useState(""),[p,g]=t.useState(null),[o,b]=t.useState(null),[x,L]=t.useState(""),[k,R]=t.useState(""),[m,_]=t.useState([]),[N,w]=t.useState([]),[C,G]=t.useState([]),u=ue();t.useEffect(()=>{const D=async()=>{const{data:S,error:M}=await d.from("inventory").select("*").eq("id",n).single();if(M||!S){console.error("Error fetching inventory data:",M==null?void 0:M.message),alert("Failed to load inventory data.");return}i(S.user_id),r(S.ingredient_id),y(S.quantity),h(S.init_quantity),g(S.condition_id),b(S.expiry_date_id);const{data:Q,error:ee}=await d.from("expiry_date").select("id, date").eq("id",S.expiry_date_id).single();if(ee||!Q){console.error("Error fetching expiry date:",ee==null?void 0:ee.message);return}L(Q.date);const F=new Date,$=new Date(Q.date)-F,U=Math.ceil($/(1e3*60*60*24));R(U)},j=async()=>{const{data:S}=await d.from("ingredients").select("id, name"),{data:M}=await d.from("condition").select("id, condition"),{data:Q}=await d.from("profile").select("user, username");w(S||[]),G(M||[]),_(Q||[])};D(),j()},[n]);const v=async D=>{if(D.preventDefault(),!s||!a||!c||!l||!p||!o){alert("Please fill all required fields.");return}try{const{error:j}=await d.from("inventory").update({user_id:s,ingredient_id:a,quantity:parseFloat(c),init_quantity:parseFloat(l),condition_id:p,expiry_date_id:o,days_left:k}).eq("id",n);if(j)throw j;alert("Inventory updated successfully!"),u("/inventory")}catch(j){console.error("Error updating inventory:",j.message),alert("Failed to update inventory.")}};return e.jsxs("div",{className:"edit-inventory-container",children:[e.jsx("h2",{children:"Edit Inventory"}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"User:"}),e.jsxs("select",{value:s,onChange:D=>i(D.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a user"}),m.map(D=>e.jsx("option",{value:D.user,children:D.username},D.user))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ingredient:"}),e.jsxs("select",{value:a||"",onChange:D=>r(parseInt(D.target.value)),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select an ingredient"}),N.map(D=>e.jsx("option",{value:D.id,children:D.name},D.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity:"}),e.jsx("input",{type:"number",value:c,onChange:D=>y(D.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Initial Quantity:"}),e.jsx("input",{type:"number",value:l,onChange:D=>h(D.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Condition:"}),e.jsxs("select",{value:p||"",onChange:D=>g(parseInt(D.target.value)),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a condition"}),C.map(D=>e.jsx("option",{value:D.id,children:D.condition},D.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Expiry Date:"}),e.jsx("input",{type:"text",value:x,readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Left:"}),e.jsx("input",{type:"text",value:k,readOnly:!0})]}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Update Inventory"})]})]})},Jr=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState([]),[c,y]=t.useState(!0),[l,h]=t.useState(null),[p,g]=t.useState(""),[o,b]=t.useState({key:"id",direction:"desc"}),[x,L]=t.useState(1),[k,R]=t.useState(1),m=10,_=async(u=1)=>{y(!0),h(null);try{const v=(u-1)*m,D=v+m-1,{data:j,error:S,count:M}=await d.from("ingredients").select("*",{count:"exact"}).order(o.key,{ascending:o.direction==="asc"}).range(v,D);if(S)throw S;const{data:Q,error:ee}=await d.from("ingredients_category").select("*");if(ee)throw ee;const{data:F,error:T}=await d.from("unit").select("*");if(T)throw T;const{data:$,error:U}=await d.from("unitInv").select("*");if(U)throw U;const X=j.map(q=>{const Y=Q.find(E=>E.id===q.ingredients_category_id),P=F.find(E=>E.id===q.quantity_unit_id),I=$.find(E=>E.id===q.quantity_unitInv_id);return{...q,ingredient_category_name:Y?Y.category_name:null,ingredient_unit:P?P.unit_description:null,ingredient_unitInv:I?I.unitInv_tag:null}});i(X),r(X),R(Math.ceil(M/m))}catch(v){h("Failed to fetch ingredients."),console.error(v)}finally{y(!1)}},N=u=>{const v=u.target.value.toLowerCase();if(g(v),v){const D=s.filter(j=>j.name.toLowerCase().includes(v));r(D)}else r(s)},w=u=>{let v="asc";o.key===u&&o.direction==="asc"&&(v="desc"),b({key:u,direction:v}),_(x)},C=u=>{u>0&&u<=k&&(L(u),_(u))};t.useEffect(()=>{_(x)},[x]);const G=async(u,v)=>{if(window.confirm("Are you sure you want to delete this ingredient?"))try{y(!0);const{error:j}=await d.storage.from("ingredient-icons").remove([v]);if(j){console.error("Failed to delete ingredient:",j),h("Failed to delete ingredient image.");return}const{error:S}=await d.from("ingredients").delete().eq("id",u);if(S)throw S;i(M=>M.filter(Q=>Q.id!==u)),r(M=>M.filter(Q=>Q.id!==u)),alert("Ingredient and image deleted successfully.")}catch(j){h("Failed to delete ingredient."),console.error(j)}finally{y(!1)}};return e.jsxs("div",{className:"admin-ingredients",children:[e.jsx("h1",{style:{color:"#333"},children:"Manage Ingredient"}),e.jsx("p",{style:{color:"#555"},children:"View, create, and edit ingredients."}),e.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search ingredients...",value:p,onChange:N,style:{padding:"10px",borderRadius:"4px",border:"1px solid #ccc",width:"100%",maxWidth:"400px"}}),e.jsx("button",{onClick:()=>_(x),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Refresh"}),e.jsx("button",{onClick:()=>n("create"),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Create Ingredient"})]}),c&&e.jsx("p",{children:"Loading ingredients..."}),l&&e.jsx("p",{style:{color:"red"},children:l}),!c&&!l&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f4f4f4"},children:[e.jsxs("th",{onClick:()=>w("id"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["ID ",o.key==="id"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("name"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Name ",o.key==="name"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Nutritional Info"}),e.jsxs("th",{onClick:()=>w("pred_shelf_life"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Pred Shelf Life ",o.key==="pred_shelf_life"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Storage Tips"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Category"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Unit"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"UnitInv"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px"},children:"Image"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"Actions"})]})}),e.jsx("tbody",{children:a.map(u=>e.jsxs("tr",{style:{backgroundColor:"#fff"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.id}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.name}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:Object.entries(u.nutritional_info).map(([v,D])=>`${v}: ${D}`).join(", ")}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.pred_shelf_life}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.storage_tips}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.ingredient_category_name}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.ingredient_unit}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.ingredient_unitInv}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${u.icon_path}`,alt:u.name,style:{width:"50px",height:"50px",objectFit:"cover"}})}),e.jsxs("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>n(`/admin/ingredients/view/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#FFA500",color:"white",border:"none",borderRadius:"4px"},children:"View"}),e.jsx("button",{onClick:()=>n(`/admin/ingredients/edit/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px"},children:"Edit"}),e.jsx("button",{onClick:()=>G(u.id,u.icon_path),style:{padding:"8px 12px",cursor:"pointer",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px"},children:"Delete"})]})]},u.id))})]}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>C(x-1),disabled:x===1,style:{marginRight:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===1?"not-allowed":"pointer"},children:"Previous"}),e.jsxs("span",{children:["Page ",x," of ",k]}),e.jsx("button",{onClick:()=>C(x+1),disabled:x===k,style:{marginLeft:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===k?"not-allowed":"pointer"},children:"Next"})]})]}):!c&&e.jsx("p",{children:"No ingredients found."})]})},Kr=()=>{const[n,s]=t.useState(""),[i,a]=t.useState(null),[r,c]=t.useState({fat:"",protein:"",calories:"",carbohydrate:""}),[y,l]=t.useState(""),[h,p]=t.useState(""),[g,o]=t.useState([]),[b,x]=t.useState([]),[L,k]=t.useState([]),[R,m]=t.useState(null),[_,N]=t.useState(null),[w,C]=t.useState(null),G=ue();t.useEffect(()=>{(async()=>{const{data:S,error:M}=await d.from("ingredients_category").select("id, category_name"),{data:Q,error:ee}=await d.from("unit").select("id, unit_description"),{data:F,error:T}=await d.from("unitInv").select("id, unitInv_tag");M||ee||T?console.error("Error fetching dropdown data:",M||ee):(o(S||[]),x(Q||[]),k(F||[]))})()},[G]);const u=j=>{a(j.target.files[0])},v=async j=>{if(j.preventDefault(),!n||!i||!R||!_){alert("Please fill all required fields.");return}try{const{data:S,error:M}=await d.storage.from("ingredient-icons").upload(`${`icons/${i.name}`}`,i,{upsert:!0});if(M)throw M;const Q=S.path,{error:ee}=await d.from("ingredients").insert({name:n,icon_path:Q,nutritional_info:r,pred_shelf_life:y,storage_tips:h,ingredients_category_id:R,quantity_unit_id:_,quantity_unitInv_id:w});if(ee)throw ee;alert("Ingredient added successfully!"),D()}catch(S){console.error("Error adding ingredient:",S.message),alert("Failed to add ingredient.")}},D=()=>{s(""),a(null),c({fat:"",protein:"",calories:"",carbohydrate:""}),l(""),p(""),m(null),N(null)};return e.jsx("div",{className:"create-ingredient-container",children:e.jsx("div",{className:"admin-content",children:e.jsxs("div",{className:"create-ingredient-container",children:[e.jsx("h2",{children:"Create New Ingredient"}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ingredient Name:"}),e.jsx("input",{type:"text",value:n,onChange:j=>s(j.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Icon (Image):"}),e.jsx("input",{type:"file",accept:"image/*",onChange:u,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nutritional Info:"}),e.jsx("input",{type:"text",placeholder:"Fat",value:r.fat,onChange:j=>c(S=>({...S,fat:j.target.value}))}),e.jsx("input",{type:"text",placeholder:"Protein",value:r.protein,onChange:j=>c(S=>({...S,protein:j.target.value}))}),e.jsx("input",{type:"text",placeholder:"Calories",value:r.calories,onChange:j=>c(S=>({...S,calories:j.target.value}))}),e.jsx("input",{type:"text",placeholder:"Carbohydrate",value:r.carbohydrate,onChange:j=>c(S=>({...S,carbohydrate:j.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Predicted Shelf Life:"}),e.jsx("input",{type:"text",value:y,onChange:j=>l(j.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Storage Tips:"}),e.jsx("textarea",{value:h,onChange:j=>p(j.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ingredient Category:"}),e.jsxs("select",{value:R||"",onChange:j=>m(j.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a category"}),g.map(j=>e.jsx("option",{value:j.id,children:j.category_name},j.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity Unit:"}),e.jsxs("select",{value:_||"",onChange:j=>N(j.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a unit"}),b.map(j=>e.jsx("option",{value:j.id,children:j.unit_description},j.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Inventory Unit:"}),e.jsxs("select",{value:w||"",onChange:j=>C(j.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select an inventory unit"}),L.map(j=>e.jsx("option",{value:j.id,children:j.unitInv_tag},j.id))]})]}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Add Ingredient"})]})]})})})},Zr=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState(null),[r,c]=t.useState(null),[y,l]=t.useState(!0),[h,p]=t.useState(null);t.useEffect(()=>{(async()=>{l(!0),p(null);try{const{data:b,error:x}=await d.from("ingredients").select("*").eq("id",n).single();if(x)throw x;a(b);const{data:L,error:k}=await d.from("ingredients_category").select("*");if(k)throw k;const{data:R,error:m}=await d.from("unit").select("*");if(m)throw m;const{data:_,error:N}=await d.from("unitInv").select("*");if(N)throw N;const w=L.find(v=>v.id===b.ingredients_category_id),C=R.find(v=>v.id===b.quantity_unit_id),G=_.find(v=>v.id===b.quantity_unitInv_id),u={icon:b.icon_path?b.icon_path:null,name:b.name,nutritional_info:b.nutritional_info?b.nutritional_info:null,pred_shelf_life:b.pred_shelf_life?b.pred_shelf_life:null,storage_tips:b.storage_tips?b.storage_tips:null,ingredient_category:w?w.category_name:null,ingredient_unit:C?C.unit_description:null,ingredient_unitInv:G?G.unitInv_tag:null};console.log("Combined Ingredients:",u),c(u)}catch(b){p("Failed to fetch ingredient details."),console.error(b)}finally{l(!1)}})()},[n]);const g=async(o,b)=>{if(window.confirm("Are you sure you want to delete this ingredient?"))try{l(!0);const{error:L}=await d.storage.from("ingredient-icons").remove([b]);if(L){console.error("Failed to delete icon:",L),p("Failed to delete ingredient icon.");return}const{error:k}=await d.from("ingredients").delete().eq("id",o);if(k)throw k;alert("Ingredient and image deleted successfully."),s("/admin/ingredients")}catch(L){p("Failed to delete ingredient."),console.error(L)}finally{l(!1)}};return y?e.jsx("p",{children:"Loading ingredient..."}):h?e.jsx("p",{style:{color:"red"},children:h}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx(Le,{}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>s(`/admin/ingredients/edit/${n}`),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#FFA500",color:"white",cursor:"pointer"},children:"Edit Ingredient"}),e.jsx("button",{onClick:()=>g(r.id,r.icon_path),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#f44336",color:"white",cursor:"pointer"},children:"Delete Ingredient"})]}),e.jsx("h1",{children:r.name}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Nutritional Info:"})," ",Object.entries(r.nutritional_info).map(([o,b])=>`${o}: ${b}`).join(", ")]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Pred Shelf Life:"})," ",r.pred_shelf_life," "]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Storage Tips:"})," ",r.storage_tips," "]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Category:"})," ",r.ingredient_category," "]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Unit:"})," ",r.ingredient_unit," "]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Inventory Unit:"})," ",r.ingredient_unitInv," "]}),e.jsx("img",{src:`https://wryzdgcrrejrwfqsdaog.supabase.co/storage/v1/object/public/${i.icon_path}`,alt:r.name,style:{width:"300px",height:"300px",objectFit:"cover",borderRadius:"8px"}})]})},ei=()=>{const{id:n}=Ee(),[s,i]=t.useState(""),[a,r]=t.useState(null),[c,y]=t.useState({fat:"",protein:"",calories:"",carbohydrate:""}),[l,h]=t.useState(""),[p,g]=t.useState(""),[o,b]=t.useState([]),[x,L]=t.useState([]),[k,R]=t.useState([]),[m,_]=t.useState(null),[N,w]=t.useState(null),[C,G]=t.useState(null),[u,v]=t.useState(""),D=ue();t.useEffect(()=>{(async()=>{try{const{data:Q,error:ee}=await d.from("ingredients").select("*").eq("id",n).single();if(ee)throw ee;i(Q.name),y(Q.nutritional_info||{}),h(Q.pred_shelf_life),g(Q.storage_tips),_(Q.ingredients_category_id),w(Q.quantity_unit_id),G(Q.quantity_unitInv_id),v(Q.icon_path);const{data:F,error:T}=await d.from("ingredients_category").select("id, category_name"),{data:$,error:U}=await d.from("unit").select("id, unit_description"),{data:X,error:q}=await d.from("unitInv").select("id, unitInv_tag");T||U||q?console.error("Error fetching dropdown data:",T||U||q):(b(F||[]),L($||[]),R(X||[]))}catch(Q){console.error("Error fetching ingredient data:",Q.message)}})()},[n]);const j=M=>{r(M.target.files[0])},S=async M=>{if(M.preventDefault(),!s||!m||!N){alert("Please fill all required fields.");return}try{let Q=u;if(a){const{data:F,error:T}=await d.storage.from("ingredient-icons").upload(`icons/${a.name}`,a,{upsert:!0});if(T)throw T;Q=F.path}const{error:ee}=await d.from("ingredients").update({name:s,icon_path:Q,nutritional_info:c,pred_shelf_life:l,storage_tips:p,ingredients_category_id:m,quantity_unit_id:N,quantity_unitInv_id:C}).eq("id",n);if(ee)throw ee;alert("Ingredient updated successfully!"),D("/admin/ingredients")}catch(Q){console.error("Error updating ingredient:",Q.message),alert("Failed to update ingredient.")}};return e.jsx("div",{className:"edit-ingredient-container",children:e.jsx("div",{className:"admin-content",children:e.jsxs("div",{className:"edit-ingredient-container",children:[e.jsx("h2",{children:"Edit Ingredient"}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ingredient Name:"}),e.jsx("input",{type:"text",value:s,onChange:M=>i(M.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Current Icon:"}),u&&e.jsx("img",{src:`${d.storage.from("ingredient-icons").getPublicUrl(u).publicURL}`,alt:"Current Icon",className:"current-icon"}),e.jsx("label",{children:"New Icon (optional):"}),e.jsx("input",{type:"file",accept:"image/*",onChange:j})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nutritional Info:"}),e.jsx("input",{type:"text",placeholder:"Fat",value:c.fat,onChange:M=>y(Q=>({...Q,fat:M.target.value}))}),e.jsx("input",{type:"text",placeholder:"Protein",value:c.protein,onChange:M=>y(Q=>({...Q,protein:M.target.value}))}),e.jsx("input",{type:"text",placeholder:"Calories",value:c.calories,onChange:M=>y(Q=>({...Q,calories:M.target.value}))}),e.jsx("input",{type:"text",placeholder:"Carbohydrate",value:c.carbohydrate,onChange:M=>y(Q=>({...Q,carbohydrate:M.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Predicted Shelf Life:"}),e.jsx("input",{type:"text",value:l,onChange:M=>h(M.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Storage Tips:"}),e.jsx("textarea",{value:p,onChange:M=>g(M.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ingredient Category:"}),e.jsxs("select",{value:m||"",onChange:M=>_(M.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a category"}),o.map(M=>e.jsx("option",{value:M.id,children:M.category_name},M.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity Unit:"}),e.jsxs("select",{value:N||"",onChange:M=>w(M.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a unit"}),x.map(M=>e.jsx("option",{value:M.id,children:M.unit_description},M.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Inventory Unit:"}),e.jsxs("select",{value:C||"",onChange:M=>G(M.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select an inventory unit"}),k.map(M=>e.jsx("option",{value:M.id,children:M.unitInv_tag},M.id))]})]}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Update Ingredient"})]})]})})})},ti=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState([]),[c,y]=t.useState(!0),[l,h]=t.useState(null),[p,g]=t.useState(""),[o,b]=t.useState({key:"unit_description",direction:"asc"}),[x,L]=t.useState(1),[k,R]=t.useState(1),m=10,_=async(u=1)=>{y(!0),h(null);try{const D=(u-1)*m+m-1,{data:j,error:S}=await d.from("unit").select("id, unit_description, unit_tag, conversion_rate_to_grams");if(S)throw S;i(j),r(j),R(Math.ceil(j.length/m))}catch(v){h("Failed to fetch units."),console.error(v)}finally{y(!1)}},N=u=>{const v=u.target.value.toLowerCase();if(g(v),v){const D=s.filter(j=>j.unit_description.toLowerCase().includes(v)||j.unit_tag.toLowerCase().includes(v));r(D)}else r(s)},w=u=>{let v="asc";o.key===u&&o.direction==="asc"&&(v="desc"),b({key:u,direction:v}),_(x)},C=u=>{u>0&&u<=k&&(L(u),_(u))};t.useEffect(()=>{_(x)},[x]);const G=async u=>{if(window.confirm("Are you sure you want to delete this unit?"))try{y(!0);const{error:D}=await d.from("unit").delete().eq("id",u);if(D)throw D;i(j=>j.filter(S=>S.id!==u)),r(j=>j.filter(S=>S.id!==u)),alert("Unit deleted successfully.")}catch(D){h("Failed to delete unit."),console.error(D)}finally{y(!1)}};return e.jsxs("div",{className:"admin-units",children:[e.jsx("h1",{children:"Manage Units"}),e.jsx("p",{children:"View, create, and manage units."}),e.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search units...",value:p,onChange:N,style:{padding:"10px",borderRadius:"4px",border:"1px solid #ccc",width:"100%",maxWidth:"400px"}}),e.jsx("button",{onClick:()=>_(x),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Refresh"}),e.jsx("button",{onClick:()=>n("create"),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Create Unit"})]}),c&&e.jsx("p",{children:"Loading units..."}),l&&e.jsx("p",{style:{color:"red"},children:l}),!c&&!l&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f4f4f4"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"ID"}),e.jsxs("th",{onClick:()=>w("unit_description"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Unit Description ",o.key==="unit_description"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("unit_tag"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Unit Tag ",o.key==="unit_tag"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("conversion_rate_to_grams"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Conversion Rate to Grams ",o.key==="conversion_rate_to_grams"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"Actions"})]})}),e.jsx("tbody",{children:a.map(u=>e.jsxs("tr",{style:{backgroundColor:"#fff"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.id}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.unit_description}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.unit_tag}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.conversion_rate_to_grams}),e.jsxs("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>n(`/admin/units/view/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#FFA500",color:"white",border:"none",borderRadius:"4px"},children:"View"}),e.jsx("button",{onClick:()=>n(`/admin/units/edit/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px"},children:"Edit"}),e.jsx("button",{onClick:()=>G(u.id),style:{padding:"8px 12px",cursor:"pointer",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px"},children:"Delete"})]})]},u.id))})]}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>C(x-1),disabled:x===1,style:{marginRight:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===1?"not-allowed":"pointer"},children:"Previous"}),e.jsxs("span",{children:["Page ",x," of ",k]}),e.jsx("button",{onClick:()=>C(x+1),disabled:x===k,style:{marginLeft:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===k?"not-allowed":"pointer"},children:"Next"})]})]}):!c&&e.jsx("p",{children:"No units found."})]})},ni=()=>{const n=ue(),[s,i]=t.useState({unitTag:"",unitDescription:"",conversionRateToGrams:""}),[a,r]=t.useState(!1),[c,y]=t.useState(null),l=p=>{i({...s,[p.target.name]:p.target.value})},h=async p=>{p.preventDefault(),r(!0),y(null);try{const{error:g}=await d.from("unit").insert([{unit_tag:s.unitTag,unit_description:s.unitDescription,conversion_rate_to_grams:parseFloat(s.conversionRateToGrams)}]);if(g)throw g;n("/admin/units")}catch(g){y(g.message)}finally{r(!1)}};return e.jsxs("div",{className:"create-unit-container",children:[e.jsxs("div",{className:"create-unit-header",children:[e.jsx("h2",{children:"Create New Unit"}),e.jsx("button",{className:"back-btn",onClick:()=>n("/admin/units"),children:"Back to Units"})]}),c&&e.jsx("div",{className:"error-message",children:c}),e.jsxs("form",{onSubmit:h,className:"create-unit-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"unitTag",children:"Unit Tag:"}),e.jsx("input",{type:"text",id:"unitTag",name:"unitTag",value:s.unitTag,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"unitDescription",children:"Unit Description:"}),e.jsx("input",{type:"text",id:"unitDescription",name:"unitDescription",value:s.unitDescription,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"conversionRateToGrams",children:"Conversion Rate to Grams:"}),e.jsx("input",{type:"number",id:"conversionRateToGrams",name:"conversionRateToGrams",value:s.conversionRateToGrams,onChange:l,required:!0,min:"0"})]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:a,children:a?"Creating...":"Create Unit"})]})]})},si=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState(null),[r,c]=t.useState(!0),[y,l]=t.useState(null);t.useEffect(()=>{(async()=>{c(!0),l(null);try{const{data:g,error:o}=await d.from("unit").select("*").eq("id",n).single();if(o)throw o;a(g)}catch(g){l("Failed to fetch unit details."),console.error(g)}finally{c(!1)}})()},[n]);const h=async p=>{if(window.confirm("Are you sure you want to delete this unit?"))try{c(!0);const{error:o}=await d.from("unit").delete().eq("id",p);if(o)throw o;alert("Unit deleted successfully."),s("/admin/units")}catch(o){l("Failed to delete unit."),console.error(o)}finally{c(!1)}};return r?e.jsx("p",{children:"Loading unit..."}):y?e.jsx("p",{style:{color:"red"},children:y}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx(Le,{}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>s(`/admin/units/edit/${n}`),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#FFA500",color:"white",cursor:"pointer"},children:"Edit Unit"}),e.jsx("button",{onClick:()=>h(i.id),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#f44336",color:"white",cursor:"pointer"},children:"Delete Unit"})]}),e.jsx("h1",{children:i.unit_description}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Unit Tag:"})," ",i.unit_tag]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Conversion Rate to Grams:"})," ",i.conversion_rate_to_grams]})]})},ri=()=>{const{id:n}=Ee(),[s,i]=t.useState(""),[a,r]=t.useState(""),[c,y]=t.useState("");t.useState(null),t.useState(""),t.useState([]);const l=ue();t.useEffect(()=>{(async()=>{try{const{data:g,error:o}=await d.from("unit").select("*").eq("id",n).single();if(o)throw o;i(g.unit_tag),r(g.unit_description),y(g.conversion_rate_to_grams)}catch(g){console.error("Error fetching unit data:",g.message)}})()},[n]);const h=async p=>{if(p.preventDefault(),!s||!a||!c){alert("Please fill all required fields.");return}try{const{error:g}=await d.from("unit").update({unit_tag:s,unit_description:a,conversion_rate_to_grams:c}).eq("id",n);if(g)throw g;alert("Unit updated successfully!"),l("/admin/units")}catch(g){console.error("Error updating unit:",g.message),alert("Failed to update unit.")}};return e.jsx("div",{className:"edit-unit-container",children:e.jsxs("div",{className:"admin-content",children:[e.jsx("h2",{children:"Edit Unit"}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Tag:"}),e.jsx("input",{type:"text",value:s,onChange:p=>i(p.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Description:"}),e.jsx("input",{type:"text",value:a,onChange:p=>r(p.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Conversion Rate to Grams:"}),e.jsx("input",{type:"number",value:c||"",onChange:p=>y(p.target.value),required:!0,min:"0"})]}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Update Unit"})]})]})})},ii=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState([]),[c,y]=t.useState(!0),[l,h]=t.useState(null),[p,g]=t.useState(""),[o,b]=t.useState({key:"unitInv_tag",direction:"asc"}),[x,L]=t.useState(1),[k,R]=t.useState(1),m=10,_=async(u=1)=>{y(!0),h(null);try{const D=(u-1)*m+m-1,{data:j,error:S}=await d.from("unitInv").select("id, unitInv_tag, conversion_rate_to_grams_for_check");if(S)throw S;i(j),r(j),R(Math.ceil(j.length/m))}catch(v){h("Failed to fetch unit inventory."),console.error(v)}finally{y(!1)}},N=u=>{const v=u.target.value.toLowerCase();if(g(v),v){const D=s.filter(j=>j.unitinv_tag.toLowerCase().includes(v));r(D)}else r(s)},w=u=>{let v="asc";o.key===u&&o.direction==="asc"&&(v="desc"),b({key:u,direction:v}),_(x)},C=u=>{u>0&&u<=k&&(L(u),_(u))};t.useEffect(()=>{_(x)},[x]);const G=async u=>{if(window.confirm("Are you sure you want to delete this unit inventory?"))try{y(!0);const{error:D}=await d.from("unitInv").delete().eq("id",u);if(D)throw D;i(j=>j.filter(S=>S.id!==u)),r(j=>j.filter(S=>S.id!==u)),alert("Unit inventory deleted successfully.")}catch(D){h("Failed to delete unit inventory."),console.error(D)}finally{y(!1)}};return e.jsxs("div",{className:"admin-unit-inv",children:[e.jsx("h1",{children:"Manage Unit Inventory"}),e.jsx("p",{children:"View and manage unit inventory."}),e.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search unit inventory...",value:p,onChange:N,style:{padding:"10px",borderRadius:"4px",border:"1px solid #ccc",width:"100%",maxWidth:"400px"}}),e.jsx("button",{onClick:()=>_(x),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Refresh"}),e.jsx("button",{onClick:()=>n("create"),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Create Unit Inventory"})]}),c&&e.jsx("p",{children:"Loading unit inventory..."}),l&&e.jsx("p",{style:{color:"red"},children:l}),!c&&!l&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f4f4f4"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"ID"}),e.jsxs("th",{onClick:()=>w("unitInv_tag"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Unit Inventory Tag ",o.key==="unitInv_tag"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("conversion_rate_to_grams_for_check"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Conversion Rate to Grams for Check ",o.key==="conversion_rate_to_grams_for_check"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"Actions"})]})}),e.jsx("tbody",{children:a.map(u=>e.jsxs("tr",{style:{backgroundColor:"#fff"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.id}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.unitInv_tag}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.conversion_rate_to_grams_for_check}),e.jsxs("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>n(`/admin/unitinv/view/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#FFA500",color:"white",border:"none",borderRadius:"4px"},children:"View"}),e.jsx("button",{onClick:()=>n(`/admin/unitinv/edit/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px"},children:"Edit"}),e.jsx("button",{onClick:()=>G(u.id),style:{padding:"8px 12px",cursor:"pointer",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px"},children:"Delete"})]})]},u.id))})]}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>C(x-1),disabled:x===1,style:{marginRight:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===1?"not-allowed":"pointer"},children:"Previous"}),e.jsxs("span",{children:["Page ",x," of ",k]}),e.jsx("button",{onClick:()=>C(x+1),disabled:x===k,style:{marginLeft:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===k?"not-allowed":"pointer"},children:"Next"})]})]}):!c&&e.jsx("p",{children:"No unit inventory found."})]})},ai=()=>{const n=ue(),[s,i]=t.useState({unitInvTag:"",conversionRateToGramsForCheck:""}),[a,r]=t.useState(!1),[c,y]=t.useState(null),l=p=>{i({...s,[p.target.name]:p.target.value})},h=async p=>{p.preventDefault(),r(!0),y(null);try{const{error:g}=await d.from("unitInv").insert([{unitInv_tag:s.unitInvTag,conversion_rate_to_grams_for_check:parseFloat(s.conversionRateToGramsForCheck)}]);if(g)throw g;n("/admin/unitinv")}catch(g){y(g.message)}finally{r(!1)}};return e.jsxs("div",{className:"create-unitinv-container",children:[e.jsxs("div",{className:"create-unitinv-header",children:[e.jsx("h2",{children:"Create New Unit Inventory"}),e.jsx("button",{className:"back-btn",onClick:()=>n("/admin/unitinv"),children:"Back to Unit Inventory"})]}),c&&e.jsx("div",{className:"error-message",children:c}),e.jsxs("form",{onSubmit:h,className:"create-unitinv-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"unitInvTag",children:"Unit Inventory Tag:"}),e.jsx("input",{type:"text",id:"unitInvTag",name:"unitInvTag",value:s.unitInvTag,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"conversionRateToGramsForCheck",children:"Conversion Rate to Grams for Check:"}),e.jsx("input",{type:"number",id:"conversionRateToGramsForCheck",name:"conversionRateToGramsForCheck",value:s.conversionRateToGramsForCheck,onChange:l,required:!0,min:"0"})]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:a,children:a?"Creating...":"Create Unit Inventory"})]})]})},oi=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState(null),[r,c]=t.useState(!0),[y,l]=t.useState(null);t.useEffect(()=>{(async()=>{c(!0),l(null);try{const{data:g,error:o}=await d.from("unitInv").select("*").eq("id",n).single();if(o)throw o;a(g)}catch(g){l("Failed to fetch unit inventory details."),console.error(g)}finally{c(!1)}})()},[n]);const h=async p=>{if(window.confirm("Are you sure you want to delete this unit inventory?"))try{c(!0);const{error:o}=await d.from("unitInv").delete().eq("id",p);if(o)throw o;alert("Unit inventory deleted successfully."),s("/admin/unitinv")}catch(o){l("Failed to delete unit inventory."),console.error(o)}finally{c(!1)}};return r?e.jsx("p",{children:"Loading unit inventory..."}):y?e.jsx("p",{style:{color:"red"},children:y}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx(Le,{}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>s(`/admin/unitinv/edit/${n}`),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#FFA500",color:"white",cursor:"pointer"},children:"Edit Unit Inventory"}),e.jsx("button",{onClick:()=>h(i.id),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#f44336",color:"white",cursor:"pointer"},children:"Delete Unit Inventory"})]}),e.jsx("h1",{children:i.unitinv_tag}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Unit Inventory Tag:"})," ",i.unitInv_tag]}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Conversion Rate to Grams for Check:"})," ",i.conversion_rate_to_grams_for_check]})]})},ci=()=>{const{id:n}=Ee(),[s,i]=t.useState(""),[a,r]=t.useState(""),c=ue();t.useEffect(()=>{(async()=>{try{const{data:h,error:p}=await d.from("unitInv").select("*").eq("id",n).single();if(p)throw p;i(h.unitInv_tag),r(h.conversion_rate_to_grams_for_check)}catch(h){console.error("Error fetching unit inventory data:",h.message)}})()},[n]);const y=async l=>{if(l.preventDefault(),!s||!a){alert("Please fill all required fields.");return}try{const{error:h}=await d.from("unitInv").update({unitInv_tag:s,conversion_rate_to_grams_for_check:a}).eq("id",n);if(h)throw h;alert("Unit inventory updated successfully!"),c("/admin/unitinv")}catch(h){console.error("Error updating unit inventory:",h.message),alert("Failed to update unit inventory.")}};return e.jsx("div",{className:"edit-unitinv-container",children:e.jsxs("div",{className:"admin-content",children:[e.jsx("h2",{children:"Edit Unit Inventory"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Inventory Tag:"}),e.jsx("input",{type:"text",value:s,onChange:l=>i(l.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Conversion Rate to Grams for Check:"}),e.jsx("input",{type:"number",value:a||"",onChange:l=>r(l.target.value),required:!0,min:"0"})]}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Update Unit Inventory"})]})]})})},li=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState([]),[c,y]=t.useState(!0),[l,h]=t.useState(null),[p,g]=t.useState(""),[o,b]=t.useState({key:"category_name",direction:"asc"}),[x,L]=t.useState(1),[k,R]=t.useState(1),m=10,_=async(u=1)=>{y(!0),h(null);try{const D=(u-1)*m+m-1,{data:j,error:S}=await d.from("ingredients_category").select("id, category_name, category_tag");if(S)throw S;i(j),r(j),R(Math.ceil(j.length/m))}catch(v){h("Failed to fetch categories."),console.error(v)}finally{y(!1)}},N=u=>{const v=u.target.value.toLowerCase();if(g(v),v){const D=s.filter(j=>j.category_name.toLowerCase().includes(v)||j.category_tag.toLowerCase().includes(v));r(D)}else r(s)},w=u=>{let v="asc";o.key===u&&o.direction==="asc"&&(v="desc"),b({key:u,direction:v}),_(x)},C=u=>{u>0&&u<=k&&(L(u),_(u))};t.useEffect(()=>{_(x)},[x]);const G=async u=>{if(window.confirm("Are you sure you want to delete this category?"))try{y(!0);const{error:D}=await d.from("ingredients_category").delete().eq("id",u);if(D)throw D;i(j=>j.filter(S=>S.id!==u)),r(j=>j.filter(S=>S.id!==u)),alert("Category deleted successfully.")}catch(D){h("Failed to delete category."),console.error(D)}finally{y(!1)}};return e.jsxs("div",{className:"admin-ingredients-category",children:[e.jsx("h1",{children:"Manage Ingredients Categories"}),e.jsx("p",{children:"View, create, and manage ingredients categories."}),e.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search categories...",value:p,onChange:N,style:{padding:"10px",borderRadius:"4px",border:"1px solid #ccc",width:"100%",maxWidth:"400px"}}),e.jsx("button",{onClick:()=>_(x),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Refresh"}),e.jsx("button",{onClick:()=>n("create"),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Create Category"})]}),c&&e.jsx("p",{children:"Loading categories..."}),l&&e.jsx("p",{style:{color:"red"},children:l}),!c&&!l&&a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f4f4f4"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"ID"}),e.jsxs("th",{onClick:()=>w("category_name"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Category Name ",o.key==="category_name"&&(o.direction==="asc"?"↑":"↓")]}),e.jsxs("th",{onClick:()=>w("category_tag"),style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",cursor:"pointer"},children:["Category Tag ",o.key==="category_tag"&&(o.direction==="asc"?"↑":"↓")]}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"Actions"})]})}),e.jsx("tbody",{children:a.map(u=>e.jsxs("tr",{style:{backgroundColor:"#fff"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.id}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.category_name}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:u.category_tag}),e.jsxs("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>n(`/admin/ingredientscat/view/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#FFA500",color:"white",border:"none",borderRadius:"4px"},children:"View"}),e.jsx("button",{onClick:()=>n(`/admin/ingredientscat/edit/${u.id}`),style:{marginRight:"10px",padding:"8px 12px",cursor:"pointer",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px"},children:"Edit"}),e.jsx("button",{onClick:()=>G(u.id),style:{padding:"8px 12px",cursor:"pointer",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px"},children:"Delete"})]})]},u.id))})]}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>C(x-1),disabled:x===1,style:{marginRight:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===1?"not-allowed":"pointer"},children:"Previous"}),e.jsxs("span",{children:["Page ",x," of ",k]}),e.jsx("button",{onClick:()=>C(x+1),disabled:x===k,style:{marginLeft:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:x===k?"not-allowed":"pointer"},children:"Next"})]})]}):!c&&e.jsx("p",{children:"No categories found."})]})},di=()=>{const n=ue(),[s,i]=t.useState({categoryTag:"",categoryName:""}),[a,r]=t.useState(!1),[c,y]=t.useState(null),l=p=>{i({...s,[p.target.name]:p.target.value})},h=async p=>{p.preventDefault(),r(!0),y(null);try{const{error:g}=await d.from("ingredients_category").insert([{category_tag:s.categoryTag,category_name:s.categoryName}]);if(g)throw g;n("/admin/ingredientscat")}catch(g){y(g.message)}finally{r(!1)}};return e.jsxs("div",{className:"create-ingredients-cat-container",children:[e.jsxs("div",{className:"create-ingredients-cat-header",children:[e.jsx("h2",{children:"Create New Ingredient Category"}),e.jsx("button",{className:"back-btn",onClick:()=>n("/admin/ingredients-category"),children:"Back to Categories"})]}),c&&e.jsx("div",{className:"error-message",children:c}),e.jsxs("form",{onSubmit:h,className:"create-ingredients-cat-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"categoryTag",children:"Category Tag:"}),e.jsx("input",{type:"text",id:"categoryTag",name:"categoryTag",value:s.categoryTag,onChange:l,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"categoryName",children:"Category Name:"}),e.jsx("input",{type:"text",id:"categoryName",name:"categoryName",value:s.categoryName,onChange:l,required:!0})]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:a,children:a?"Creating...":"Create Category"})]})]})},ui=()=>{const{id:n}=Ee(),s=ue(),[i,a]=t.useState(null),[r,c]=t.useState(!0),[y,l]=t.useState(null);t.useEffect(()=>{(async()=>{c(!0),l(null);try{const{data:g,error:o}=await d.from("ingredients_category").select("*").eq("id",n).single();if(o)throw o;a(g)}catch(g){l("Failed to fetch ingredient category details."),console.error(g)}finally{c(!1)}})()},[n]);const h=async p=>{if(window.confirm("Are you sure you want to delete this ingredient category?"))try{c(!0);const{error:o}=await d.from("ingredients_category").delete().eq("id",p);if(o)throw o;alert("Ingredient category deleted successfully."),s("/admin/ingredientscat")}catch(o){l("Failed to delete ingredient category."),console.error(o)}finally{c(!1)}};return r?e.jsx("p",{children:"Loading ingredient category..."}):y?e.jsx("p",{style:{color:"red"},children:y}):e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx(Le,{}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>s(`/admin/ingredientscat/edit/${n}`),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#FFA500",color:"white",cursor:"pointer"},children:"Edit Category"}),e.jsx("button",{onClick:()=>h(i.id),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#f44336",color:"white",cursor:"pointer"},children:"Delete Category"})]}),e.jsx("h1",{children:i.category_name}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Category Tag:"})," ",i.category_tag]})]})},pi=()=>{const{id:n}=Ee(),[s,i]=t.useState(""),[a,r]=t.useState(""),c=ue();t.useEffect(()=>{(async()=>{try{const{data:h,error:p}=await d.from("ingredients_category").select("*").eq("id",n).single();if(p)throw p;i(h.category_tag),r(h.category_name)}catch(h){console.error("Error fetching category data:",h.message)}})()},[n]);const y=async l=>{if(l.preventDefault(),!s||!a){alert("Please fill all required fields.");return}try{const{error:h}=await d.from("ingredients_category").update({category_tag:s,category_name:a}).eq("id",n);if(h)throw h;alert("Ingredient category updated successfully!"),c("/admin/ingredientscat")}catch(h){console.error("Error updating ingredient category:",h.message),alert("Failed to update ingredient category.")}};return e.jsx("div",{className:"edit-ingredients-cat-container",children:e.jsxs("div",{className:"admin-content",children:[e.jsx("h2",{children:"Edit Ingredient Category"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category Tag:"}),e.jsx("input",{type:"text",value:s,onChange:l=>i(l.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category Name:"}),e.jsx("input",{type:"text",value:a,onChange:l=>r(l.target.value),required:!0})]}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Update Category"})]})]})})},hi=()=>{const n=ue(),[s,i]=t.useState([]),[a,r]=t.useState(!0),[c,y]=t.useState(null),[l,h]=t.useState(1),[p,g]=t.useState(1),o=10,b=async(L=1)=>{r(!0),y(null);try{const k=(L-1)*o,R=k+o-1,{data:m,error:_}=await d.from("expiry_date").select("id, date").range(k,R);if(_)throw _;i(m);const{count:N}=await d.from("expiry_date").select("*",{count:"exact",head:!0});g(Math.ceil(N/o))}catch(k){y("Failed to fetch expiry dates."),console.error(k)}finally{r(!1)}},x=L=>{L>0&&L<=p&&(h(L),b(L))};return t.useEffect(()=>{b(l)},[l]),e.jsxs("div",{className:"admin-expiry-date",children:[e.jsx("h1",{children:"Manage Expiry Dates"}),e.jsx("p",{children:"View and manage expiry dates."}),e.jsx("div",{style:{marginBottom:"20px",display:"flex",gap:"10px"},children:e.jsx("button",{onClick:()=>n("create"),style:{padding:"10px 20px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"white",cursor:"pointer"},children:"Create Expiry Date"})}),a&&e.jsx("p",{children:"Loading expiry dates..."}),c&&e.jsx("p",{style:{color:"red"},children:c}),!a&&!c&&s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",backgroundColor:"#fff"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f4f4f4"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:"ID"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"left"},children:"Date"})]})}),e.jsx("tbody",{children:s.map(L=>e.jsxs("tr",{style:{backgroundColor:"#fff"},children:[" ",e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:L.id}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:L.date})]},L.id))})]}),e.jsxs("div",{style:{marginTop:"20px",textAlign:"center"},children:[e.jsx("button",{onClick:()=>x(l-1),disabled:l===1,style:{marginRight:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:l===1?"not-allowed":"pointer"},children:"Previous"}),e.jsxs("span",{children:["Page ",l," of ",p]}),e.jsx("button",{onClick:()=>x(l+1),disabled:l===p,style:{marginLeft:"10px",padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:l===p?"not-allowed":"pointer"},children:"Next"})]})]}):!a&&e.jsx("p",{children:"No expiry dates found."})]})},mi=()=>{const n=ue(),[s,i]=t.useState({date:""}),[a,r]=t.useState(!1),[c,y]=t.useState(null),l=p=>{i({...s,[p.target.name]:p.target.value})},h=async p=>{p.preventDefault(),r(!0),y(null);try{const{error:g}=await d.from("expiry_date").insert([{date:s.date}]);if(g)throw g;n("/admin/expirydate")}catch(g){y(g.message)}finally{r(!1)}};return e.jsxs("div",{className:"create-expiry-date-container",children:[e.jsxs("div",{className:"create-expiry-date-header",children:[e.jsx("h2",{children:"Create New Expiry Date"}),e.jsx("button",{className:"back-btn",onClick:()=>n("/admin/expiry-dates"),children:"Back to Expiry Dates"})]}),c&&e.jsx("div",{className:"error-message",style:{color:"red"},children:c}),e.jsxs("form",{onSubmit:h,className:"create-expiry-date-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"date",children:"Date:"}),e.jsx("input",{type:"date",id:"date",name:"date",value:s.date,onChange:l,required:!0})]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:a,children:a?"Creating...":"Create Expiry Date"})]})]})},gi=()=>{const{userRole:n}=It(),[s,i]=t.useState(!1),[a,r]=t.useState(!1);t.useEffect(()=>{const y=()=>{window.innerWidth<=768?r(!0):r(!1)};return y(),window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]);const c=()=>{r(!a)};return s?e.jsx(Ue,{}):e.jsxs("div",{className:`App ${n==="admin"?a?"sidebar-collapsed":"sidebar-expanded":""}`,children:[n==="client"?e.jsxs(e.Fragment,{children:[e.jsx(Os,{}),e.jsx("div",{className:"stickyBottom",children:e.jsx(Bs,{})})]}):n==="admin"?e.jsx(Et,{isCollapsed:a,toggleSidebar:c}):null,e.jsx("main",{className:n==="admin"?"admin-main-content":"",children:e.jsxs(kt,{children:[e.jsx(le,{path:"/",element:n?n==="admin"?e.jsx(ze,{to:"/admin/dashboard"}):e.jsx(ze,{to:"/dashboard"}):e.jsx(ze,{to:"/login"})}),e.jsx(le,{path:"/login",element:e.jsx(Ls,{})}),e.jsx(le,{path:"/forgetpassword",element:e.jsx(Ms,{})}),e.jsx(le,{path:"/signup",element:e.jsx($s,{})}),n==="client"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{path:"/dashboard",element:e.jsx(ht,{children:e.jsx(zs,{})})}),e.jsx(le,{path:"/inventory",element:e.jsx(ht,{children:e.jsx(Js,{})})}),e.jsx(le,{path:"/scan",element:e.jsx(ht,{children:e.jsx(rr,{})})}),e.jsx(le,{path:"/recipes/*",element:e.jsx(ht,{children:e.jsx(_r,{})})}),e.jsx(le,{path:"/profile",element:e.jsx(ht,{children:e.jsx(wr,{})})})]}),n==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{path:"/admin/dashboard",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Sr,{})})}),e.jsx(le,{path:"/admin/recipe-management/*",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Or,{})})}),e.jsx(le,{path:"/admin/users",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Br,{})})}),e.jsx(le,{path:"/admin/users/create",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Gr,{})})}),e.jsx(le,{path:"/admin/users/view/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(zr,{})})}),e.jsx(le,{path:"/admin/users/edit/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Vr,{})})}),e.jsx(le,{path:"/admin/inventories",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Wr,{})})}),e.jsx(le,{path:"/admin/inventories/create",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Yr,{})})}),e.jsx(le,{path:"/admin/inventories/view/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Hr,{})})}),e.jsx(le,{path:"/admin/inventories/edit/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Xr,{})})}),e.jsx(le,{path:"/admin/ingredients",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Jr,{})})}),e.jsx(le,{path:"/admin/ingredients/create",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Kr,{})})}),e.jsx(le,{path:"/admin/ingredients/view/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(Zr,{})})}),e.jsx(le,{path:"/admin/ingredients/edit/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(ei,{})})}),e.jsx(le,{path:"/admin/units",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(ti,{})})}),e.jsx(le,{path:"/admin/units/create",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(ni,{})})}),e.jsx(le,{path:"/admin/units/view/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(si,{})})}),e.jsx(le,{path:"/admin/units/edit/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(ri,{})})}),e.jsx(le,{path:"/admin/unitinv",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(ii,{})})}),e.jsx(le,{path:"/admin/unitinv/create",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(ai,{})})}),e.jsx(le,{path:"/admin/unitinv/view/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(oi,{})})}),e.jsx(le,{path:"/admin/unitinv/edit/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(ci,{})})}),e.jsx(le,{path:"/admin/ingredientscat",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(li,{})})}),e.jsx(le,{path:"/admin/ingredientscat/create",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(di,{})})}),e.jsx(le,{path:"/admin/ingredientscat/view/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(ui,{})})}),e.jsx(le,{path:"/admin/ingredientscat/edit/:id",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(pi,{})})}),e.jsx(le,{path:"/admin/expirydate",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(hi,{})})}),e.jsx(le,{path:"/admin/expirydate/create",element:e.jsx(Ce,{isCollapsed:a,toggleSidebar:c,children:e.jsx(mi,{})})})]}),e.jsx(le,{path:"*",element:e.jsx(ze,{to:"/"})})]})})]})};Xn(document.getElementById("root")).render(e.jsx(Kn,{basename:"/Time2Use",children:e.jsx(t.StrictMode,{children:e.jsx(As,{children:e.jsx(gi,{})})})}));
